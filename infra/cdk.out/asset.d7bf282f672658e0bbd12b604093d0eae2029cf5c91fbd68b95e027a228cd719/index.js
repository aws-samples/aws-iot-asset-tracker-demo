"use strict";var vf=Object.create;var Nt=Object.defineProperty;var _f=Object.getOwnPropertyDescriptor;var bf=Object.getOwnPropertyNames;var yf=Object.getPrototypeOf,Ef=Object.prototype.hasOwnProperty;var Sf=(t,e)=>()=>(t&&(e=t(t=0)),e);var f=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),zi=(t,e)=>{for(var r in e)Nt(t,r,{get:e[r],enumerable:!0})},Qi=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of bf(e))!Ef.call(t,i)&&i!==r&&Nt(t,i,{get:()=>e[i],enumerable:!(n=_f(e,i))||n.enumerable});return t};var nt=(t,e,r)=>(r=t!=null?vf(yf(t)):{},Qi(e||!t||!t.__esModule?Nt(r,"default",{value:t,enumerable:!0}):r,t)),nn=t=>Qi(Nt({},"__esModule",{value:!0}),t);var un={};zi(un,{__assign:()=>an,__asyncDelegator:()=>Mf,__asyncGenerator:()=>Pf,__asyncValues:()=>Df,__await:()=>it,__awaiter:()=>Lf,__classPrivateFieldGet:()=>Ff,__classPrivateFieldSet:()=>Uf,__createBinding:()=>qf,__decorate:()=>Af,__exportStar:()=>If,__extends:()=>Tf,__generator:()=>Cf,__importDefault:()=>Bf,__importStar:()=>jf,__makeTemplateObject:()=>$f,__metadata:()=>Of,__param:()=>Rf,__read:()=>Ji,__rest:()=>wf,__spread:()=>xf,__spreadArrays:()=>Nf,__values:()=>on});function Tf(t,e){sn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function wf(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Af(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Rf(t,e){return function(r,n){e(r,n,t)}}function Of(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Lf(t,e,r,n){function i(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function o(l){try{c(n.next(l))}catch(d){a(d)}}function u(l){try{c(n.throw(l))}catch(d){a(d)}}function c(l){l.done?s(l.value):i(l.value).then(o,u)}c((n=n.apply(t,e||[])).next())})}function Cf(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function qf(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function If(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function on(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ji(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s}function xf(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ji(arguments[e]));return t}function Nf(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,i++)n[i]=s[a];return n}function it(t){return this instanceof it?(this.v=t,this):new it(t)}function Pf(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(p){n[p]&&(i[p]=function(h){return new Promise(function(C,T){s.push([p,h,C,T])>1||o(p,h)})})}function o(p,h){try{u(n[p](h))}catch(C){d(s[0][3],C)}}function u(p){p.value instanceof it?Promise.resolve(p.value.v).then(c,l):d(s[0][2],p)}function c(p){o("next",p)}function l(p){o("throw",p)}function d(p,h){p(h),s.shift(),s.length&&o(s[0][0],s[0][1])}}function Mf(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(a){return(r=!r)?{value:it(t[i](a)),done:i==="return"}:s?s(a):a}:s}}function Df(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof on=="function"?on(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(a){return new Promise(function(o,u){a=t[s](a),i(o,u,a.done,a.value)})}}function i(s,a,o,u){Promise.resolve(u).then(function(c){s({value:c,done:o})},a)}}function $f(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function jf(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Bf(t){return t&&t.__esModule?t:{default:t}}function Ff(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Uf(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var sn,an,cn=Sf(()=>{sn=function(t,e){return sn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},sn(t,e)};an=function(){return an=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},an.apply(this,arguments)}});var ln=f(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.MAX_HASHABLE_LENGTH=G.INIT=G.KEY=G.DIGEST_LENGTH=G.BLOCK_SIZE=void 0;G.BLOCK_SIZE=64;G.DIGEST_LENGTH=32;G.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);G.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];G.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1});var Zi=f(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.RawSha256=void 0;var H=ln(),Vf=function(){function t(){this.state=Int32Array.from(H.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var r=0,n=e.byteLength;if(this.bytesHashed+=n,this.bytesHashed*8>H.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[r++],n--,this.bufferLength===H.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,r=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(r.setUint8(this.bufferLength++,128),n%H.BLOCK_SIZE>=H.BLOCK_SIZE-8){for(var i=this.bufferLength;i<H.BLOCK_SIZE;i++)r.setUint8(i,0);this.hashBuffer(),this.bufferLength=0}for(var i=this.bufferLength;i<H.BLOCK_SIZE-8;i++)r.setUint8(i,0);r.setUint32(H.BLOCK_SIZE-8,Math.floor(e/4294967296),!0),r.setUint32(H.BLOCK_SIZE-4,e),this.hashBuffer(),this.finished=!0}for(var s=new Uint8Array(H.DIGEST_LENGTH),i=0;i<8;i++)s[i*4]=this.state[i]>>>24&255,s[i*4+1]=this.state[i]>>>16&255,s[i*4+2]=this.state[i]>>>8&255,s[i*4+3]=this.state[i]>>>0&255;return s},t.prototype.hashBuffer=function(){for(var e=this,r=e.buffer,n=e.state,i=n[0],s=n[1],a=n[2],o=n[3],u=n[4],c=n[5],l=n[6],d=n[7],p=0;p<H.BLOCK_SIZE;p++){if(p<16)this.temp[p]=(r[p*4]&255)<<24|(r[p*4+1]&255)<<16|(r[p*4+2]&255)<<8|r[p*4+3]&255;else{var h=this.temp[p-2],C=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10;h=this.temp[p-15];var T=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3;this.temp[p]=(C+this.temp[p-7]|0)+(T+this.temp[p-16]|0)}var Re=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&c^~u&l)|0)+(d+(H.KEY[p]+this.temp[p]|0)|0)|0,rn=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&s^i&a^s&a)|0;d=l,l=c,c=u,u=o+Re|0,o=a,a=s,s=i,i=Re+rn|0}n[0]+=i,n[1]+=s,n[2]+=a,n[3]+=o,n[4]+=u,n[5]+=c,n[6]+=l,n[7]+=d},t}();Pt.RawSha256=Vf});var es=f(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.convertToBuffer=void 0;var Gf=require("@aws-sdk/util-utf8-browser"),Hf=typeof Buffer<"u"&&Buffer.from?function(t){return Buffer.from(t,"utf8")}:Gf.fromUtf8;function kf(t){return t instanceof Uint8Array?t:typeof t=="string"?Hf(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}Mt.convertToBuffer=kf});var ts=f(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.isEmptyData=void 0;function Wf(t){return typeof t=="string"?t.length===0:t.byteLength===0}Dt.isEmptyData=Wf});var rs=f($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.numToUint8=void 0;function Xf(t){return new Uint8Array([(t&4278190080)>>24,(t&16711680)>>16,(t&65280)>>8,t&255])}$t.numToUint8=Xf});var ns=f(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.uint32ArrayFrom=void 0;function Kf(t){if(!Uint32Array.from){for(var e=new Uint32Array(t.length),r=0;r<t.length;)e[r]=t[r],r+=1;return e}return Uint32Array.from(t)}jt.uint32ArrayFrom=Kf});var is=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.uint32ArrayFrom=Q.numToUint8=Q.isEmptyData=Q.convertToBuffer=void 0;var Yf=es();Object.defineProperty(Q,"convertToBuffer",{enumerable:!0,get:function(){return Yf.convertToBuffer}});var zf=ts();Object.defineProperty(Q,"isEmptyData",{enumerable:!0,get:function(){return zf.isEmptyData}});var Qf=rs();Object.defineProperty(Q,"numToUint8",{enumerable:!0,get:function(){return Qf.numToUint8}});var Jf=ns();Object.defineProperty(Q,"uint32ArrayFrom",{enumerable:!0,get:function(){return Jf.uint32ArrayFrom}})});var as=f(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.Sha256=void 0;var ss=(cn(),nn(un)),Ft=ln(),Bt=Zi(),fn=is(),Zf=function(){function t(e){this.secret=e,this.hash=new Bt.RawSha256,this.reset()}return t.prototype.update=function(e){if(!((0,fn.isEmptyData)(e)||this.error))try{this.hash.update((0,fn.convertToBuffer)(e))}catch(r){this.error=r}},t.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},t.prototype.digest=function(){return ss.__awaiter(this,void 0,void 0,function(){return ss.__generator(this,function(e){return[2,this.digestSync()]})})},t.prototype.reset=function(){if(this.hash=new Bt.RawSha256,this.secret){this.outer=new Bt.RawSha256;var e=ed(this.secret),r=new Uint8Array(Ft.BLOCK_SIZE);r.set(e);for(var n=0;n<Ft.BLOCK_SIZE;n++)e[n]^=54,r[n]^=92;this.hash.update(e),this.outer.update(r);for(var n=0;n<e.byteLength;n++)e[n]=0}},t}();Ut.Sha256=Zf;function ed(t){var e=(0,fn.convertToBuffer)(t);if(e.byteLength>Ft.BLOCK_SIZE){var r=new Bt.RawSha256;r.update(e),e=r.digest()}var n=new Uint8Array(Ft.BLOCK_SIZE);return n.set(e),n}});var os=f(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});var td=(cn(),nn(un));td.__exportStar(as(),dn)});var cs=f((Ly,us)=>{us.exports=class{constructor(e,r){this.coreRes=e,this.resOptions=r,this.body=Buffer.alloc(0),this.headers=e.headers,this.statusCode=e.statusCode}_addChunk(e){this.body=Buffer.concat([this.body,e])}async json(){return this.statusCode===204?null:JSON.parse(this.body)}async text(){return this.body.toString()}}});var fs=f((qy,ls)=>{var rd=require("path"),nd=require("http"),id=require("https"),sd=require("querystring"),hn=require("zlib"),{URL:ad}=require("url"),od=cs(),ud=["gzip","deflate","br"];ls.exports=class{constructor(e,r="GET"){return this.url=typeof e=="string"?new ad(e):e,this.method=r,this.data=null,this.sendDataAs=null,this.reqHeaders={},this.streamEnabled=!1,this.compressionEnabled=!1,this.timeoutTime=null,this.coreOptions={},this.resOptions={maxBuffer:50*1e6},this}query(e,r){return typeof e=="object"?Object.keys(e).forEach(n=>{this.url.searchParams.append(n,e[n])}):this.url.searchParams.append(e,r),this}path(e){return this.url.pathname=rd.join(this.url.pathname,e),this}body(e,r){return this.sendDataAs=typeof e=="object"&&!r&&!Buffer.isBuffer(e)?"json":r?r.toLowerCase():"buffer",this.data=this.sendDataAs==="form"?sd.stringify(e):this.sendDataAs==="json"?JSON.stringify(e):e,this}header(e,r){return typeof e=="object"?Object.keys(e).forEach(n=>{this.reqHeaders[n.toLowerCase()]=e[n]}):this.reqHeaders[e.toLowerCase()]=r,this}timeout(e){return this.timeoutTime=e,this}option(e,r){return this.coreOptions[e]=r,this}stream(){return this.streamEnabled=!0,this}compress(){return this.compressionEnabled=!0,this.reqHeaders["accept-encoding"]||(this.reqHeaders["accept-encoding"]=ud.join(", ")),this}send(){return new Promise((e,r)=>{this.data&&(this.reqHeaders.hasOwnProperty("content-type")||(this.sendDataAs==="json"?this.reqHeaders["content-type"]="application/json":this.sendDataAs==="form"&&(this.reqHeaders["content-type"]="application/x-www-form-urlencoded")),this.reqHeaders.hasOwnProperty("content-length")||(this.reqHeaders["content-length"]=Buffer.byteLength(this.data)));let n=Object.assign({protocol:this.url.protocol,host:this.url.hostname.replace("[","").replace("]",""),port:this.url.port,path:this.url.pathname+(this.url.search===null?"":this.url.search),method:this.method,headers:this.reqHeaders},this.coreOptions),i,s=a=>{let o=a;this.compressionEnabled&&(a.headers["content-encoding"]==="gzip"?o=a.pipe(hn.createGunzip()):a.headers["content-encoding"]==="deflate"?o=a.pipe(hn.createInflate()):a.headers["content-encoding"]==="br"&&(o=a.pipe(hn.createBrotliDecompress())));let u;this.streamEnabled?e(o):(u=new od(a,this.resOptions),o.on("error",c=>{r(c)}),o.on("aborted",()=>{r(new Error("Server aborted request"))}),o.on("data",c=>{u._addChunk(c),this.resOptions.maxBuffer!==null&&u.body.length>this.resOptions.maxBuffer&&(o.destroy(),r("Received a response which was longer than acceptable when buffering. ("+this.body.length+" bytes)"))}),o.on("end",()=>{e(u)}))};if(this.url.protocol==="http:")i=nd.request(n,s);else if(this.url.protocol==="https:")i=id.request(n,s);else throw new Error("Bad URL protocol: "+this.url.protocol);this.timeoutTime&&i.setTimeout(this.timeoutTime,()=>{i.abort(),this.streamEnabled||r(new Error("Timeout reached"))}),i.on("error",a=>{r(a)}),this.data&&i.write(this.data),i.end()})}}});var hs=f((Iy,ds)=>{var cd=fs();ds.exports=(t,e)=>new cd(t,e)});var gs=f((xy,ps)=>{var{URL:ld}=require("url"),fd=hs(),he=async t=>{if(typeof t!="string"&&!t.hasOwnProperty("url"))throw new Error("Missing url option from options for request method.");let e=fd(typeof t=="object"?t.url:t,t.method||"GET");t.headers&&e.header(t.headers),t.stream&&e.stream(),t.timeout&&e.timeout(t.timeout),t.data&&e.body(t.data),t.form&&e.body(t.form,"form"),t.compression&&e.compress(),typeof t.core=="object"&&Object.keys(t.core).forEach(n=>{e.option(n,t.core[n])});let r=await e.send();if(r.headers.hasOwnProperty("location")&&t.followRedirects)return t.url=new ld(r.headers.location,t.url).toString(),await he(t);if(t.stream)return r.stream=r,r;if(r.coreRes.body=r.body,t.parse){if(t.parse==="json")return r.coreRes.body=await r.json(),r.coreRes;if(t.parse==="string")return r.coreRes.body=r.coreRes.body.toString(),r.coreRes}return r.coreRes};he.promisified=he;he.unpromisified=(t,e)=>{he(t).then(r=>{e&&e(null,r)}).catch(r=>{e&&e(r,null)})};he.defaults=t=>async e=>{let r=typeof e=="string"?{url:e}:e;return Object.keys(t).forEach(n=>{(!r.hasOwnProperty(n)||r[n]===null)&&(r[n]=t[n])}),await he(r)};ps.exports=he});var pn=f(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.PT_VERSION=void 0;Vt.PT_VERSION="1.11.1"});var ms=f(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.createLogger=void 0;var dd=gn(),hd=(t={})=>new dd.Logger(t);Gt.createLogger=hd});var _s=f(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0})});var bs=f(Oe=>{"use strict";var pd=Oe&&Oe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),gd=Oe&&Oe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&pd(e,t,r)};Object.defineProperty(Oe,"__esModule",{value:!0});gd(_s(),Oe)});var ys=f(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.Utility=void 0;var mn=class{constructor(){this.coldStart=!0,this.defaultServiceName="service_undefined"}getColdStart(){return this.coldStart?(this.coldStart=!1,!0):!1}isColdStart(){return this.getColdStart()}getDefaultServiceName(){return this.defaultServiceName}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};Ht.Utility=mn});var Es=f(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.ConfigService=void 0;var vn=class{};kt.ConfigService=vn});var Ss=f(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.EnvironmentVariablesService=void 0;var md=bn(),_n=class extends md.ConfigService{constructor(){super(...arguments),this.serviceNameVariable="POWERTOOLS_SERVICE_NAME",this.xRayTraceIdVariable="_X_AMZN_TRACE_ID"}get(e){return process.env[e]?.trim()||""}getServiceName(){return this.get(this.serviceNameVariable)}getXrayTraceId(){return this.getXrayTraceData()?.Root}getXrayTraceSampled(){return this.getXrayTraceData()?.Sampled==="1"}isValueTrue(e){return["1","y","yes","t","true","on"].includes(e.toLowerCase())}getXrayTraceData(){let e=this.get(this.xRayTraceIdVariable);if(e==="")return;if(!e.includes("="))return{Root:e};let r={};return e.split(";").forEach(n=>{let[i,s]=n.split("=");r[i]=s}),r}};Wt.EnvironmentVariablesService=_n});var bn=f(pe=>{"use strict";var vd=pe&&pe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ts=pe&&pe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&vd(e,t,r)};Object.defineProperty(pe,"__esModule",{value:!0});Ts(Es(),pe);Ts(Ss(),pe)});var ws=f(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.helloworldContext=void 0;var _d={callbackWaitsForEmptyEventLoop:!0,functionVersion:"$LATEST",functionName:"foo-bar-function",memoryLimitInMB:"128",logGroupName:"/aws/lambda/foo-bar-function-123456abcdef",logStreamName:"2021/03/09/[$LATEST]abcdef123456abcdef123456abcdef123456",invokedFunctionArn:"arn:aws:lambda:eu-west-1:123456789012:function:foo-bar-function",awsRequestId:"c6af9ac6-7b61-11e6-9a41-93e812345678",getRemainingTimeInMillis:()=>1234,done:()=>console.log("Done!"),fail:()=>console.log("Failed!"),succeed:()=>console.log("Succeeded!")};Xt.helloworldContext=_d});var As=f(Le=>{"use strict";var bd=Le&&Le.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),yd=Le&&Le.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&bd(e,t,r)};Object.defineProperty(Le,"__esModule",{value:!0});yd(ws(),Le)});var Rs=f(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.CustomEvent=void 0;Kt.CustomEvent={key1:"value1",key2:"value2",key3:"value3"}});var Os=f(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.Custom=void 0;Yt.Custom=Rs()});var Cs=f(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0})});var Is=f(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.isNullOrUndefined=J.isTruthy=J.isString=J.isRecord=void 0;var qs=t=>Object.prototype.toString.call(t)==="[object Object]"&&!Object.is(t,null);J.isRecord=qs;var Ed=t=>typeof t=="string"?t!=="":typeof t=="number"?t!==0:typeof t=="boolean"?t:Array.isArray(t)?t.length>0:qs(t)?Object.keys(t).length>0:!1;J.isTruthy=Ed;var Sd=t=>Object.is(t,null)||Object.is(t,void 0);J.isNullOrUndefined=Sd;var Td=t=>typeof t=="string";J.isString=Td});var xs=f(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.addUserAgentMiddleware=void 0;var wd=pn(),Ad=process.env.AWS_EXECUTION_ENV||"NA",Rd={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},Od=t=>(e,r)=>async n=>{let i=`PT/${t}/${wd.PT_VERSION} PTEnv/${Ad}`;return n.request.headers["user-agent"]=`${n.request.headers["user-agent"]} ${i}`,await e(n)},Ld=(t,e)=>{try{if(t.middlewareStack.identify().includes("addPowertoolsToUserAgent: POWERTOOLS,USER_AGENT"))return;t.middlewareStack.addRelativeTo(Od(e),Rd)}catch(r){console.warn("Failed to add user agent middleware",r)}};zt.addUserAgentMiddleware=Ld});var Be=f(P=>{"use strict";var Cd=P&&P.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),je=P&&P.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Cd(e,t,r)};Object.defineProperty(P,"__esModule",{value:!0});P.Events=P.ContextExamples=void 0;je(bs(),P);je(ys(),P);je(bn(),P);P.ContextExamples=As();P.Events=Os();je(Cs(),P);je(Is(),P);je(xs(),P)});var Ns=f(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.LogFormatter=void 0;var yn=class{formatError(e){return{name:e.name,location:this.getCodeLocation(e.stack),message:e.message,stack:e.stack}}formatTimestamp(e){return e.toISOString()}getCodeLocation(e){if(!e)return"";let r=e.split(`
`),n=/\((.*):(\d+):(\d+)\)\\?$/,i;for(i=0;i<r.length;i++){let s=n.exec(r[i]);if(Array.isArray(s))return`${s[1]}:${Number(s[2])}`}return""}};Qt.LogFormatter=yn});var Ms=f(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0})});var Ds=f(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.PowertoolLogFormatter=void 0;var qd=Zt(),En=class extends qd.LogFormatter{formatAttributes(e){return{cold_start:e.lambdaContext?.coldStart,function_arn:e.lambdaContext?.invokedFunctionArn,function_memory_size:e.lambdaContext?.memoryLimitInMB,function_name:e.lambdaContext?.functionName,function_request_id:e.lambdaContext?.awsRequestId,level:e.logLevel,message:e.message,sampling_rate:e.sampleRateValue,service:e.serviceName,timestamp:this.formatTimestamp(e.timestamp),xray_trace_id:e.xRayTraceId}}};Jt.PowertoolLogFormatter=En});var Zt=f(ne=>{"use strict";var Id=ne&&ne.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Sn=ne&&ne.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Id(e,t,r)};Object.defineProperty(ne,"__esModule",{value:!0});Sn(Ns(),ne);Sn(Ms(),ne);Sn(Ds(),ne)});var Nn=f((st,Fe)=>{var xd=200,Ws="__lodash_hash_undefined__",Nd=800,Pd=16,Xs=9007199254740991,Ks="[object Arguments]",Md="[object Array]",Dd="[object AsyncFunction]",$d="[object Boolean]",jd="[object Date]",Bd="[object Error]",Ys="[object Function]",Fd="[object GeneratorFunction]",Ud="[object Map]",Vd="[object Number]",Gd="[object Null]",zs="[object Object]",Hd="[object Proxy]",kd="[object RegExp]",Wd="[object Set]",Xd="[object String]",Kd="[object Undefined]",Yd="[object WeakMap]",zd="[object ArrayBuffer]",Qd="[object DataView]",Jd="[object Float32Array]",Zd="[object Float64Array]",eh="[object Int8Array]",th="[object Int16Array]",rh="[object Int32Array]",nh="[object Uint8Array]",ih="[object Uint8ClampedArray]",sh="[object Uint16Array]",ah="[object Uint32Array]",oh=/[\\^$.*+?()[\]{}|]/g,uh=/^\[object .+?Constructor\]$/,ch=/^(?:0|[1-9]\d*)$/,w={};w[Jd]=w[Zd]=w[eh]=w[th]=w[rh]=w[nh]=w[ih]=w[sh]=w[ah]=!0;w[Ks]=w[Md]=w[zd]=w[$d]=w[Qd]=w[jd]=w[Bd]=w[Ys]=w[Ud]=w[Vd]=w[zs]=w[kd]=w[Wd]=w[Xd]=w[Yd]=!1;var Qs=typeof global=="object"&&global&&global.Object===Object&&global,lh=typeof self=="object"&&self&&self.Object===Object&&self,ut=Qs||lh||Function("return this")(),Js=typeof st=="object"&&st&&!st.nodeType&&st,at=Js&&typeof Fe=="object"&&Fe&&!Fe.nodeType&&Fe,Zs=at&&at.exports===Js,Tn=Zs&&Qs.process,$s=function(){try{var t=at&&at.require&&at.require("util").types;return t||Tn&&Tn.binding&&Tn.binding("util")}catch{}}(),js=$s&&$s.isTypedArray;function fh(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function dh(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function hh(t){return function(e){return t(e)}}function ph(t,e){return t?.[e]}function gh(t,e){return function(r){return t(e(r))}}var mh=Array.prototype,vh=Function.prototype,rr=Object.prototype,wn=ut["__core-js_shared__"],nr=vh.toString,ie=rr.hasOwnProperty,Bs=function(){var t=/[^.]+$/.exec(wn&&wn.keys&&wn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ea=rr.toString,_h=nr.call(Object),bh=RegExp("^"+nr.call(ie).replace(oh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),er=Zs?ut.Buffer:void 0,Fs=ut.Symbol,Us=ut.Uint8Array,Vs=er?er.allocUnsafe:void 0,ta=gh(Object.getPrototypeOf,Object),Gs=Object.create,yh=rr.propertyIsEnumerable,Eh=mh.splice,Ce=Fs?Fs.toStringTag:void 0,tr=function(){try{var t=qn(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Sh=er?er.isBuffer:void 0,Hs=Math.max,Th=Date.now,ra=qn(ut,"Map"),ot=qn(Object,"create"),wh=function(){function t(){}return function(e){if(!Ie(e))return{};if(Gs)return Gs(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function qe(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ah(){this.__data__=ot?ot(null):{},this.size=0}function Rh(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Oh(t){var e=this.__data__;if(ot){var r=e[t];return r===Ws?void 0:r}return ie.call(e,t)?e[t]:void 0}function Lh(t){var e=this.__data__;return ot?e[t]!==void 0:ie.call(e,t)}function Ch(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ot&&e===void 0?Ws:e,this}qe.prototype.clear=Ah;qe.prototype.delete=Rh;qe.prototype.get=Oh;qe.prototype.has=Lh;qe.prototype.set=Ch;function se(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function qh(){this.__data__=[],this.size=0}function Ih(t){var e=this.__data__,r=ir(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Eh.call(e,r,1),--this.size,!0}function xh(t){var e=this.__data__,r=ir(e,t);return r<0?void 0:e[r][1]}function Nh(t){return ir(this.__data__,t)>-1}function Ph(t,e){var r=this.__data__,n=ir(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}se.prototype.clear=qh;se.prototype.delete=Ih;se.prototype.get=xh;se.prototype.has=Nh;se.prototype.set=Ph;function Ue(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Mh(){this.size=0,this.__data__={hash:new qe,map:new(ra||se),string:new qe}}function Dh(t){var e=ar(this,t).delete(t);return this.size-=e?1:0,e}function $h(t){return ar(this,t).get(t)}function jh(t){return ar(this,t).has(t)}function Bh(t,e){var r=ar(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}Ue.prototype.clear=Mh;Ue.prototype.delete=Dh;Ue.prototype.get=$h;Ue.prototype.has=jh;Ue.prototype.set=Bh;function Ve(t){var e=this.__data__=new se(t);this.size=e.size}function Fh(){this.__data__=new se,this.size=0}function Uh(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function Vh(t){return this.__data__.get(t)}function Gh(t){return this.__data__.has(t)}function Hh(t,e){var r=this.__data__;if(r instanceof se){var n=r.__data__;if(!ra||n.length<xd-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ue(n)}return r.set(t,e),this.size=r.size,this}Ve.prototype.clear=Fh;Ve.prototype.delete=Uh;Ve.prototype.get=Vh;Ve.prototype.has=Gh;Ve.prototype.set=Hh;function kh(t,e){var r=Ln(t),n=!r&&On(t),i=!r&&!n&&aa(t),s=!r&&!n&&!i&&ua(t),a=r||n||i||s,o=a?dh(t.length,String):[],u=o.length;for(var c in t)(e||ie.call(t,c))&&!(a&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ia(c,u)))&&o.push(c);return o}function An(t,e,r){(r!==void 0&&!or(t[e],r)||r===void 0&&!(e in t))&&Cn(t,e,r)}function Wh(t,e,r){var n=t[e];(!(ie.call(t,e)&&or(n,r))||r===void 0&&!(e in t))&&Cn(t,e,r)}function ir(t,e){for(var r=t.length;r--;)if(or(t[r][0],e))return r;return-1}function Cn(t,e,r){e=="__proto__"&&tr?tr(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Xh=ap();function sr(t){return t==null?t===void 0?Kd:Gd:Ce&&Ce in Object(t)?op(t):hp(t)}function ks(t){return ct(t)&&sr(t)==Ks}function Kh(t){if(!Ie(t)||fp(t))return!1;var e=xn(t)?bh:uh;return e.test(vp(t))}function Yh(t){return ct(t)&&oa(t.length)&&!!w[sr(t)]}function zh(t){if(!Ie(t))return dp(t);var e=sa(t),r=[];for(var n in t)n=="constructor"&&(e||!ie.call(t,n))||r.push(n);return r}function na(t,e,r,n,i){t!==e&&Xh(e,function(s,a){if(i||(i=new Ve),Ie(s))Qh(t,e,a,r,na,n,i);else{var o=n?n(Rn(t,a),s,a+"",t,e,i):void 0;o===void 0&&(o=s),An(t,a,o)}},ca)}function Qh(t,e,r,n,i,s,a){var o=Rn(t,r),u=Rn(e,r),c=a.get(u);if(c){An(t,r,c);return}var l=s?s(o,u,r+"",t,e,a):void 0,d=l===void 0;if(d){var p=Ln(u),h=!p&&aa(u),C=!p&&!h&&ua(u);l=u,p||h||C?Ln(o)?l=o:_p(o)?l=np(o):h?(d=!1,l=ep(u,!0)):C?(d=!1,l=rp(u,!0)):l=[]:bp(u)||On(u)?(l=o,On(o)?l=yp(o):(!Ie(o)||xn(o))&&(l=up(u))):d=!1}d&&(a.set(u,l),i(l,u,n,s,a),a.delete(u)),An(t,r,l)}function Jh(t,e){return gp(pp(t,e,la),t+"")}var Zh=tr?function(t,e){return tr(t,"toString",{configurable:!0,enumerable:!1,value:Sp(e),writable:!0})}:la;function ep(t,e){if(e)return t.slice();var r=t.length,n=Vs?Vs(r):new t.constructor(r);return t.copy(n),n}function tp(t){var e=new t.constructor(t.byteLength);return new Us(e).set(new Us(t)),e}function rp(t,e){var r=e?tp(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function np(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function ip(t,e,r,n){var i=!r;r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],u=n?n(r[o],t[o],o,r,t):void 0;u===void 0&&(u=t[o]),i?Cn(r,o,u):Wh(r,o,u)}return r}function sp(t){return Jh(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,a&&cp(r[0],r[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var o=r[n];o&&t(e,o,n,s)}return e})}function ap(t){return function(e,r,n){for(var i=-1,s=Object(e),a=n(e),o=a.length;o--;){var u=a[t?o:++i];if(r(s[u],u,s)===!1)break}return e}}function ar(t,e){var r=t.__data__;return lp(e)?r[typeof e=="string"?"string":"hash"]:r.map}function qn(t,e){var r=ph(t,e);return Kh(r)?r:void 0}function op(t){var e=ie.call(t,Ce),r=t[Ce];try{t[Ce]=void 0;var n=!0}catch{}var i=ea.call(t);return n&&(e?t[Ce]=r:delete t[Ce]),i}function up(t){return typeof t.constructor=="function"&&!sa(t)?wh(ta(t)):{}}function ia(t,e){var r=typeof t;return e=e??Xs,!!e&&(r=="number"||r!="symbol"&&ch.test(t))&&t>-1&&t%1==0&&t<e}function cp(t,e,r){if(!Ie(r))return!1;var n=typeof e;return(n=="number"?In(r)&&ia(e,r.length):n=="string"&&e in r)?or(r[e],t):!1}function lp(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function fp(t){return!!Bs&&Bs in t}function sa(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||rr;return t===r}function dp(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}function hp(t){return ea.call(t)}function pp(t,e,r){return e=Hs(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=Hs(n.length-e,0),a=Array(s);++i<s;)a[i]=n[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=n[i];return o[e]=r(a),fh(t,this,o)}}function Rn(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var gp=mp(Zh);function mp(t){var e=0,r=0;return function(){var n=Th(),i=Pd-(n-r);if(r=n,i>0){if(++e>=Nd)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function vp(t){if(t!=null){try{return nr.call(t)}catch{}try{return t+""}catch{}}return""}function or(t,e){return t===e||t!==t&&e!==e}var On=ks(function(){return arguments}())?ks:function(t){return ct(t)&&ie.call(t,"callee")&&!yh.call(t,"callee")},Ln=Array.isArray;function In(t){return t!=null&&oa(t.length)&&!xn(t)}function _p(t){return ct(t)&&In(t)}var aa=Sh||Tp;function xn(t){if(!Ie(t))return!1;var e=sr(t);return e==Ys||e==Fd||e==Dd||e==Hd}function oa(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Xs}function Ie(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function ct(t){return t!=null&&typeof t=="object"}function bp(t){if(!ct(t)||sr(t)!=zs)return!1;var e=ta(t);if(e===null)return!0;var r=ie.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&nr.call(r)==_h}var ua=js?hh(js):Yh;function yp(t){return ip(t,ca(t))}function ca(t){return In(t)?kh(t,!0):zh(t)}var Ep=sp(function(t,e,r){na(t,e,r)});function Sp(t){return function(){return t}}function la(t){return t}function Tp(){return!1}Fe.exports=Ep});var fa=f(Ge=>{"use strict";var wp=Ge&&Ge.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.LogItem=void 0;var Ap=wp(Nn()),Pn=class{constructor(e){this.attributes={},this.addAttributes(e.baseAttributes),this.addAttributes(e.persistentAttributes)}addAttributes(e){return this.attributes=(0,Ap.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.setAttributes(this.removeEmptyKeys(this.getAttributes()))}removeEmptyKeys(e){let r={};for(let n in e)e[n]!==void 0&&e[n]!==""&&e[n]!==null&&(r[n]=e[n]);return r}setAttributes(e){this.attributes=e}};Ge.LogItem=Pn});var ha=f(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0})});var ga=f(ge=>{"use strict";var Rp=ge&&ge.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),pa=ge&&ge.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Rp(e,t,r)};Object.defineProperty(ge,"__esModule",{value:!0});pa(fa(),ge);pa(ha(),ge)});var va=f(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0})});var _a=f(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.EnvironmentVariablesService=void 0;var Op=Be(),Mn=class extends Op.EnvironmentVariablesService{constructor(){super(...arguments),this.awsRegionVariable="AWS_REGION",this.currentEnvironmentVariable="ENVIRONMENT",this.devModeVariable="POWERTOOLS_DEV",this.functionNameVariable="AWS_LAMBDA_FUNCTION_NAME",this.functionVersionVariable="AWS_LAMBDA_FUNCTION_VERSION",this.logEventVariable="POWERTOOLS_LOGGER_LOG_EVENT",this.logLevelVariable="LOG_LEVEL",this.memoryLimitInMBVariable="AWS_LAMBDA_FUNCTION_MEMORY_SIZE",this.sampleRateValueVariable="POWERTOOLS_LOGGER_SAMPLE_RATE"}getAwsRegion(){return this.get(this.awsRegionVariable)}getCurrentEnvironment(){return this.get(this.currentEnvironmentVariable)}getFunctionMemory(){let e=this.get(this.memoryLimitInMBVariable);return Number(e)}getFunctionName(){return this.get(this.functionNameVariable)}getFunctionVersion(){return this.get(this.functionVersionVariable)}getLogEvent(){let e=this.get(this.logEventVariable);return this.isValueTrue(e)}getLogLevel(){return this.get(this.logLevelVariable)}getSampleRateValue(){let e=this.get(this.sampleRateValueVariable);return e&&e.length>0?Number(e):void 0}isDevMode(){let e=this.get(this.devModeVariable);return this.isValueTrue(e)}};ur.EnvironmentVariablesService=Mn});var ya=f(me=>{"use strict";var Lp=me&&me.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),ba=me&&me.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Lp(e,t,r)};Object.defineProperty(me,"__esModule",{value:!0});ba(va(),me);ba(_a(),me)});var $n=f(He=>{"use strict";var Cp=He&&He.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(He,"__esModule",{value:!0});He.Logger=void 0;var qp=require("crypto"),Ip=require("console"),xp=Be(),Np=Zt(),Pp=ga(),cr=Cp(Nn()),Mp=ya(),Dn=class t extends xp.Utility{get level(){return this.logLevel}constructor(e={}){super(),this.logEvent=!1,this.logIndentation=0,this.logLevel=12,this.logLevelThresholds={DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},this.logsSampled=!1,this.persistentLogAttributes={},this.powertoolLogData={},this.setOptions(e)}addContext(e){let r={invokedFunctionArn:e.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:e.awsRequestId,memoryLimitInMB:Number(e.memoryLimitInMB),functionName:e.functionName,functionVersion:e.functionVersion};this.addToPowertoolLogData({lambdaContext:r})}addPersistentLogAttributes(e){(0,cr.default)(this.persistentLogAttributes,e)}appendKeys(e){this.addPersistentLogAttributes(e)}createChild(e={}){let r={logLevel:this.getLevelName(),customConfigService:this.getCustomConfigService(),logFormatter:this.getLogFormatter()},n=this.getPowertoolLogData(),i=new t((0,cr.default)(r,n,e)),s=this.getPersistentLogAttributes();return i.addPersistentLogAttributes(s),n.lambdaContext&&i.addContext(n.lambdaContext),i}critical(e,...r){this.processLogItem(24,e,r)}debug(e,...r){this.processLogItem(8,e,r)}error(e,...r){this.processLogItem(20,e,r)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getLogsSampled(){return this.logsSampled}getPersistentLogAttributes(){return this.persistentLogAttributes}info(e,...r){this.processLogItem(12,e,r)}injectLambdaContext(e){return(r,n,i)=>{let s=i.value,a=this;i.value=async function(o,u,c){let l={};e&&e.clearState===!0&&(l={...a.getPersistentLogAttributes()}),t.injectLambdaContextBefore(a,o,u,e);let d;try{d=await s.apply(this,[o,u,c])}catch(p){throw p}finally{t.injectLambdaContextAfterOrOnError(a,l,e)}return d}}}static injectLambdaContextAfterOrOnError(e,r,n){n&&n.clearState===!0&&e.setPersistentLogAttributes(r)}static injectLambdaContextBefore(e,r,n,i){e.addContext(n);let s;i&&i.hasOwnProperty("logEvent")&&(s=i.logEvent),e.logEventIfEnabled(r,s)}logEventIfEnabled(e,r){this.shouldLogEvent(r)&&this.info("Lambda invocation event",{event:e})}refreshSampleRateCalculation(){this.setLogsSampled()}removeKeys(e){this.removePersistentLogAttributes(e)}removePersistentLogAttributes(e){e.forEach(r=>{this.persistentLogAttributes&&r in this.persistentLogAttributes&&delete this.persistentLogAttributes[r]})}setLogLevel(e){if(this.isValidLogLevel(e))this.logLevel=this.logLevelThresholds[e];else throw new Error(`Invalid log level: ${e}`)}setPersistentLogAttributes(e){this.persistentLogAttributes=e}setSampleRateValue(e){this.powertoolLogData.sampleRateValue=e||this.getCustomConfigService()?.getSampleRateValue()||this.getEnvVarsService().getSampleRateValue()}shouldLogEvent(e){return typeof e=="boolean"?e:this.getLogEvent()}warn(e,...r){this.processLogItem(16,e,r)}shouldPrint(e){return e>=this.logLevel?!0:this.getLogsSampled()}addToPowertoolLogData(...e){e.forEach(r=>{(0,cr.default)(this.powertoolLogData,r)})}createAndPopulateLogItem(e,r,n){let i=(0,cr.default)({logLevel:this.getLogLevelNameFromNumber(e),timestamp:new Date,message:typeof r=="string"?r:r.message,xRayTraceId:this.envVarsService.getXrayTraceId()},this.getPowertoolLogData()),s=new Pp.LogItem({baseAttributes:this.getLogFormatter().formatAttributes(i),persistentAttributes:this.getPersistentLogAttributes()});return typeof r!="string"&&s.addAttributes(r),n.forEach(a=>{let o=a instanceof Error?{error:a}:typeof a=="string"?{extra:a}:a;s.addAttributes(o)}),s}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(e){return Object.entries(this.logLevelThresholds).find(([n,i])=>{if(i===e)return n})[0]}getPowertoolLogData(){return this.powertoolLogData}getReplacer(){let e=new WeakSet;return(r,n)=>{let i=n;if(i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&n!==null){if(e.has(i))return;e.add(i)}return i}}getSampleRateValue(){return this.powertoolLogData.sampleRateValue||this.setSampleRateValue(),this.powertoolLogData.sampleRateValue}isValidLogLevel(e){return typeof e=="string"&&e in this.logLevelThresholds}printLog(e,r){r.prepareForPrint();let n=e===24?"error":this.getLogLevelNameFromNumber(e).toLowerCase();this.console[n](JSON.stringify(r.getAttributes(),this.getReplacer(),this.logIndentation))}processLogItem(e,r,n){this.shouldPrint(e)&&this.printLog(e,this.createAndPopulateLogItem(e,r,n))}setConsole(){this.getEnvVarsService().isDevMode()?this.console=console:this.console=new Ip.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new Mp.EnvironmentVariablesService}setInitialLogLevel(e){let r=e?.toUpperCase();if(this.isValidLogLevel(r)){this.logLevel=this.logLevelThresholds[r];return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=this.logLevelThresholds[n];return}let i=this.getEnvVarsService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(i)){this.logLevel=this.logLevelThresholds[i];return}}setLogEvent(){this.getEnvVarsService().getLogEvent()&&(this.logEvent=!0)}setLogFormatter(e){this.logFormatter=e||new Np.PowertoolLogFormatter}setLogIndentation(){this.getEnvVarsService().isDevMode()&&(this.logIndentation=4)}setLogsSampled(){let e=this.getSampleRateValue();this.logsSampled=e!==void 0&&(e===1||(0,qp.randomInt)(0,100)/100<=e)}setOptions(e){let{logLevel:r,serviceName:n,sampleRateValue:i,logFormatter:s,customConfigService:a,persistentLogAttributes:o,environment:u}=e;return this.setEnvVarsService(),this.setConsole(),this.setCustomConfigService(a),this.setInitialLogLevel(r),this.setSampleRateValue(i),this.setLogsSampled(),this.setLogFormatter(s),this.setPowertoolLogData(n,u),this.setLogEvent(),this.setLogIndentation(),this.addPersistentLogAttributes(o),this}setPowertoolLogData(e,r,n={}){this.addToPowertoolLogData({awsRegion:this.getEnvVarsService().getAwsRegion(),environment:r||this.getCustomConfigService()?.getCurrentEnvironment()||this.getEnvVarsService().getCurrentEnvironment(),sampleRateValue:this.getSampleRateValue(),serviceName:e||this.getCustomConfigService()?.getServiceName()||this.getEnvVarsService().getServiceName()||this.getDefaultServiceName()},n)}};He.Logger=Dn});var jn=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.IDEMPOTENCY_KEY=Z.LOGGER_KEY=Z.METRICS_KEY=Z.TRACER_KEY=void 0;var lr="powertools-for-aws",Dp=`${lr}.tracer`;Z.TRACER_KEY=Dp;var $p=`${lr}.metrics`;Z.METRICS_KEY=$p;var jp=`${lr}.logger`;Z.LOGGER_KEY=jp;var Bp=`${lr}.idempotency`;Z.IDEMPOTENCY_KEY=Bp});var Ea=f(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.cleanupMiddlewares=void 0;var fr=jn(),Fp=t=>typeof t=="function",Up=async t=>{let e=[fr.TRACER_KEY,fr.METRICS_KEY,fr.LOGGER_KEY,fr.IDEMPOTENCY_KEY];for(let r of e)if(Object(t.internal).hasOwnProperty(r)){let n=t.internal[r];Fp(n)&&await n(t)}};dr.cleanupMiddlewares=Up});var Bn=f(ve=>{"use strict";var Vp=ve&&ve.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Sa=ve&&ve.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Vp(e,t,r)};Object.defineProperty(ve,"__esModule",{value:!0});Sa(Ea(),ve);Sa(jn(),ve)});var wa=f(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.injectLambdaContext=void 0;var Ta=$n(),Gp=Bn(),Hp=(t,e)=>{let r=t instanceof Array?t:[t],n=[],i=e&&e.clearState===!0,s=u=>{u.internal={...u.internal,[Gp.LOGGER_KEY]:o}},a=async u=>{r.forEach((c,l)=>{i&&(n[l]={...c.getPersistentLogAttributes()},s(u)),Ta.Logger.injectLambdaContextBefore(c,u.event,u.context,e)})},o=async()=>{i&&r.forEach((u,c)=>{Ta.Logger.injectLambdaContextAfterOrOnError(u,n[c],e)})};return{before:a,after:o,onError:o}};hr.injectLambdaContext=Hp});var Aa=f(xe=>{"use strict";var kp=xe&&xe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Wp=xe&&xe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&kp(e,t,r)};Object.defineProperty(xe,"__esModule",{value:!0});Wp(wa(),xe)});var gn=f(ee=>{"use strict";var Xp=ee&&ee.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),pr=ee&&ee.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xp(e,t,r)};Object.defineProperty(ee,"__esModule",{value:!0});pr(ms(),ee);pr($n(),ee);pr(Aa(),ee);pr(Zt(),ee)});var Ra=f(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.createTracer=void 0;var Kp=Fn(),Yp=(t={})=>new Kp.Tracer(t);gr.createTracer=Yp});var La=f(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0})});var Ca=f(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.EnvironmentVariablesService=void 0;var zp=Be(),Un=class extends zp.EnvironmentVariablesService{constructor(){super(...arguments),this.awsExecutionEnv="AWS_EXECUTION_ENV",this.samLocalVariable="AWS_SAM_LOCAL",this.tracerCaptureErrorVariable="POWERTOOLS_TRACER_CAPTURE_ERROR",this.tracerCaptureHTTPsRequestsVariable="POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",this.tracerCaptureResponseVariable="POWERTOOLS_TRACER_CAPTURE_RESPONSE",this.tracingEnabledVariable="POWERTOOLS_TRACE_ENABLED"}getAwsExecutionEnv(){return this.get(this.awsExecutionEnv)}getCaptureHTTPsRequests(){return this.get(this.tracerCaptureHTTPsRequestsVariable)}getSamLocal(){return this.get(this.samLocalVariable)}getTracingCaptureError(){return this.get(this.tracerCaptureErrorVariable)}getTracingCaptureResponse(){return this.get(this.tracerCaptureResponseVariable)}getTracingEnabled(){return this.get(this.tracingEnabledVariable)}};mr.EnvironmentVariablesService=Un});var Ia=f(_e=>{"use strict";var Qp=_e&&_e.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),qa=_e&&_e.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Qp(e,t,r)};Object.defineProperty(_e,"__esModule",{value:!0});qa(La(),_e);qa(Ca(),_e)});var Ma=f((mE,Pa)=>{"use strict";function Vn(t){return typeof t=="function"}var j=console.error.bind(console);function lt(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function ft(t){t&&t.logger&&(Vn(t.logger)?j=t.logger:j("new logger isn't a function, not replacing"))}function xa(t,e,r){if(!t||!t[e]){j("no original function "+e+" to wrap");return}if(!r){j("no wrapper function"),j(new Error().stack);return}if(!Vn(t[e])||!Vn(r)){j("original object and wrapper must be functions");return}var n=t[e],i=r(n,e);return lt(i,"__original",n),lt(i,"__unwrap",function(){t[e]===i&&lt(t,e,n)}),lt(i,"__wrapped",!0),lt(t,e,i),i}function Jp(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{j("must provide one or more modules to patch"),j(new Error().stack);return}if(!(e&&Array.isArray(e))){j("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(i){xa(n,i,r)})})}function Na(t,e){if(!t||!t[e]){j("no function to unwrap."),j(new Error().stack);return}if(!t[e].__unwrap)j("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function Zp(t,e){if(t)Array.isArray(t)||(t=[t]);else{j("must provide one or more modules to patch"),j(new Error().stack);return}if(!(e&&Array.isArray(e))){j("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){Na(r,n)})})}ft.wrap=xa;ft.massWrap=Jp;ft.unwrap=Na;ft.massUnwrap=Zp;Pa.exports=ft});var Fa=f((vE,Ba)=>{"use strict";var $a=Ma(),ke=$a.wrap,vr=$a.unwrap,ae="wrap@before";function _r(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function eg(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n],s=t[ae];if(typeof s=="function")s(i);else if(Array.isArray(s))for(var a=s.length,o=0;o<a;o++)s[o](i)}}function ja(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function tg(t,e,r){var n=ja(t,e),i=n.filter(function(s){return r.indexOf(s)===-1});i.length>0&&eg(t,i)}function Da(t,e){if(t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}Ba.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(a){return function(u,c){var l=ja(this,u).slice();try{var d=a.call(this,u,c);return tg(this,u,l),d}finally{this.on.__wrapped||ke(this,"on",i),this.addListener.__wrapped||ke(this,"addListener",i)}}}function s(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Da(c,n)}}}ke(this,"removeListener",l);try{return this._events[u]=Da(c,n),a.apply(this,arguments)}finally{vr(this,"removeListener"),this._events[u]=c}}}e[ae]?typeof e[ae]=="function"?_r(e,ae,[e[ae],r]):Array.isArray(e[ae])&&e[ae].push(r):_r(e,ae,r),e.__wrapped||(ke(e,"addListener",i),ke(e,"on",i),ke(e,"emit",s),_r(e,"__unwrap",function(){vr(e,"addListener"),vr(e,"on"),vr(e,"emit"),delete e[ae],delete e.__wrapped}),_r(e,"__wrapped",!0))}});var Ha=f((_E,Ga)=>{"use strict";var y=require("util"),oe=require("assert"),rg=Fa(),A=require("async_hooks"),dt="cls@contexts",ht="error@context",q=process.env.DEBUG_CLS_HOOKED,b=-1;Ga.exports={getNamespace:Ua,createNamespace:ng,destroyNamespace:Va,reset:ig,ERROR_SYMBOL:ht};function k(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}k.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,q){let n=" ".repeat(this._indent<0?0:this._indent);O(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+b+" active:"+y.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};k.prototype.get=function(e){if(!this.active){if(q){let r=A.currentId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${b} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(q){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(i+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+b+" active:"+y.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),O(`${i}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${b} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${y.inspect(this.active)}`)}return this.active[e]};k.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=b,q){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${b} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${y.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};k.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(q){let n=A.triggerAsyncId(),i=A.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);O(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${b} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${y.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[ht]=r),n}finally{if(q){let n=A.triggerAsyncId(),i=A.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);O(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${b} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${y.inspect(r)}`)}this.exit(r)}};k.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};k.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return q&&O("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+b+" len:"+this._set.length+" "+y.inspect(r)),n.then(i=>(q&&O("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+b+" len:"+this._set.length+" "+y.inspect(r)),this.exit(r),i)).catch(i=>{throw i[ht]=r,q&&O("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+b+" len:"+this._set.length+" "+y.inspect(r)),this.exit(r),i})};k.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[ht]=r),s}finally{n.exit(r)}}};k.prototype.enter=function(e){if(oe.ok(e,"context must be provided for entering"),q){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${b} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${y.inspect(e)}`)}this._set.push(this.active),this.active=e};k.prototype.exit=function(e){if(oe.ok(e,"context must be provided for exiting"),q){let n=A.executionAsyncId(),i=A.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);O(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${b} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${y.inspect(e)}`)}if(this.active===e){oe.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(q&&O("??ERROR?? context exiting but not entered - ignoring: "+y.inspect(e)),oe.ok(r>=0,`context not currently entered; can't exit. 
`+y.inspect(this)+`
`+y.inspect(e))):(oe.ok(r,"can't remove top context"),this._set.splice(r,1))};k.prototype.bindEmitter=function(e){oe.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){a&&(a[dt]||(a[dt]=Object.create(null)),a[dt][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[dt]))return a;let o=a,u=a[dt];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}rg(e,i,s)};k.prototype.fromException=function(e){return e[ht]};function Ua(t){return process.namespaces[t]}function ng(t){oe.ok(t,"namespace must be given a name."),q&&O(`NS-CREATING NAMESPACE (${t})`);let e=new k(t);return e.id=b,A.createHook({init(n,i,s,a){if(b=A.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),q){let o=" ".repeat(e._indent<0?0:e._indent);O(`${o}INIT [${i}] (${t}) asyncId:${n} currentUid:${b} triggerId:${s} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(b===0){let o=A.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(n,u),q){let c=" ".repeat(e._indent<0?0:e._indent);O(`${c}INIT USING CONTEXT FROM TRIGGERID [${i}] (${t}) asyncId:${n} currentUid:${b} triggerId:${o} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(q){let c=" ".repeat(e._indent<0?0:e._indent);O(`${c}INIT MISSING CONTEXT [${i}] (${t}) asyncId:${n} currentUid:${b} triggerId:${o} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(q&&i==="PROMISE"){O(y.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);O(`${u}INIT RESOURCE-PROMISE [${i}] (${t}) parentId:${o} asyncId:${n} currentUid:${b} triggerId:${s} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){b=A.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(b),i){if(q){let s=A.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);O(`${a}BEFORE (${t}) asyncId:${n} currentUid:${b} triggerId:${s} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${y.inspect(i)}`),e._indent+=2}e.enter(i)}else if(q){let s=A.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);O(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${b} triggerId:${s} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${y.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){b=A.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(b),i){if(q){let s=A.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);O(`${a}AFTER (${t}) asyncId:${n} currentUid:${b} triggerId:${s} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${y.inspect(i)}`)}e.exit(i)}else if(q){let s=A.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);O(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${b} triggerId:${s} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${y.inspect(i)}`)}},destroy(n){if(b=A.executionAsyncId(),q){let i=A.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);O(`${s}DESTROY (${t}) currentUid:${b} asyncId:${n} triggerId:${i} active:${y.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${y.inspect(e._contexts.get(b))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function Va(t){let e=Ua(t);oe.ok(e,`can't delete nonexistent namespace! "`+t+'"'),oe.ok(e.id,"don't assign to process.namespaces directly! "+y.inspect(e)),process.namespaces[t]=null}function ig(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Va(t)}),process.namespaces=Object.create(null)}process.namespaces={};function O(...t){q&&process._rawDebug(`${y.format(...t)}`)}});var L=f((bE,Xa)=>{"use strict";var Gn=["debug","info","warn","error","silent"],ka=Gn.indexOf("error"),sg=ag(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),Wa={error:br("error"),info:br("info"),warn:br("warn"),debug:br("debug")};function br(t){var e=Gn.indexOf(t),r=console[t]||console.log||(()=>{});return e>=sg?(n,i)=>{(n||i)&&r(cg(t,n,i))}:()=>{}}function ag(t){if(t){var e=t.toLowerCase(),r=Gn.indexOf(e);return r>=0?r:ka}return ka}function og(t){var e=-t.getTimezoneOffset(),r=e>=0?"+":"-",n=function(i){var s=Math.floor(Math.abs(i));return(s<10?"0":"")+s};return new Date(t.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+r+n(e/60)+":"+n(e%60)}function ug(){return process.env.LAMBDA_TASK_ROOT!==void 0}function cg(t,e,r){var n=[];ug()||(n.push(og(new Date)),n.push(`[${t.toUpperCase()}]`)),e&&n.push(e);var i=n.join(" "),s=lg(r);return[i,s].filter(a=>a.length>0).join(`
  `)}function lg(t){return t?typeof t=="string"?t:JSON.stringify(t):""}var fg={setLogger:function(e){Wa=e},getLogger:function(){return Wa}};Xa.exports=fg});var Hn=f((yE,Ya)=>{"use strict";var dg=require("crypto");function Ka(t,e){this.init(t,e)}Ka.prototype.init=function(e,r){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!r,this.id=dg.randomBytes(8).toString("hex"),n.stack){var i=n.stack.split(`
`);i.shift(),i.forEach(s=>{var a=s.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,u=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:o||"anonymous"};this.stack.push(c)},this)}};Ya.exports=Ka});var Qa=f((EE,za)=>{za.exports=hg;function hg(t){var e=!1,r=null,n=null,i=null;return a;function s(o){i&&mg(i,o),e=!1,i=n;var u=r;if(r=null,n=null,!u||!u.length){if(!i||!i.length){i=null;return}u||(u=[])}e=!0,t(u,s)}function a(o,u){e?(r||(r=[],n=[]),pg(r,o),u&&n.push(u)):(u&&(i=[u]),e=!0,t(Array.isArray(o)?o:[o],s))}}function pg(t,e){Array.isArray(e)?gg(t,e):t.push(e)}function gg(t,e){for(var r=0;r<e.length;r++)t.push(e[r])}function mg(t,e){for(var r=0;r<t.length;r++)t[r](e)}});var yr=f((SE,eo)=>{"use strict";var Ja=L(),K={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?Ja.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(Za(e),Ja.getLogger().info("Configured daemon address to "+e+"."))}},Za=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var r=e.split(" ");if(r.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");K.udp_ip=n[0],K.tcp_ip=n[0],K.udp_port=n[1],K.tcp_port=n[1]}else if(r.length===2){var i=r[0].split(":"),s=r[1].split(":"),a={};if(a[i[0]]=i,a[s[0]]=s,K.udp_ip=a.udp[1],K.udp_port=parseInt(a.udp[2]),K.tcp_ip=a.tcp[1],K.tcp_port=parseInt(a.tcp[2]),!K.udp_port||!K.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&Za(process.env.AWS_XRAY_DAEMON_ADDRESS);eo.exports=K});var Sr=f((TE,ao)=>{"use strict";var no=require("dgram"),vg=Qa(),Er=L(),to='{"format":"json","version":1}',ro=`
`;function _g(t,e){var r=no.createSocket("udp4");io(r,t,0,function(){try{r.close()}finally{e()}})}function io(t,e,r,n){if(r>=e.length){n();return}bg(t,e[r],function(){io(t,e,r+1,n)})}function bg(t,e,r){var n=e.msg,i=e.offset,s=e.length,a=e.port,o=e.address,u=e.callback;t.send(n,i,s,a,o,function(c){try{u(c)}finally{r()}})}function so(){this.batchSend=vg(_g)}so.prototype.send=function(t,e,r,n,i,s){var a={msg:t,offset:e,length:r,port:n,address:i,callback:s};this.batchSend(a)};var yg={daemonConfig:yr(),format:function(e){return to+ro+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new so:this.socket=no.createSocket("udp4").unref());var r=this.socket,n=e.format(),i=to+ro+n,s=Buffer.from(i),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";r.send(s,0,s.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?Er.getLogger().error(o+" too large to send: "+a+" ("+s.length+" bytes)."):Er.getLogger().error("Error occured sending segment: ",u):(Er.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),Er.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};ao.exports=yg});var wr=f((wE,oo)=>{"use strict";var Eg=require("crypto"),Tr=L(),kn=class t{constructor(e,r){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=r||Eg.randomBytes(12).toString("hex")}static Invalid(){return new t("00000000","000000000000000000000000")}static FromString(e){let r="-";var n=new t,i,s;if(!e||typeof e!="string")return Tr.getLogger().error("Empty or non-string trace ID provided"),n;let a=e.trim().split(r);return a.length!==3?(Tr.getLogger().error("Unrecognized trace ID format"),n):(i=parseInt(a[0]),isNaN(i)||i<1?(Tr.getLogger().error("Trace ID version must be positive integer"),n):(s=parseInt(a[1],16).toString(16),s==="NaN"?(Tr.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(n.version=i,n.timestamp=s,n.id=a[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};oo.exports=kn});var M=f((AE,uo)=>{"use strict";var Sg=require("crypto"),pt=L(),Tg=wr(),Wn={getCauseTypeFromHttpStatus:function(e){var r=e.toString();if(r.match(/^[4][0-9]{2}$/)!==null)return"error";if(r.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,r){if(e===void 0||r===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,i=r.length,s=e.indexOf("*");if(e=e.toLowerCase(),r=r.toLowerCase(),s===-1||s===n-1){var a=function(){for(var p=0,h=0;h<n;h++){var C=e.charAt(h);if(C==="*")return!0;if(C==="?"){if(p===i)return!1;p++}else{if(p>=i||C!=r.charAt(p))return!1;p++}}return p===i};return a()}var o=[];o[0]=!0;for(var u=0;u<n;u++){var c,l=e.charAt(u);if(l!="*")for(c=i-1;c>=0;c--)o[c+1]=!!o[c]&&(l==="?"||l===r.charAt(c));else{for(c=0;c<=i&&!o[c];)c++;for(c;c<=i;c++)o[c]=!0}o[0]=o[0]&&l==="*"}return o[i]},LambdaUtils:{validTraceData:function(t){var e=!1;if(t){var r=Wn.processTraceData(t);e=!!(r&&r.root&&r.parent&&r.sampled)}return e},populateTraceData:function(t,e){pt.getLogger().debug("Lambda trace data found: "+e);let r=Wn.processTraceData(e);var n=!1;return r?!r.root||!r.parent||!r.sampled?pt.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(r={},pt.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),t.trace_id=Tg.FromString(r.root).toString(),t.id=r.parent||Sg.randomBytes(8).toString("hex"),r.root&&t.trace_id!==r.root&&(pt.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(r.sampled)?delete t.notTraced:t.notTraced=!0,r.data&&(t.userData=r.data),pt.getLogger().debug("Segment started: "+JSON.stringify(r)),n}},processTraceData:function(e){var r={},n={},i=["root","parent","sampled","self"],s=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let u=o[0].trim(),c=o[1].trim(),l=u.toLowerCase(),d=i.indexOf(l)!==-1;d?r[l]=c:!d&&s-(l.length+c.length)>=0&&(n[u]=c,s-=u.length+c.length)}}}),r.data=n),r},objectWithoutProperties:function(e,r,n){r=Array.isArray(r)?r:[],n=typeof n=="boolean"?n:!1;var i=n?Object.create(Object.getPrototypeOf(e)):{};for(var s in e)r.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i},safeParseInt:t=>!t||isNaN(t)?0:parseInt(t)};uo.exports=Wn});var be=f((RE,fo)=>{"use strict";var{safeParseInt:co}=M(),lo=L(),wg=100,Xn={streamingThreshold:wg,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(Xn.streamingThreshold=e,lo.getLogger().debug("Subsegment streaming threshold set to: "+e)):lo.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return Xn.streamingThreshold},getHttpResponseData:t=>{let e={};if(!t)return e;let r=co(t.statusCode);return r!==0&&(e.status=r),t.headers&&t.headers["content-length"]&&(e.content_length=co(t.headers["content-length"])),e}};fo.exports=Xn});var go=f((OE,po)=>{"use strict";var{getHttpResponseData:Ag}=be(),{stripQueryStringFromPath:Rg}=M();function ho(t,e,r){this.init(t,e,r)}ho.prototype.init=function(e,r,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+Rg(e.path):"",method:e.method||""},n&&(this.request.traced=!0),r&&(this.response=Ag(r))};po.exports=ho});var gt=f((LE,mo)=>{"use strict";var Og=require("crypto"),Lg=Hn(),Cg=go(),qg=Sr(),Kn=be(),Ig=M(),ue=L();function E(t){this.init(t)}E.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=Og.randomBytes(8).toString("hex"),this.name=e,this.start_time=Kn.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};E.prototype.addNewSubsegment=function(e){let r=new E(e);return this.addSubsegment(r),r};E.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};E.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new E(e);return this.addSubsegment(r),r.notTraced=!0,r};E.prototype.addSubsegment=function(t){if(!(t instanceof E))throw new Error("Failed to add subsegment:"+t+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),t.segment=this.segment,t.parent=this,t.notTraced=t.parent.notTraced,t.end_time===void 0&&this.incrementCounter(t.counter),this.subsegments.push(t)};E.prototype.removeSubsegment=function(e){if(!(e instanceof E))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};E.prototype.addAttribute=function(e,r){this[e]=r};E.prototype.addPrecursorId=function(t){typeof t!="string"&&ue.getLogger().error("Failed to add id:"+t+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(t)};E.prototype.addAnnotation=function(t,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){ue.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof t!="string"){ue.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[t]=e};E.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){ue.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){ue.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};E.prototype.addSqlData=function(e){this.sql=e};E.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){ue.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new Lg(e,r))};E.prototype.addRemoteRequestData=function(e,r,n){this.http=new Cg(e,r,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};E.prototype.addFaultFlag=function(){this.fault=!0};E.prototype.addErrorFlag=function(){this.error=!0};E.prototype.addThrottleFlag=function(){this.throttle=!0};E.prototype.close=function(e,r){var n=this.segment;this.end_time=Kn.getCurrentTime(),delete this.in_progress,e&&this.addError(e,r),this.parent&&this.parent.decrementCounter(),n&&n.counter>Kn.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};E.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};E.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};E.prototype.isClosed=function(){return!this.in_progress};E.prototype.flush=function(){if(!this.parent||!this.segment){ue.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?qg.send(this):ue.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):ue.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};E.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(r){r.streamSubsegments()||e.push(r)}),this.subsegments=e}};E.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),JSON.stringify(this)};E.prototype.toString=function(){return JSON.stringify(this)};E.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=Ig.objectWithoutProperties(this,e,!1);return r};mo.exports=E});var mt=f((CE,bo)=>{"use strict";var xg=require("crypto"),Ng=Hn(),Pg=Sr(),Y=be(),Ar=gt(),vo=wr(),_o=M(),ye=L();function S(t,e,r){this.init(t,e,r)}S.prototype.init=function(e,r,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var i;r&&typeof r=="string"?i=vo.FromString(r):i=new vo;var s=xg.randomBytes(8).toString("hex"),a=Y.getCurrentTime();this.trace_id=i.toString(),this.id=s,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),Y.serviceData&&this.setServiceData(Y.serviceData),Y.pluginData&&this.addPluginData(Y.pluginData),Y.origin&&(this.origin=Y.origin),Y.sdkData&&this.setSDKData(Y.sdkData)};S.prototype.addIncomingRequestData=function(e){this.http=e};S.prototype.addAnnotation=function(e,r){if(typeof r!="boolean"&&typeof r!="string"&&!isFinite(r)){ye.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){ye.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=r};S.prototype.setUser=function(t){typeof t!="string"&&ye.getLogger().error("Set user: "+t+" failed. User IDs must be of type string."),this.user=t};S.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){ye.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){ye.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};S.prototype.setSDKData=function(e){if(!e){ye.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};S.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};S.prototype.setServiceData=function(e){if(!e){ye.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};S.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};S.prototype.addNewSubsegment=function(e){var r=new Ar(e);return this.addSubsegment(r),r};S.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};S.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new Ar(e);return this.addSubsegment(r),r.notTraced=!0,r};S.prototype.addSubsegment=function(e){if(!(e instanceof Ar))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};S.prototype.removeSubsegment=function(e){if(!(e instanceof Ar))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};S.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){ye.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new Ng(e,r))};S.prototype.addFaultFlag=function(){this.fault=!0};S.prototype.addErrorFlag=function(){this.error=!0};S.prototype.addThrottleFlag=function(){this.throttle=!0};S.prototype.isClosed=function(){return!this.in_progress};S.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>Y.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var r=[];this.subsegments.forEach(function(n){n.streamSubsegments()||r.push(n)}),this.subsegments=r}};S.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};S.prototype.close=function(t,e){this.end_time||(this.end_time=Y.getCurrentTime()),t!==void 0&&this.addError(t,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};S.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=_o.objectWithoutProperties(this,["counter","notTraced"],!0);Pg.send(e)}};S.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=_o.objectWithoutProperties(this,e,!1);return JSON.stringify(r)};S.prototype.toString=function(){return JSON.stringify(this)};bo.exports=S});var Te=f((qE,To)=>{"use strict";var vt=Ha(),te=L(),Yn=mt(),yo=gt(),Ee=!0,Se="AWSXRay",Eo="segment",So=!1,D={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var r=new Error(e);te.getLogger().error(r.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!D.isAutomaticMode()){var r=e.XRaySegment||e.XraySegment,n=e.Segment,i=null;return r&&(r instanceof Yn||r instanceof yo)?(i=r,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof Yn||n instanceof yo)&&(i=n,delete e.Segment),i}},getNamespace:function(){return vt.getNamespace(Se)||vt.createNamespace(Se)},resolveSegment:function(e){if(Ee)return this.getSegment();if(e&&!Ee)return e;!e&&!Ee&&D.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(Ee){var e=D.getNamespace(Se).get(Eo);return e?e instanceof Yn&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():D.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else D.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){Ee?D.getNamespace(Se).set(Eo,e)||te.getLogger().warn("Failed to set the current sub/segment on the context."):D.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return Ee},enableAutomaticMode:function(){Ee=!0,D.getNamespace(Se),te.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){Ee=!1,vt.getNamespace(Se)&&vt.destroyNamespace(Se),te.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(So)te.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var r=D.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(r)D.contextMissingStrategy.contextMissing=r.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?te.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):te.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(D.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")D.contextMissingStrategy.contextMissing=e,te.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};vt.createNamespace(Se);te.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default).");process.env.AWS_XRAY_CONTEXT_MISSING?(D.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),So=!0):(D.contextMissingStrategy.contextMissing=D.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,te.getLogger().debug("Using default context missing strategy: LOG_ERROR"));To.exports=D});var Qn=f((IE,wo)=>{"use strict";var{getHttpResponseData:Mg}=be();function zn(t){this.init(t)}zn.prototype.init=function(e){var r=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:Dg(e)||"",url:n||""},r&&(this.request.x_forwarded_for=r)};var Dg=function(e){var r;return e.headers["x-forwarded-for"]?r=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?r=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?r=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(r=e.connection.socket.remoteAddress),r};zn.prototype.close=function(e){this.response=Mg(e)};wo.exports=zn});var Ro=f((xE,Ao)=>{"use strict";function Jn(t,e){this.init(t,e)}Jn.prototype.init=function(e,r){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof r=="number"&&r>=0&&r<=1)this.fallbackRate=r;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};Jn.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Ao.exports=Jn});var Oo=f((NE,$g)=>{$g.exports={default:{fixed_target:1,rate:.05},version:2}});var ei=f((PE,xo)=>{"use strict";var jg=require("fs"),Lo=Ro(),Zn=M(),Bg=Oo(),Rr=L(),qo={shouldSample:function(e){var r=e.host,n=e.httpMethod,i=e.urlPath,s="{ http_method: "+n+", host: "+r+", url_path: "+i+" }",a;return this.rules.some(function(o){if(o.default||r==null||Zn.wildcardMatch(o.host,r)&&(n==null||Zn.wildcardMatch(o.http_method,n))&&(i==null||Zn.wildcardMatch(o.url_path,i)))return a=o.reservoir,Rr.getLogger().debug("Local sampling rule match found for "+s+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(Rr.getLogger().debug("No sampling rule matched for "+s),!1)},setLocalRules:function(e){e?typeof e=="string"?(Rr.getLogger().info("Using custom sampling rules file: "+e),this.rules=Co(JSON.parse(jg.readFileSync(e,"utf8")))):(Rr.getLogger().info("Using custom sampling rules source."),this.rules=Co(e)):this.rules=Io(Bg)}},Co=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Io(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Io=function(e){var r,n=[];if(e.default){var i=[];for(var s in e.default){if(s!=="fixed_target"&&s!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+s+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[s]!="number")throw new Error("Error in sampling file. Default "+s+" must be a number.")}if(typeof e.default.fixed_target>"u"&&i.push("fixed_target"),typeof e.default.rate>"u"&&i.push("rate"),i.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+i+".");r={default:!0,reservoir:new Lo(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in a){var l=a[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(o[c]=l),e.version===1&&c==="service_name"?o.host=l:o[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(u)+".");var d=o;d.reservoir=new Lo(a.fixed_target,a.rate),n.push(d)}),n.push(r),n};qo.setLocalRules();xo.exports=qo});var Po=f((ME,No)=>{"use strict";function We(){this.init()}We.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};We.prototype.borrowOrTake=function(e,r){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(r)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};We.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};We.prototype.loadNewQuota=function(e,r,n){e&&(this.quota=e),r&&(this.TTL=r),n&&(this.reportInterval=n/10)};We.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};No.exports=We});var Do=f((DE,Mo)=>{"use strict";var _t=M(),Fg=Po();function x(t,e,r,n,i,s,a,o,u){this.init(t,e,r,n,i,s,a,o,u)}x.prototype.init=function(e,r,n,i,s,a,o,u,c){this.name=e,this.priority=r,this.rate=n,this.host=s,this.httpMethod=a,this.urlPath=o,this.serviceName=u,this.serviceType=c,this.reservoir=new Fg,this.borrow=!!i,this.resetStatistics()};x.prototype.match=function(e){var r=e.host,n=e.httpMethod,i=e.serviceName,s=e.urlPath,a=e.serviceType;return this.isDefault()||(!r||_t.wildcardMatch(this.host,r))&&(!n||_t.wildcardMatch(this.httpMethod,n))&&(!i||_t.wildcardMatch(this.serviceName,i))&&(!s||_t.wildcardMatch(this.urlPath,s))&&(!a||_t.wildcardMatch(this.serviceType,a))};x.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};x.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};x.prototype.isDefault=function(){return this.name==="Default"};x.prototype.incrementRequestCount=function(){this.requestCount++};x.prototype.incrementBorrowCount=function(){this.borrowCount++};x.prototype.incrementSampledCount=function(){this.sampledCount++};x.prototype.setRate=function(e){this.rate=e};x.prototype.getRate=function(){return this.rate};x.prototype.getName=function(){return this.name};x.prototype.getPriority=function(){return this.priority};x.prototype.getReservoir=function(){return this.reservoir};x.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};x.prototype.canBorrow=function(){return this.borrow};x.prototype.everMatched=function(){return this.requestCount>0};x.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Mo.exports=x});var ti=f(($E,Fo)=>{"use strict";var Ug=require("crypto"),Vg=L(),Gg=Do(),Or=yr(),Hg=require("util"),kg=require("http"),jo={clientId:Ug.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:Vg,httpClient:kg,fetchSamplingRules:function(e){let r="{}",n=$o(this.samplingRulesPath,r.length),s=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,a=>{var o="";a.on("data",u=>{o+=u}),a.on("error",u=>{e(u)}),a.on("end",()=>{var u;try{u=JSON.parse(o)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=Xg(u);e(null,c)})});s.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),s.write(r),s.end()},fetchTargets:function(e,r){let n=JSON.stringify(Wg(e)),i=$o(this.samplingTargetsPath,n.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(i,o=>{var u="";o.on("data",c=>{u+=c}),o.on("error",c=>{r(c)}),o.on("end",()=>{var c;try{c=JSON.parse(u)}catch(p){r(p);return}if(!c||typeof c.LastRuleModification!="number"){r(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=Kg(c),d=Bo(c.LastRuleModification);r(null,l,d)})});a.on("error",()=>{r(new Error(`Failed to connect to X-Ray daemon at ${i.hostname}:${i.port} to get sampling targets.`))}),a.write(n),a.end()}},Wg=function(e){var r=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(i){var s=i.snapshotStatistics(),a={RuleName:i.getName(),ClientID:jo.clientId,RequestCount:s.requestCount,BorrowCount:s.borrowCount,SampledCount:s.sampledCount,Timestamp:n};r.push(a)}),{SamplingStatisticsDocuments:r}},Xg=function(e){var r=[],n=e.SamplingRuleRecords||[];return n.forEach(function(i){if(i=i.SamplingRule,Yg(i)){var s=new Gg(i.RuleName,i.Priority,i.FixedRate,i.ReservoirSize,i.Host,i.HTTPMethod,i.URLPath,i.ServiceName,i.ServiceType);r.push(s)}}),r},Kg=function(e){var r=e.SamplingTargetDocuments||[],n={};return r.forEach(function(i){var s={rate:i.FixedRate,quota:i.ReservoirQuota,TTL:Bo(i.ReservoirQuotaTTL),interval:i.Interval};n[i.RuleName]=s}),n},Yg=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Bo=function(e){return new Date(e).getTime()/1e3},$o=function(e,r){return{hostname:Or.tcp_ip,port:Or.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":r,Host:Hg.format("%s:%d",Or.tcp_ip,Or.tcp_port)}}};Fo.exports=jo});var Lr=f((jE,Uo)=>{"use strict";var zg=3600,ri={rules:[],lastUpdated:null,getMatchedRule:function(e,r){if(Qg(r))return null;var n;return this.rules.forEach(function(i){!n&&i.match(e)&&(n=i),i.isDefault()&&!n&&(n=i)}),n},loadRules:function(e){var r={};this.rules.forEach(function(n){r[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var i=r[n.getName()];i&&n.merge(i)}),this.rules.sort(function(n,i){var s=n.getPriority()-i.getPriority();return s!==0?s:n.getName()>i.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(r){var n=e[r.getName()];n&&(r.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),r.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},Qg=function(e){return ri.getLastUpdated()?e>ri.getLastUpdated()+zg:!0};Uo.exports=ri});var ii=f((BE,ko)=>{"use strict";var ni=L(),Jg=ti(),Vo=Lr(),Zg=5*60*1e3,em={start:function(){this.poller&&clearInterval(this.poller),Go(!1),this.poller=setInterval(Go,Zg),this.poller.unref()}},Go=function(e){if(e=typeof e>"u"?!0:e,e){var r=rm();setTimeout(Ho,r)}else Ho()},Ho=function(){try{tm()}catch(e){ni.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},tm=function(){var e=Math.floor(new Date().getTime()/1e3);Jg.fetchSamplingRules(function(r,n){r?ni.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",r):n.length!==0&&(Vo.loadRules(n),Vo.timestamp(e),ni.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},rm=function(){return Math.random()*5};ko.exports=em});var Yo=f((FE,Ko)=>{"use strict";var nm=ii(),im=ti(),si=Lr(),Cr=L(),Wo=10*1e3,Xo={interval:Wo,start:function(){this.poller=setInterval(sm,Wo+um()),this.poller.unref()}},sm=function(){try{am()}catch(e){Cr.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},am=function(){var e=om();e&&e.length>0&&im.fetchTargets(e,function(r,n,i){if(r){Cr.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",r);return}si.loadTargets(n),i>si.getLastUpdated()&&(Cr.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),nm.start()),Cr.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},om=function(){var e=si.getRules(),r=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&r.push(n)}),r},um=function(){return Math.random()/Xo.interval};Ko.exports=Xo});var Qo=f((UE,zo)=>{"use strict";var ai=L(),cm=require("util"),lm=be(),fm={localSampler:ei(),rulePoller:ii(),targetPoller:Yo(),ruleCache:Lr(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=lm.origin);var r=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,r);return n?(ai.getLogger().debug(cm.format("Rule %s is matched.",n.getName())),dm(n,r)):(ai.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(i){ai.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+i)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},dm=function(e,r){e.incrementRequestCount();var n=e.getReservoir(),i=!0,s=n.borrowOrTake(r,e.canBorrow());return s==="borrow"?e.incrementBorrowCount():s==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():i=!1,i?e.getName():!1};zo.exports=fm});var ui=f((VE,Jo)=>{"use strict";var hm=mt(),pm=Qn(),gm=L(),mm=M(),vm=M().wildcardMatch,_m=M().processTraceData,oi="x-amzn-trace-id",bm=!!process.env.AWS_XRAY_TRACING_NAME,ym={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:Qo(),enableDynamicNaming:function(t){if(this.dynamicNaming=!0,t&&typeof t!="string")throw new Error("Host pattern must be a string.");this.hostPattern=t||null},processHeaders:function(e){var r={};return e&&e.headers&&e.headers[oi]&&(r=_m(e.headers[oi])),r},resolveName:function(e){var r;return this.dynamicNaming&&e?r=this.hostPattern?vm(this.hostPattern,e)?e:this.defaultName:e:r=this.defaultName,r},resolveSampling:function(e,r,n){var i;if(e.sampled==="1")i=!0;else if(e.sampled==="0")i=!1;else{var s={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:r.name};i=this.sampler.shouldSample(s),(i instanceof String||typeof i=="string")&&(r.setMatchedSamplingRule(i),i=!0)}e.sampled==="?"&&(n.header[oi]="Root="+e.root+";Sampled="+(i?"1":"0")),i||(r.notTraced=!0)},setDefaultName:function(e){bm||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=ei()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,r,n){gm.getLogger().debug(e+": { url: "+r+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,r){var n=this.processHeaders(e),i=this.resolveName(e.headers.host),s=new hm(i,n.root,n.parent),a=Object.assign({},r,{req:e});this.resolveSampling(n,s,a),s.addIncomingRequestData(new pm(e)),this.middlewareLog("Starting middleware segment",e.url,s);var o=this.middlewareLog,u=!1,c=function(){if(u)return;u=!0,r.statusCode===429&&s.addThrottleFlag();let l=mm.getCauseTypeFromHttpStatus(r.statusCode);l&&(s[l]=!0),s.http.close(r),s.close(),o("Closed middleware segment successfully",e.url,s)};return r.on("finish",c),r.on("close",c),s}};Jo.exports=ym});var tu=f((GE,eu)=>{"use strict";var qr=Te(),Em=ui(),ci=M().LambdaUtils,Sm=mt(),Tm=Sr(),wm=be(),fi=L(),Zo=wr(),li=null;eu.exports.init=function(){qr.enableManualMode=function(){fi.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Tm.disableReusableSocket(),wm.setStreamingThreshold(0),fi.getLogger().info("Disabling centralized sampling in Lambda environment."),Em.disableCentralizedSampling();var e=qr.getNamespace();e.enter(e.createContext()),qr.setSegment(Am())};var Am=function(){var e=new Sm("facade"),r=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],i=process.env._X_AMZN_TRACE_ID;for(var s in e)typeof e[s]=="function"&&r.indexOf(s)===-1&&(n.indexOf(s)===-1?e[s]=function(){var a=s;return function(){fi.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[s]=function(){});return e.trace_id=Zo.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=Zo.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){var o=process.env._X_AMZN_TRACE_ID;o?o!=li&&(this.reset(),ci.populateTraceData(e,o)&&(li=o)):(this.reset(),qr.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},ci.validTraceData(i)&&ci.populateTraceData(e,i)&&(li=i),e}});var ru=f((HE,Rm)=>{Rm.exports={name:"aws-xray-sdk-core",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/service-error-classification":"^3.4.1","@aws-sdk/types":"^3.4.1","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.3.8"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov && codecov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var su=f((kE,iu)=>{"use strict";var di=require("http"),nu={METADATA_TIMEOUT:1e3,getPluginMetadata:function(t,e){var i=5,s=function(){var a=di.__request?di.__request:di.request,o=a(t,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else i>0&&Math.floor(this.statusCode/100)===5?(i--,setTimeout(s,250)):e(new Error(`Failed to retrieve metadata with options: ${t}`))})});o.on("error",function(u){e(u)}),o.on("timeout",function(){o.abort()}),o.setTimeout(nu.METADATA_TIMEOUT),o.end()};s()}};iu.exports=nu});var lu=f((WE,cu)=>{"use strict";var ou=su(),au=L(),hi=require("http"),Om={getData:function(t){let e="/latest/dynamic/instance-identity/document";function r(n){let i=uu(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});ou.getPluginMetadata(i,function(s,a){if(s||!a){au.getLogger().error("Error loading EC2 plugin metadata: ",s?s.toString():"Could not retrieve data from IMDS."),t();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};t(o)})}Lm(function(n){n===null&&au.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),r(n)})},originName:"AWS::EC2::Instance"};function Lm(t){let e=hi.__request?hi.__request:hi.request,i=uu("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),s=e(i,function(a){let o="";a.on("data",function(u){o+=u}),a.on("end",function(){this.statusCode===200||this.statusCode===300?t(o):t(null)})});s.on("error",function(){t(null)}),s.on("timeout",function(){s.abort(),t(null)}),s.setTimeout(ou.METADATA_TIMEOUT),s.end()}function uu(t,e,r){return e||(e="GET"),r||(r={}),{host:"169.254.169.254",path:t,method:e,headers:r}}cu.exports=Om});var du=f((XE,fu)=>{"use strict";var Cm=require("os"),qm={getData:function(t){t({ecs:{container:Cm.hostname()}})},originName:"AWS::ECS::Container"};fu.exports=qm});var pu=f((KE,hu)=>{"use strict";var Im=require("fs"),xm=L(),Nm="/var/elasticbeanstalk/xray/environment.conf",Pm={getData:function(t){Im.readFile(Nm,"utf8",function(e,r){if(e)xm.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),t();else{var n=JSON.parse(r),i={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};t(i)}})},originName:"AWS::ElasticBeanstalk::Environment"};hu.exports=Pm});var gu=f((YE,Mm)=>{Mm.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Eu=f((zE,yu)=>{"use strict";var _u=require("fs"),Xe=L(),Dm=gu(),Ir={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function Nr(t){this.init(t)}Nr.prototype.init=function(e){e?typeof e=="string"?(Xe.getLogger().info("Using custom AWS whitelist file: "+e),this.services=xr(JSON.parse(_u.readFileSync(e,"utf8")))):(Xe.getLogger().info("Using custom AWS whitelist source."),this.services=xr(e)):this.services=Dm.services};Nr.prototype.append=function(e){var r={};typeof e=="string"?(Xe.getLogger().info("Appending AWS whitelist with custom file: "+e),r=xr(JSON.parse(_u.readFileSync(e,"utf8")))):(Xe.getLogger().info("Appending AWS whitelist with a custom source."),r=xr(e));for(var n in r)this.services[n]=r[n]};Nr.prototype.capture=function(e,r){var n=r.request.operation,i=this.services[e]!==void 0?this.services[e].operations[n]:null;if(i===null){Xe.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var s={};for(var a in i){var o=i[a];a===Ir.REQ_PARAMS?mu(o,r.request.params,s):a===Ir.REQ_DESC?vu(o,r.request.params,s):a===Ir.RES_PARAMS?r.data&&mu(o,r.data,s):a===Ir.RES_DESC?r.data&&vu(o,r.data,s):Xe.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return s};function mu(t,e,r){t.forEach(function(n){if(typeof e[n]<"u"){var i=bu(n);this[i]=e[n]}},r)}function vu(t,e,r){for(var n in t){var i=t[n];if(typeof e[n]<"u"){var s;if(i.list&&i.get_count?s=e[n]?e[n].length:0:s=i.get_keys===!0?Object.keys(e[n]):e[n],typeof i.rename_to=="string")r[i.rename_to]=s;else{var a=bu(n);r[a]=s}}}}function bu(t){return t==="IPAddress"?"ip_address":t.split(/(?=[A-Z])/).join("_").toLowerCase()}function xr(t){var e=t;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}yu.exports=Nr});var bt=f((QE,Pr)=>{"use strict";var Su=Eu(),pi=new Su;function gi(t,e){this.init(t,e)}gi.prototype.init=function(e,r){this.operation=Bm(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&r&&r.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),r&&this.addData(pi.capture(r.toLowerCase(),e))};gi.prototype.addData=function(e){for(var r in e)this[r]=e[r]};var $m=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");pi=new Su(e)},jm=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");pi.append(e)};function Bm(t){if(t)return t.charAt(0).toUpperCase()+t.slice(1)}Pr.exports=gi;Pr.exports.appendAWSWhitelist=jm;Pr.exports.setAWSWhitelist=$m});var Dr=f((JE,Mr)=>{"use strict";var Ne=Te(),yt=L(),Tu=function(e,r,n){mi(e,r);var i,s,a=Ne.resolveSegment(n);if(!a)return yt.getLogger().warn("Failed to capture function."),r();i=a.addNewSubsegment(e),s=wu(r,i);try{let o=s(i);return i.close(),o}catch(o){throw i.close(o),o}},Fm=function(e,r,n){mi(e,r);var i,s,a=Ne.resolveSegment(n);if(!a)return yt.getLogger().warn("Failed to capture async function."),r();i=a.addNewSubsegment(e),s=wu(r,i);try{return s(i)}catch(o){throw i.close(o),o}},Um=function(e,r,n){mi(e,r);var i=Ne.resolveSegment(n);return i?(i.incrementCounter(),function(){var s=Ne.resolveSegment(n),a=Array.prototype.slice.call(arguments);Tu(e,r.bind.apply(r,[null].concat(a)),s),i.decrementCounter()}.bind(this)):(yt.getLogger().warn("Failed to capture callback function."),r)};function wu(t,e){var r;if(Ne.isAutomaticMode()){var n=Ne.getNamespace(),i=function(){var s;return n.run(function(){Ne.setSegment(e),s=t(e)}),s};r=i}else r=t;return r}function mi(t,e){var r;if(!t||typeof t!="string")throw r='Param "name" must be a non-empty string.',yt.getLogger().error(r),new Error(r);if(typeof e!="function")throw r='Param "fcn" must be a function.',yt.getLogger().error(r),new Error(r)}Mr.exports.captureFunc=Tu;Mr.exports.captureAsyncFunc=Fm;Mr.exports.captureCallbackFunc=Um});var Et=f((ZE,Au)=>{var Vm="2.0.0",Gm=Number.MAX_SAFE_INTEGER||9007199254740991,Hm=16,km=256-6,Wm=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Au.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Hm,MAX_SAFE_BUILD_LENGTH:km,MAX_SAFE_INTEGER:Gm,RELEASE_TYPES:Wm,SEMVER_SPEC_VERSION:Vm,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var St=f((eS,Ru)=>{var Xm=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Ru.exports=Xm});var Ke=f((ce,Ou)=>{var{MAX_SAFE_COMPONENT_LENGTH:vi,MAX_SAFE_BUILD_LENGTH:Km,MAX_LENGTH:Ym}=Et(),zm=St();ce=Ou.exports={};var Qm=ce.re=[],Jm=ce.safeRe=[],g=ce.src=[],m=ce.t={},Zm=0,_i="[a-zA-Z0-9-]",ev=[["\\s",1],["\\d",Ym],[_i,Km]],tv=t=>{for(let[e,r]of ev)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},v=(t,e,r)=>{let n=tv(e),i=Zm++;zm(t,i,e),m[t]=i,g[i]=e,Qm[i]=new RegExp(e,r?"g":void 0),Jm[i]=new RegExp(n,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","\\d+");v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${_i}*`);v("MAINVERSION",`(${g[m.NUMERICIDENTIFIER]})\\.(${g[m.NUMERICIDENTIFIER]})\\.(${g[m.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${g[m.NUMERICIDENTIFIERLOOSE]})\\.(${g[m.NUMERICIDENTIFIERLOOSE]})\\.(${g[m.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${g[m.NUMERICIDENTIFIER]}|${g[m.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${g[m.NUMERICIDENTIFIERLOOSE]}|${g[m.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${g[m.PRERELEASEIDENTIFIER]}(?:\\.${g[m.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${g[m.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${g[m.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER",`${_i}+`);v("BUILD",`(?:\\+(${g[m.BUILDIDENTIFIER]}(?:\\.${g[m.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${g[m.MAINVERSION]}${g[m.PRERELEASE]}?${g[m.BUILD]}?`);v("FULL",`^${g[m.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${g[m.MAINVERSIONLOOSE]}${g[m.PRERELEASELOOSE]}?${g[m.BUILD]}?`);v("LOOSE",`^${g[m.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${g[m.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${g[m.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${g[m.XRANGEIDENTIFIER]})(?:\\.(${g[m.XRANGEIDENTIFIER]})(?:\\.(${g[m.XRANGEIDENTIFIER]})(?:${g[m.PRERELEASE]})?${g[m.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${g[m.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[m.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[m.XRANGEIDENTIFIERLOOSE]})(?:${g[m.PRERELEASELOOSE]})?${g[m.BUILD]}?)?)?`);v("XRANGE",`^${g[m.GTLT]}\\s*${g[m.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${g[m.GTLT]}\\s*${g[m.XRANGEPLAINLOOSE]}$`);v("COERCE",`(^|[^\\d])(\\d{1,${vi}})(?:\\.(\\d{1,${vi}}))?(?:\\.(\\d{1,${vi}}))?(?:$|[^\\d])`);v("COERCERTL",g[m.COERCE],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${g[m.LONETILDE]}\\s+`,!0);ce.tildeTrimReplace="$1~";v("TILDE",`^${g[m.LONETILDE]}${g[m.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${g[m.LONETILDE]}${g[m.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${g[m.LONECARET]}\\s+`,!0);ce.caretTrimReplace="$1^";v("CARET",`^${g[m.LONECARET]}${g[m.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${g[m.LONECARET]}${g[m.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${g[m.GTLT]}\\s*(${g[m.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${g[m.GTLT]}\\s*(${g[m.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${g[m.GTLT]}\\s*(${g[m.LOOSEPLAIN]}|${g[m.XRANGEPLAIN]})`,!0);ce.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${g[m.XRANGEPLAIN]})\\s+-\\s+(${g[m.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${g[m.XRANGEPLAINLOOSE]})\\s+-\\s+(${g[m.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var $r=f((tS,Lu)=>{var rv=Object.freeze({loose:!0}),nv=Object.freeze({}),iv=t=>t?typeof t!="object"?rv:t:nv;Lu.exports=iv});var bi=f((rS,Iu)=>{var Cu=/^[0-9]+$/,qu=(t,e)=>{let r=Cu.test(t),n=Cu.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},sv=(t,e)=>qu(e,t);Iu.exports={compareIdentifiers:qu,rcompareIdentifiers:sv}});var $=f((nS,Mu)=>{var jr=St(),{MAX_LENGTH:xu,MAX_SAFE_INTEGER:Br}=Et(),{safeRe:Nu,t:Pu}=Ke(),av=$r(),{compareIdentifiers:Ye}=bi(),yi=class t{constructor(e,r){if(r=av(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>xu)throw new TypeError(`version is longer than ${xu} characters`);jr("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?Nu[Pu.LOOSE]:Nu[Pu.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Br||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Br||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Br||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<Br)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(jr("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),Ye(this.major,e.major)||Ye(this.minor,e.minor)||Ye(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],i=e.prerelease[r];if(jr("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ye(n,i)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],i=e.build[r];if(jr("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ye(n,i)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(r){let s=[r,i];n===!1&&(s=[r]),Ye(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Mu.exports=yi});var Pe=f((iS,$u)=>{var Du=$(),ov=(t,e,r=!1)=>{if(t instanceof Du)return t;try{return new Du(t,e)}catch(n){if(!r)return null;throw n}};$u.exports=ov});var Bu=f((sS,ju)=>{var uv=Pe(),cv=(t,e)=>{let r=uv(t,e);return r?r.version:null};ju.exports=cv});var Uu=f((aS,Fu)=>{var lv=Pe(),fv=(t,e)=>{let r=lv(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};Fu.exports=fv});var Hu=f((oS,Gu)=>{var Vu=$(),dv=(t,e,r,n,i)=>{typeof r=="string"&&(i=n,n=r,r=void 0);try{return new Vu(t instanceof Vu?t.version:t,r).inc(e,n,i).version}catch{return null}};Gu.exports=dv});var Xu=f((uS,Wu)=>{var ku=Pe(),hv=(t,e)=>{let r=ku(t,null,!0),n=ku(e,null,!0),i=r.compare(n);if(i===0)return null;let s=i>0,a=s?r:n,o=s?n:r,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u)return!o.patch&&!o.minor?"major":a.patch?"patch":a.minor?"minor":"major";let l=u?"pre":"";return r.major!==n.major?l+"major":r.minor!==n.minor?l+"minor":r.patch!==n.patch?l+"patch":"prerelease"};Wu.exports=hv});var Yu=f((cS,Ku)=>{var pv=$(),gv=(t,e)=>new pv(t,e).major;Ku.exports=gv});var Qu=f((lS,zu)=>{var mv=$(),vv=(t,e)=>new mv(t,e).minor;zu.exports=vv});var Zu=f((fS,Ju)=>{var _v=$(),bv=(t,e)=>new _v(t,e).patch;Ju.exports=bv});var tc=f((dS,ec)=>{var yv=Pe(),Ev=(t,e)=>{let r=yv(t,e);return r&&r.prerelease.length?r.prerelease:null};ec.exports=Ev});var W=f((hS,nc)=>{var rc=$(),Sv=(t,e,r)=>new rc(t,r).compare(new rc(e,r));nc.exports=Sv});var sc=f((pS,ic)=>{var Tv=W(),wv=(t,e,r)=>Tv(e,t,r);ic.exports=wv});var oc=f((gS,ac)=>{var Av=W(),Rv=(t,e)=>Av(t,e,!0);ac.exports=Rv});var Fr=f((mS,cc)=>{var uc=$(),Ov=(t,e,r)=>{let n=new uc(t,r),i=new uc(e,r);return n.compare(i)||n.compareBuild(i)};cc.exports=Ov});var fc=f((vS,lc)=>{var Lv=Fr(),Cv=(t,e)=>t.sort((r,n)=>Lv(r,n,e));lc.exports=Cv});var hc=f((_S,dc)=>{var qv=Fr(),Iv=(t,e)=>t.sort((r,n)=>qv(n,r,e));dc.exports=Iv});var Tt=f((bS,pc)=>{var xv=W(),Nv=(t,e,r)=>xv(t,e,r)>0;pc.exports=Nv});var Ur=f((yS,gc)=>{var Pv=W(),Mv=(t,e,r)=>Pv(t,e,r)<0;gc.exports=Mv});var Ei=f((ES,mc)=>{var Dv=W(),$v=(t,e,r)=>Dv(t,e,r)===0;mc.exports=$v});var Si=f((SS,vc)=>{var jv=W(),Bv=(t,e,r)=>jv(t,e,r)!==0;vc.exports=Bv});var Vr=f((TS,_c)=>{var Fv=W(),Uv=(t,e,r)=>Fv(t,e,r)>=0;_c.exports=Uv});var Gr=f((wS,bc)=>{var Vv=W(),Gv=(t,e,r)=>Vv(t,e,r)<=0;bc.exports=Gv});var Ti=f((AS,yc)=>{var Hv=Ei(),kv=Si(),Wv=Tt(),Xv=Vr(),Kv=Ur(),Yv=Gr(),zv=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return Hv(t,r,n);case"!=":return kv(t,r,n);case">":return Wv(t,r,n);case">=":return Xv(t,r,n);case"<":return Kv(t,r,n);case"<=":return Yv(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};yc.exports=zv});var Sc=f((RS,Ec)=>{var Qv=$(),Jv=Pe(),{safeRe:Hr,t:kr}=Ke(),Zv=(t,e)=>{if(t instanceof Qv)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(Hr[kr.COERCE]);else{let n;for(;(n=Hr[kr.COERCERTL].exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||n.index+n[0].length!==r.index+r[0].length)&&(r=n),Hr[kr.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;Hr[kr.COERCERTL].lastIndex=-1}return r===null?null:Jv(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,e)};Ec.exports=Zv});var wc=f((OS,Tc)=>{"use strict";Tc.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}});var Rc=f((LS,Ac)=>{"use strict";Ac.exports=_;_.Node=Me;_.create=_;function _(t){var e=this;if(e instanceof _||(e=new _),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(i){e.push(i)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}_.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};_.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};_.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};_.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)t_(this,arguments[t]);return this.length};_.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)r_(this,arguments[t]);return this.length};_.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};_.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};_.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};_.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};_.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};_.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};_.prototype.map=function(t,e){e=e||this;for(var r=new _,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};_.prototype.mapReverse=function(t,e){e=e||this;for(var r=new _,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};_.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;n!==null;i++)r=t(r,n.value,i),n=n.next;return r};_.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;n!==null;i--)r=t(r,n.value,i),n=n.prev;return r};_.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};_.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};_.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(;i!==null&&n<e;n++,i=i.next)r.push(i.value);return r};_.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,i=this.tail;i!==null&&n>e;n--)i=i.prev;for(;i!==null&&n>t;n--,i=i.prev)r.push(i.value);return r};_.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(var s=[],n=0;i&&n<e;n++)s.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var n=0;n<r.length;n++)i=e_(this,i,r[n]);return s};_.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function e_(t,e,r){var n=e===t.head?new Me(r,null,e,t):new Me(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function t_(t,e){t.tail=new Me(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function r_(t,e){t.head=new Me(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function Me(t,e,r,n){if(!(this instanceof Me))return new Me(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{wc()(_)}catch{}});var Ic=f((CS,qc)=>{"use strict";var n_=Rc(),De=Symbol("max"),fe=Symbol("length"),ze=Symbol("lengthCalculator"),At=Symbol("allowStale"),$e=Symbol("maxAge"),le=Symbol("dispose"),Oc=Symbol("noDisposeOnSet"),N=Symbol("lruList"),z=Symbol("cache"),Cc=Symbol("updateAgeOnGet"),wi=()=>1,Ri=class{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");let r=this[De]=e.max||1/0,n=e.length||wi;if(this[ze]=typeof n!="function"?wi:n,this[At]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[$e]=e.maxAge||0,this[le]=e.dispose,this[Oc]=e.noDisposeOnSet||!1,this[Cc]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[De]=e||1/0,wt(this)}get max(){return this[De]}set allowStale(e){this[At]=!!e}get allowStale(){return this[At]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[$e]=e,wt(this)}get maxAge(){return this[$e]}set lengthCalculator(e){typeof e!="function"&&(e=wi),e!==this[ze]&&(this[ze]=e,this[fe]=0,this[N].forEach(r=>{r.length=this[ze](r.value,r.key),this[fe]+=r.length})),wt(this)}get lengthCalculator(){return this[ze]}get length(){return this[fe]}get itemCount(){return this[N].length}rforEach(e,r){r=r||this;for(let n=this[N].tail;n!==null;){let i=n.prev;Lc(this,e,n,r),n=i}}forEach(e,r){r=r||this;for(let n=this[N].head;n!==null;){let i=n.next;Lc(this,e,n,r),n=i}}keys(){return this[N].toArray().map(e=>e.key)}values(){return this[N].toArray().map(e=>e.value)}reset(){this[le]&&this[N]&&this[N].length&&this[N].forEach(e=>this[le](e.key,e.value)),this[z]=new Map,this[N]=new n_,this[fe]=0}dump(){return this[N].map(e=>Wr(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[N]}set(e,r,n){if(n=n||this[$e],n&&typeof n!="number")throw new TypeError("maxAge must be a number");let i=n?Date.now():0,s=this[ze](r,e);if(this[z].has(e)){if(s>this[De])return Qe(this,this[z].get(e)),!1;let u=this[z].get(e).value;return this[le]&&(this[Oc]||this[le](e,u.value)),u.now=i,u.maxAge=n,u.value=r,this[fe]+=s-u.length,u.length=s,this.get(e),wt(this),!0}let a=new Oi(e,r,s,i,n);return a.length>this[De]?(this[le]&&this[le](e,r),!1):(this[fe]+=a.length,this[N].unshift(a),this[z].set(e,this[N].head),wt(this),!0)}has(e){if(!this[z].has(e))return!1;let r=this[z].get(e).value;return!Wr(this,r)}get(e){return Ai(this,e,!0)}peek(e){return Ai(this,e,!1)}pop(){let e=this[N].tail;return e?(Qe(this,e),e.value):null}del(e){Qe(this,this[z].get(e))}load(e){this.reset();let r=Date.now();for(let n=e.length-1;n>=0;n--){let i=e[n],s=i.e||0;if(s===0)this.set(i.k,i.v);else{let a=s-r;a>0&&this.set(i.k,i.v,a)}}}prune(){this[z].forEach((e,r)=>Ai(this,r,!1))}},Ai=(t,e,r)=>{let n=t[z].get(e);if(n){let i=n.value;if(Wr(t,i)){if(Qe(t,n),!t[At])return}else r&&(t[Cc]&&(n.value.now=Date.now()),t[N].unshiftNode(n));return i.value}},Wr=(t,e)=>{if(!e||!e.maxAge&&!t[$e])return!1;let r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[$e]&&r>t[$e]},wt=t=>{if(t[fe]>t[De])for(let e=t[N].tail;t[fe]>t[De]&&e!==null;){let r=e.prev;Qe(t,e),e=r}},Qe=(t,e)=>{if(e){let r=e.value;t[le]&&t[le](r.key,r.value),t[fe]-=r.length,t[z].delete(r.key),t[N].removeNode(e)}},Oi=class{constructor(e,r,n,i,s){this.key=e,this.value=r,this.length=n,this.now=i,this.maxAge=s||0}},Lc=(t,e,r,n)=>{let i=r.value;Wr(t,i)&&(Qe(t,r),t[At]||(i=void 0)),i&&e.call(n,i.value,i.key,t)};qc.exports=Ri});var X=f((qS,Mc)=>{var Li=class t{constructor(e,r){if(r=s_(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof Ci)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!Nc(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&d_(i[0])){this.set=[i];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&l_)|(this.options.loose&&f_))+":"+e,i=xc.get(n);if(i)return i;let s=this.options.loose,a=s?V[B.HYPHENRANGELOOSE]:V[B.HYPHENRANGE];e=e.replace(a,S_(this.options.includePrerelease)),R("hyphen replace",e),e=e.replace(V[B.COMPARATORTRIM],o_),R("comparator trim",e),e=e.replace(V[B.TILDETRIM],u_),R("tilde trim",e),e=e.replace(V[B.CARETTRIM],c_),R("caret trim",e);let o=e.split(" ").map(d=>h_(d,this.options)).join(" ").split(/\s+/).map(d=>E_(d,this.options));s&&(o=o.filter(d=>(R("loose invalid filter",d,this.options),!!d.match(V[B.COMPARATORLOOSE])))),R("range list",o);let u=new Map,c=o.map(d=>new Ci(d,this.options));for(let d of c){if(Nc(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return xc.set(n,l),l}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>Pc(n,r)&&e.set.some(i=>Pc(i,r)&&n.every(s=>i.every(a=>s.intersects(a,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new a_(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(T_(this.set[r],e,this.options))return!0;return!1}};Mc.exports=Li;var i_=Ic(),xc=new i_({max:1e3}),s_=$r(),Ci=Rt(),R=St(),a_=$(),{safeRe:V,t:B,comparatorTrimReplace:o_,tildeTrimReplace:u_,caretTrimReplace:c_}=Ke(),{FLAG_INCLUDE_PRERELEASE:l_,FLAG_LOOSE:f_}=Et(),Nc=t=>t.value==="<0.0.0-0",d_=t=>t.value==="",Pc=(t,e)=>{let r=!0,n=t.slice(),i=n.pop();for(;r&&n.length;)r=n.every(s=>i.intersects(s,e)),i=n.pop();return r},h_=(t,e)=>(R("comp",t,e),t=m_(t,e),R("caret",t),t=p_(t,e),R("tildes",t),t=__(t,e),R("xrange",t),t=y_(t,e),R("stars",t),t),F=t=>!t||t.toLowerCase()==="x"||t==="*",p_=(t,e)=>t.trim().split(/\s+/).map(r=>g_(r,e)).join(" "),g_=(t,e)=>{let r=e.loose?V[B.TILDELOOSE]:V[B.TILDE];return t.replace(r,(n,i,s,a,o)=>{R("tilde",t,n,i,s,a,o);let u;return F(i)?u="":F(s)?u=`>=${i}.0.0 <${+i+1}.0.0-0`:F(a)?u=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:o?(R("replaceTilde pr",o),u=`>=${i}.${s}.${a}-${o} <${i}.${+s+1}.0-0`):u=`>=${i}.${s}.${a} <${i}.${+s+1}.0-0`,R("tilde return",u),u})},m_=(t,e)=>t.trim().split(/\s+/).map(r=>v_(r,e)).join(" "),v_=(t,e)=>{R("caret",t,e);let r=e.loose?V[B.CARETLOOSE]:V[B.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(i,s,a,o,u)=>{R("caret",t,i,s,a,o,u);let c;return F(s)?c="":F(a)?c=`>=${s}.0.0${n} <${+s+1}.0.0-0`:F(o)?s==="0"?c=`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:u?(R("replaceCaret pr",u),s==="0"?a==="0"?c=`>=${s}.${a}.${o}-${u} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}-${u} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o}-${u} <${+s+1}.0.0-0`):(R("no pr"),s==="0"?a==="0"?c=`>=${s}.${a}.${o}${n} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o} <${+s+1}.0.0-0`),R("caret return",c),c})},__=(t,e)=>(R("replaceXRanges",t,e),t.split(/\s+/).map(r=>b_(r,e)).join(" ")),b_=(t,e)=>{t=t.trim();let r=e.loose?V[B.XRANGELOOSE]:V[B.XRANGE];return t.replace(r,(n,i,s,a,o,u)=>{R("xRange",t,n,i,s,a,o,u);let c=F(s),l=c||F(a),d=l||F(o),p=d;return i==="="&&p&&(i=""),u=e.includePrerelease?"-0":"",c?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&p?(l&&(a=0),o=0,i===">"?(i=">=",l?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",l?s=+s+1:a=+a+1),i==="<"&&(u="-0"),n=`${i+s}.${a}.${o}${u}`):l?n=`>=${s}.0.0${u} <${+s+1}.0.0-0`:d&&(n=`>=${s}.${a}.0${u} <${s}.${+a+1}.0-0`),R("xRange return",n),n})},y_=(t,e)=>(R("replaceStars",t,e),t.trim().replace(V[B.STAR],"")),E_=(t,e)=>(R("replaceGTE0",t,e),t.trim().replace(V[e.includePrerelease?B.GTE0PRE:B.GTE0],"")),S_=t=>(e,r,n,i,s,a,o,u,c,l,d,p,h)=>(F(n)?r="":F(i)?r=`>=${n}.0.0${t?"-0":""}`:F(s)?r=`>=${n}.${i}.0${t?"-0":""}`:a?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,F(c)?u="":F(l)?u=`<${+c+1}.0.0-0`:F(d)?u=`<${c}.${+l+1}.0-0`:p?u=`<=${c}.${l}.${d}-${p}`:t?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${r} ${u}`.trim()),T_=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(R(t[n].semver),t[n].semver!==Ci.ANY&&t[n].semver.prerelease.length>0){let i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var Rt=f((IS,Uc)=>{var Ot=Symbol("SemVer ANY"),xi=class t{static get ANY(){return Ot}constructor(e,r){if(r=Dc(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ii("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===Ot?this.value="":this.value=this.operator+this.semver.version,Ii("comp",this)}parse(e){let r=this.options.loose?$c[jc.COMPARATORLOOSE]:$c[jc.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Bc(n[2],this.options.loose):this.semver=Ot}toString(){return this.value}test(e){if(Ii("Comparator.test",e,this.options.loose),this.semver===Ot||e===Ot)return!0;if(typeof e=="string")try{e=new Bc(e,this.options)}catch{return!1}return qi(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Fc(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new Fc(this.value,r).test(e.semver):(r=Dc(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||qi(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||qi(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Uc.exports=xi;var Dc=$r(),{safeRe:$c,t:jc}=Ke(),qi=Ti(),Ii=St(),Bc=$(),Fc=X()});var Lt=f((xS,Vc)=>{var w_=X(),A_=(t,e,r)=>{try{e=new w_(e,r)}catch{return!1}return e.test(t)};Vc.exports=A_});var Hc=f((NS,Gc)=>{var R_=X(),O_=(t,e)=>new R_(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));Gc.exports=O_});var Wc=f((PS,kc)=>{var L_=$(),C_=X(),q_=(t,e,r)=>{let n=null,i=null,s=null;try{s=new C_(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new L_(n,r))}),n};kc.exports=q_});var Kc=f((MS,Xc)=>{var I_=$(),x_=X(),N_=(t,e,r)=>{let n=null,i=null,s=null;try{s=new x_(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new I_(n,r))}),n};Xc.exports=N_});var Qc=f((DS,zc)=>{var Ni=$(),P_=X(),Yc=Tt(),M_=(t,e)=>{t=new P_(t,e);let r=new Ni("0.0.0");if(t.test(r)||(r=new Ni("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let i=t.set[n],s=null;i.forEach(a=>{let o=new Ni(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||Yc(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!r||Yc(r,s))&&(r=s)}return r&&t.test(r)?r:null};zc.exports=M_});var Zc=f(($S,Jc)=>{var D_=X(),$_=(t,e)=>{try{return new D_(t,e).range||"*"}catch{return null}};Jc.exports=$_});var Xr=f((jS,nl)=>{var j_=$(),rl=Rt(),{ANY:B_}=rl,F_=X(),U_=Lt(),el=Tt(),tl=Ur(),V_=Gr(),G_=Vr(),H_=(t,e,r,n)=>{t=new j_(t,n),e=new F_(e,n);let i,s,a,o,u;switch(r){case">":i=el,s=V_,a=tl,o=">",u=">=";break;case"<":i=tl,s=G_,a=el,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(U_(t,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,p=null;if(l.forEach(h=>{h.semver===B_&&(h=new rl(">=0.0.0")),d=d||h,p=p||h,i(h.semver,d.semver,n)?d=h:a(h.semver,p.semver,n)&&(p=h)}),d.operator===o||d.operator===u||(!p.operator||p.operator===o)&&s(t,p.semver))return!1;if(p.operator===u&&a(t,p.semver))return!1}return!0};nl.exports=H_});var sl=f((BS,il)=>{var k_=Xr(),W_=(t,e,r)=>k_(t,e,">",r);il.exports=W_});var ol=f((FS,al)=>{var X_=Xr(),K_=(t,e,r)=>X_(t,e,"<",r);al.exports=K_});var ll=f((US,cl)=>{var ul=X(),Y_=(t,e,r)=>(t=new ul(t,r),e=new ul(e,r),t.intersects(e,r));cl.exports=Y_});var dl=f((VS,fl)=>{var z_=Lt(),Q_=W();fl.exports=(t,e,r)=>{let n=[],i=null,s=null,a=t.sort((l,d)=>Q_(l,d,r));for(let l of a)z_(l,e,r)?(s=l,i||(i=l)):(s&&n.push([i,s]),s=null,i=null);i&&n.push([i,null]);let o=[];for(let[l,d]of n)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var _l=f((GS,vl)=>{var hl=X(),Mi=Rt(),{ANY:Pi}=Mi,Ct=Lt(),Di=W(),J_=(t,e,r={})=>{if(t===e)return!0;t=new hl(t,r),e=new hl(e,r);let n=!1;e:for(let i of t.set){for(let s of e.set){let a=eb(i,s,r);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},Z_=[new Mi(">=0.0.0-0")],pl=[new Mi(">=0.0.0")],eb=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Pi){if(e.length===1&&e[0].semver===Pi)return!0;r.includePrerelease?t=Z_:t=pl}if(e.length===1&&e[0].semver===Pi){if(r.includePrerelease)return!0;e=pl}let n=new Set,i,s;for(let h of t)h.operator===">"||h.operator===">="?i=gl(i,h,r):h.operator==="<"||h.operator==="<="?s=ml(s,h,r):n.add(h.semver);if(n.size>1)return null;let a;if(i&&s){if(a=Di(i.semver,s.semver,r),a>0)return null;if(a===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let h of n){if(i&&!Ct(h,String(i),r)||s&&!Ct(h,String(s),r))return null;for(let C of e)if(!Ct(h,String(C),r))return!1;return!0}let o,u,c,l,d=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&s.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",i){if(p&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===p.major&&h.semver.minor===p.minor&&h.semver.patch===p.patch&&(p=!1),h.operator===">"||h.operator===">="){if(o=gl(i,h,r),o===h&&o!==i)return!1}else if(i.operator===">="&&!Ct(i.semver,String(h),r))return!1}if(s){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(u=ml(s,h,r),u===h&&u!==s)return!1}else if(s.operator==="<="&&!Ct(s.semver,String(h),r))return!1}if(!h.operator&&(s||i)&&a!==0)return!1}return!(i&&c&&!s&&a!==0||s&&l&&!i&&a!==0||p||d)},gl=(t,e,r)=>{if(!t)return e;let n=Di(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},ml=(t,e,r)=>{if(!t)return e;let n=Di(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};vl.exports=J_});var Sl=f((HS,El)=>{var $i=Ke(),bl=Et(),tb=$(),yl=bi(),rb=Pe(),nb=Bu(),ib=Uu(),sb=Hu(),ab=Xu(),ob=Yu(),ub=Qu(),cb=Zu(),lb=tc(),fb=W(),db=sc(),hb=oc(),pb=Fr(),gb=fc(),mb=hc(),vb=Tt(),_b=Ur(),bb=Ei(),yb=Si(),Eb=Vr(),Sb=Gr(),Tb=Ti(),wb=Sc(),Ab=Rt(),Rb=X(),Ob=Lt(),Lb=Hc(),Cb=Wc(),qb=Kc(),Ib=Qc(),xb=Zc(),Nb=Xr(),Pb=sl(),Mb=ol(),Db=ll(),$b=dl(),jb=_l();El.exports={parse:rb,valid:nb,clean:ib,inc:sb,diff:ab,major:ob,minor:ub,patch:cb,prerelease:lb,compare:fb,rcompare:db,compareLoose:hb,compareBuild:pb,sort:gb,rsort:mb,gt:vb,lt:_b,eq:bb,neq:yb,gte:Eb,lte:Sb,cmp:Tb,coerce:wb,Comparator:Ab,Range:Rb,satisfies:Ob,toComparators:Lb,maxSatisfying:Cb,minSatisfying:qb,minVersion:Ib,validRange:xb,outside:Nb,gtr:Pb,ltr:Mb,intersects:Db,simplifyRange:$b,subset:jb,SemVer:tb,re:$i.re,src:$i.src,tokens:$i.t,SEMVER_SPEC_VERSION:bl.SEMVER_SPEC_VERSION,RELEASE_TYPES:bl.RELEASE_TYPES,compareIdentifiers:yl.compareIdentifiers,rcompareIdentifiers:yl.rcompareIdentifiers}});var Bi=f((kS,ji)=>{"use strict";var Bb=Sl(),Fb=bt(),Je=Te(),Tl=M(),wl=L(),Al="2.7.15",Ub=function(){return!1},Vb=function(e){if(!Bb.gte(e.VERSION,Al))throw new Error("AWS SDK version "+Al+" or greater required.");for(var r in e)if(e[r].serviceIdentifier){var n=e[r];n.prototype.customizeRequests(Rl)}return e},Gb=function(e){return e.customizeRequests(Rl),e};function Rl(t){var e=Je.resolveSegment(Je.resolveManualSegmentParams(t.params));if(!e){var r=this.serviceIdentifier+"."+t.operation;return Je.isAutomaticMode()?wl.getLogger().info("Call "+r+" is missing the sub/segment context for automatic mode. Ignoring."):wl.getLogger().info("Call "+r+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),t}var n=this.throttledError||Ub,i=new Error().stack;let s;e.notTraced?s=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):s=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){let d="Root="+a+";Parent="+s.id+";Sampled="+(s.notTraced?"0":"1");if(o!=null)for(let[p,h]of Object.entries(o))d+=";"+p+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){s.addAttribute("namespace","aws"),s.addAttribute("aws",new Fb(l,s.name));var d=l.httpResponse;if(d&&(s.addAttribute("http",new Ol(d)),(d.statusCode===429||l.error&&n(l.error))&&s.addThrottleFlag()),l.error){var p={message:l.error.message,name:l.error.code,stack:i};d&&d.statusCode?(Tl.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&s.addErrorFlag(),s.close(p,!0)):s.close(p)}else{if(d&&d.statusCode){var h=Tl.getCauseTypeFromHttpStatus(d.statusCode);h&&(s[h]=!0)}s.close()}};t.on("beforePresign",function(l){e.removeSubsegment(s),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),t.on("build",u).on("complete",c),t.__send||(t.__send=t.send,t.send=function(l){if(Je.isAutomaticMode()){var d=Je.getNamespace();d.run(function(){Je.setSegment(s),t.__send(l)})}else t.__send(l)})}function Ol(t){this.init(t)}Ol.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};ji.exports.captureAWSClient=Gb;ji.exports.captureAWS=Vb});var Nl=f(Ze=>{"use strict";var Il=Ze&&Ze.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.captureAWSClient=void 0;var Hb=require("@aws-sdk/service-error-classification"),kb=Il(bt()),Wb=require("querystring"),Xb=Il(gt()),Fi=Te(),Ll=L(),{safeParseInt:Kr}=M(),Kb=M(),xl="XRaySDKInstrumentation",Cl=async(t,e,r,n,i)=>{var s,a,o;let{extendedRequestId:u,requestId:c,httpStatusCode:l,attempts:d}=((s=n?.output)===null||s===void 0?void 0:s.$metadata)||i?.$metadata,p=new kb.default({extendedRequestId:u,requestId:c,retryCount:d,request:{operation:e,httpRequest:{region:r,statusCode:l}}},t),h={};return l&&(h.response={},h.response.status=l),!((a=n?.response)===null||a===void 0)&&a.headers&&((o=n?.response)===null||o===void 0?void 0:o.headers["content-length"])!==void 0&&(h.response||(h.response={}),h.response.content_length=Kr(n.response.headers["content-length"])),[p,h]};function ql(t,e,r){var n,i,s;(r&&(0,Hb.isThrottlingError)(r)||Kr((n=t.response)===null||n===void 0?void 0:n.status)===429||Kr((i=r?.$metadata)===null||i===void 0?void 0:i.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,Kb.getCauseTypeFromHttpStatus)(Kr((s=t.response)===null||s===void 0?void 0:s.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var Yb=(t,e)=>(r,n)=>async i=>{let s=Fi.isAutomaticMode()?Fi.resolveSegment():e,{clientName:a,commandName:o}=n,u=o.slice(0,-7),c=a.slice(0,-6);if(!s){let h=c+"."+u.charAt(0).toLowerCase()+u.slice(1);return Fi.isAutomaticMode()?Ll.getLogger().info("Call "+h+" is missing the sub/segment context for automatic mode. Ignoring."):Ll.getLogger().info("Call "+h+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),r(i)}let l;s.notTraced?l=s.addNewSubsegmentWithoutSampling(c):l=s.addNewSubsegment(c),l.addAttribute("namespace","aws");let d=s instanceof Xb.default?s.segment:s;i.request.headers["X-Amzn-Trace-Id"]=(0,Wb.stringify)({Root:d.trace_id,Parent:l.id,Sampled:l.notTraced?"0":"1"},";");let p;try{if(p=await r(i),!p)throw new Error("Failed to get response from instrumented AWS Client.");let[h,C]=await Cl(c,u,await t.region(),p,null);return l.addAttribute("aws",h),l.addAttribute("http",C),ql(C,l),l.close(),p}catch(h){if(h.$metadata){let[T,Re]=await Cl(c,u,await t.region(),null,h);l.addAttribute("aws",T),l.addAttribute("http",Re),ql(Re,l,h)}let C={message:h.message,name:h.name,stack:h.stack||new Error().stack};throw l.close(C,!0),h}},zb={name:xl,step:"build"},Qb=(t,e)=>({applyToStack:r=>{r.add(Yb(t,e),zb)}});function Jb(t,e){return t.middlewareStack.remove(xl),t.middlewareStack.use(Qb(t.config,e)),t}Ze.captureAWSClient=Jb});var Vi=f((XS,Ui)=>{"use strict";var Pl=require("url"),et=Te(),Yr=M(),Ml=L(),Zb=require("events"),ey=function(e,r,n){e.__request||Dl(e,r,n)},ty=function(e,r,n){if(e.__request)return e;var i={};return Object.keys(e).forEach(function(s){i[s]=e[s]}),Dl(i,r,n),i};function Dl(t,e,r){function n(a,...o){let u,c,l,d,p=o[0];if(typeof o[1]=="object"?(l=!0,d=typeof p=="string"?new Pl.URL(p):p,u=o[1],c=o[2]):(l=!1,u=p,c=o[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return a(...o);typeof u=="string"&&(u=new Pl.URL(u)),l||(d=u);let h=et.resolveSegment(et.resolveManualSegmentParams(u)),C=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!h){let I="[ host: "+C;return I=u.method?I+", method: "+u.method:I,I+=", path: "+(d.pathname||Yr.stripQueryStringFromPath(u.path))+" ]",et.isAutomaticMode()?Ml.getLogger().info("Options for request "+I+" is missing the sub/segment context for automatic mode. Ignoring."):Ml.getLogger().info("Options for request "+I+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let T;h.notTraced?T=h.addNewSubsegmentWithoutSampling(C):T=h.addNewSubsegment(C);let Re=h.segment?h.segment:h;T.namespace="remote",u.headers||(u.headers={}),u.headers["X-Amzn-Trace-Id"]="Root="+Re.trace_id+";Parent="+T.id+";Sampled="+(T.notTraced?"0":"1");let rn=function(de){if(r&&r(T,this,null,de),T.http&&T.http.response)Yr.getCauseTypeFromHttpStatus(T.http.response.status)==="error"&&T.addErrorFlag(),T.close(de,!0);else{let mf=de.code!=="ECONNREFUSED";T.addRemoteRequestData(this,null,mf&&e),T.close(de)}},gf=Yr.objectWithoutProperties(u,["Segment"],!0),Yi=a(...l?[p,gf]:[u],function(I){I.on("end",function(){r&&r(T,this.req,I),I.statusCode===429&&T.addThrottleFlag();let de=Yr.getCauseTypeFromHttpStatus(I.statusCode);de&&(T[de]=!0),T.addRemoteRequestData(I.req,I,!!e),T.close()}),typeof c=="function"?et.isAutomaticMode()?et.getNamespace().run(function(){et.setSegment(T),c(I)}):c(I):I.req&&I.req.listenerCount("response")===0&&I.resume()});return Yi.on(Zb.errorMonitor||"error",rn),Yi}t.__request=t.request;function i(...a){return n(t.__request,...a)}t.__get=t.get;function s(...a){return n(t.__get,...a)}Object.defineProperties(t,{request:{value:i,configurable:!0,enumerable:!0,writable:!0},get:{value:s,configurable:!0,enumerable:!0,writable:!0}})}Ui.exports.captureHTTPsGlobal=ey;Ui.exports.captureHTTPs=ty});var Fl=f((KS,Gi)=>{"use strict";var qt=Te(),zr=Symbol("original then"),Qr=Symbol("original catch");function jl(t){let e=t.prototype.then;e[zr]||(t.prototype.then=function(n,i){if(qt.isAutomaticMode()&&$l()){let s=qt.getNamespace();n=n&&s.bind(n),i=i&&s.bind(i)}return e.call(this,n,i)},t.prototype.then[zr]=e);let r=t.prototype.catch;r&&!r[Qr]&&(t.prototype.catch=function(n){if(qt.isAutomaticMode()&&$l()){let i=qt.getNamespace();n=n&&i.bind(n)}return r.call(this,n)},t.prototype.catch[Qr]=r)}function ry(t){let e=t.prototype.then;e[zr]&&(t.prototype.then=e[zr]);let r=t.prototype.catch;r&&r[Qr]&&(t.prototype.catch=r[Qr])}function $l(){try{return qt.getSegment()}catch{return}}function Bl(){jl(Promise)}function ny(){ry(Promise)}Bl.patchThirdPartyPromise=jl;Gi.exports.capturePromise=Bl;Gi.exports.uncapturePromise=ny});var Gl=f((YS,Vl)=>{"use strict";function Ul(t,e,r,n,i){this.init(t,e,r,n,i)}Ul.prototype.init=function(e,r,n,i,s){e&&(this.database_version=e),r&&(this.driver_version=r),s&&(this.preparation=s),this.url=i,this.user=n};Vl.exports=Ul});var Wl=f((zS,kl)=>{"use strict";var we=Te(),Hi=L(),tt=be(),iy=M(),sy=tu(),xt={};try{xt=ru()}catch(t){Hi.getLogger().debug("Failed to load SDK data:",t)}var It="unknown",Hl={plugins:{EC2Plugin:lu(),ECSPlugin:du(),ElasticBeanstalkPlugin:pu()},config:function(t){var e={};t.forEach(function(r){r.getData(function(n){if(n)for(var i in n)e[i]=n[i]}),tt.setOrigin(r.originName),tt.setPluginData(e)})},setAWSWhitelist:bt().setAWSWhitelist,appendAWSWhitelist:bt().appendAWSWhitelist,setStreamingThreshold:tt.setStreamingThreshold,setLogger:Hi.setLogger,getLogger:Hi.getLogger,setDaemonAddress:yr().setDaemonAddress,captureFunc:Dr().captureFunc,captureAsyncFunc:Dr().captureAsyncFunc,captureCallbackFunc:Dr().captureCallbackFunc,captureAWS:Bi().captureAWS,captureAWSClient:Bi().captureAWSClient,captureAWSv3Client:Nl().captureAWSClient,captureHTTPs:Vi().captureHTTPs,captureHTTPsGlobal:Vi().captureHTTPsGlobal,capturePromise:Fl().capturePromise,utils:iy,database:{SqlData:Gl()},middleware:ui(),getNamespace:we.getNamespace,resolveSegment:we.resolveSegment,getSegment:we.getSegment,setSegment:we.setSegment,isAutomaticMode:we.isAutomaticMode,enableAutomaticMode:we.enableAutomaticMode,enableManualMode:we.enableManualMode,setContextMissingStrategy:we.setContextMissingStrategy,Segment:mt(),Subsegment:gt(),SegmentUtils:tt};Hl.middleware.IncomingRequestData=Qn(),function(){var t={runtime:process.release&&process.release.name?process.release.name:It,runtime_version:process.version,version:process.env.npm_package_version||It,name:process.env.npm_package_name||It},e={sdk:"X-Ray for Node.js",sdk_version:xt.version?xt.version:It,package:xt.name?xt.name:It};tt.setSDKData(e),tt.setServiceData(t),process.env.LAMBDA_TASK_ROOT&&sy.init()}();kl.exports=Hl});var ki=f((QS,Xl)=>{"use strict";Xl.exports=Wl()});var Kl=f(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.ProviderService=void 0;var U=ki(),ay=Be(),Wi=class{captureAWS(e){return(0,U.captureAWS)(e)}captureAWSClient(e){return(0,U.captureAWSClient)(e)}captureAWSv3Client(e){return(0,ay.addUserAgentMiddleware)(e,"tracer"),(0,U.captureAWSv3Client)(e)}captureAsyncFunc(e,r,n){return(0,U.captureAsyncFunc)(e,r)}captureFunc(e,r,n){return(0,U.captureFunc)(e,r)}captureHTTPsGlobal(){(0,U.captureHTTPsGlobal)(require("http")),(0,U.captureHTTPsGlobal)(require("https"))}getNamespace(){return(0,U.getNamespace)()}getSegment(){return(0,U.getSegment)()}putAnnotation(e,r){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(n instanceof U.Segment){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}n.addAnnotation(e,r)}putMetadata(e,r,n){let i=this.getSegment();if(i===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(i instanceof U.Segment){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}i.addMetadata(e,r,n)}setContextMissingStrategy(e){(0,U.setContextMissingStrategy)(e)}setDaemonAddress(e){(0,U.setDaemonAddress)(e)}setLogger(e){(0,U.setLogger)(e)}setSegment(e){(0,U.setSegment)(e)}};Jr.ProviderService=Wi});var zl=f(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0})});var Jl=f(Ae=>{"use strict";var oy=Ae&&Ae.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ql=Ae&&Ae.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&oy(e,t,r)};Object.defineProperty(Ae,"__esModule",{value:!0});Ql(Kl(),Ae);Ql(zl(),Ae)});var Zl=f(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.Tracer=void 0;var uy=Be(),cy=Ia(),ly=Jl(),fy=ki(),Xi=class extends uy.Utility{constructor(e={}){super(),this.captureError=!0,this.captureHTTPsRequests=!0,this.captureResponse=!0,this.tracingEnabled=!0,this.setOptions(e),this.provider=new ly.ProviderService,this.isTracingEnabled()&&this.captureHTTPsRequests&&this.provider.captureHTTPsGlobal(),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(e,r){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(e,r||!1)}}addResponseAsMetadata(e,r){e===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${r} response`,e)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(e){return this.isTracingEnabled()?this.provider.captureAWS(e):e}captureAWSClient(e){if(!this.isTracingEnabled())return e;try{return this.provider.captureAWSClient(e)}catch(r){try{return this.provider.captureAWSClient(e.service),e}catch{throw r}}}captureAWSv3Client(e){return this.isTracingEnabled()?this.provider.captureAWSv3Client(e):e}captureLambdaHandler(e){return(r,n,i)=>{let s=i.value,a=this;return i.value=function(o,u,c){let l=this;return a.isTracingEnabled()?a.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async d=>{a.annotateColdStart(),a.addServiceNameAnnotation();let p;try{p=await s.apply(l,[o,u,c]),(e?.captureResponse??!0)&&a.addResponseAsMetadata(p,process.env._HANDLER)}catch(h){throw a.addErrorAsMetadata(h),h}finally{d?.close(),d?.flush()}return p}):s.apply(l,[o,u,c])},i}}captureMethod(e){return(r,n,i)=>{let s=i.value,a=this;return i.value=function(...o){if(!a.isTracingEnabled())return s.apply(this,[...o]);let u=String(n),c=e?.subSegmentName?e.subSegmentName:`### ${u}`;return a.provider.captureAsyncFunc(c,async l=>{let d;try{d=await s.apply(this,[...o]),(e?.captureResponse??!0)&&a.addResponseAsMetadata(d,u)}catch(p){throw a.addErrorAsMetadata(p),p}finally{l?.close(),l?.flush()}return d})},i}}getRootXrayTraceId(){return this.envVarsService.getXrayTraceId()}getSegment(){if(!this.isTracingEnabled())return new fy.Subsegment("## Dummy segment");let e=this.provider.getSegment();return e===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),e}isTraceSampled(){return this.isTracingEnabled()?this.envVarsService.getXrayTraceSampled():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(e,r){this.isTracingEnabled()&&this.provider.putAnnotation(e,r)}putMetadata(e,r,n){this.isTracingEnabled()&&this.provider.putMetadata(e,r,n||this.serviceName)}setSegment(e){if(this.isTracingEnabled())return this.provider.setSegment(e)}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}isAmplifyCli(){return this.getEnvVarsService().getAwsExecutionEnv()==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return this.getEnvVarsService().getAwsExecutionEnv()!==""}isLambdaSamCli(){return this.getEnvVarsService().getSamLocal()!==""}setCaptureError(){let e=this.getCustomConfigService()?.getTracingCaptureError();if(e!==void 0&&e.toLowerCase()==="false"){this.captureError=!1;return}if(this.getEnvVarsService().getTracingCaptureError().toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(e){if(e!==void 0&&!e){this.captureHTTPsRequests=!1;return}let r=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(r!==void 0&&r.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}if(this.getEnvVarsService().getCaptureHTTPsRequests().toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}}setCaptureResponse(){let e=this.getCustomConfigService()?.getTracingCaptureResponse();if(e!==void 0&&e.toLowerCase()==="false"){this.captureResponse=!1;return}if(this.getEnvVarsService().getTracingCaptureResponse().toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new cy.EnvironmentVariablesService}setOptions(e){let{enabled:r,serviceName:n,captureHTTPsRequests:i,customConfigService:s}=e;return this.setEnvVarsService(),this.setCustomConfigService(s),this.setTracingEnabled(r),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(e){if(e!==void 0&&this.isValidServiceName(e)){this.serviceName=e;return}let r=this.getCustomConfigService()?.getServiceName();if(r!==void 0&&this.isValidServiceName(r)){this.serviceName=r;return}let n=this.getEnvVarsService().getServiceName();if(n!==void 0&&this.isValidServiceName(n)){this.serviceName=n;return}this.serviceName=this.getDefaultServiceName()}setTracingEnabled(e){if(e!==void 0&&!e){this.tracingEnabled=e;return}let r=this.getCustomConfigService()?.getTracingEnabled();if(r!==void 0&&r.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(this.getEnvVarsService().getTracingEnabled().toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};Zr.Tracer=Xi});var tf=f(ef=>{"use strict";Object.defineProperty(ef,"__esModule",{value:!0})});var rf=f(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.captureLambdaHandler=void 0;var dy=Bn(),hy=(t,e)=>{let r,n,i=l=>{l.internal={...l.internal,[dy.TRACER_KEY]:a}},s=()=>{let l=t.getSegment();l!==void 0&&(r=l,n=r.addNewSubsegment(`## ${process.env._HANDLER}`),t.setSegment(n))},a=()=>{n===void 0||r===null||(n.close(),t.setSegment(r))};return{before:async l=>{t.isTracingEnabled()&&(s(),i(l),t.annotateColdStart(),t.addServiceNameAnnotation())},after:async l=>{t.isTracingEnabled()&&((e?.captureResponse??!0)&&t.addResponseAsMetadata(l.response,process.env._HANDLER),a())},onError:async l=>{t.isTracingEnabled()&&(t.addErrorAsMetadata(l.error),a())}}};en.captureLambdaHandler=hy});var Fn=f(re=>{"use strict";var py=re&&re.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),tn=re&&re.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&py(e,t,r)};Object.defineProperty(re,"__esModule",{value:!0});tn(Ra(),re);tn(Zl(),re);tn(tf(),re);tn(rf(),re)});var my={};zi(my,{handler:()=>gy});module.exports=nn(my);var uf=nt(os()),cf=require("@aws-sdk/credential-provider-node"),lf=require("@aws-sdk/protocol-http"),ff=require("@aws-sdk/signature-v4"),df=nt(gs()),hf=require("url");var nf=nt(pn()),sf=nt(gn()),af=nt(Fn()),of="asset-tracker",rt=new sf.Logger({serviceName:of,logLevel:"DEBUG",persistentLogAttributes:{logger:{version:nf.PT_VERSION,name:"@aws-lambda-powertools/logger"}}}),s0=new af.Tracer({serviceName:of});var Ki=class extends Error{constructor(e){let r=e.map(n=>`${n.errorType}: ${n.message}`).join(`
`);super(r),this.name="AppSyncError"}},pf=async t=>{let e=process.env.GRAPHQL_URL;if(!e)throw new Error("GRAPHQL_URL env var is not set");let r=new hf.URL(e);rt.debug("Executing GraphQL operation",{details:t});let n=new lf.HttpRequest({hostname:r.hostname,path:r.pathname,body:JSON.stringify(t),method:"POST",headers:{"Content-Type":"application/json",host:r.hostname}}),i=new ff.SignatureV4({credentials:(0,cf.defaultProvider)(),service:"appsync",region:process.env.AWS_REGION,sha256:uf.Sha256}),{headers:s,body:a,method:o}=await i.sign(n);try{let u=await(0,df.default)({url:e,headers:s,data:a,method:o,timeout:5e3,parse:"json"});if(u.body.errors)throw new Ki(u.body.errors);if(u.body.data===void 0)throw new Error("AppSync returned an empty response");return rt.debug("Operation executed",{details:u.body.data}),u.body.data}catch(u){throw rt.error("Failed to execute GraphQL operation",u),u}};var gy=async t=>{rt.debug("Received event",{event:t});let e={query:`mutation UpdatePosition($input: PositionEventInput) {
      updatePosition(input: $input) {
        deviceId
        lng
        lat
        sampleTime
        receivedTime
        trackerName
        type
        accuracy {
          horizontal
        }
        metadata {
          batteryLevel
        }
      }
    }`,operationName:"UpdatePosition",variables:{input:{deviceId:t.detail.DeviceId,lng:t.detail.Position[0],lat:t.detail.Position[1],sampleTime:new Date(t.detail.SampleTime).toISOString(),receivedTime:new Date(t.detail.ReceivedTime).toISOString(),trackerName:t.detail.TrackerName,type:t.detail.EventType,...t.detail.Accuracy&&{accuracy:{horizontal:t.detail.Accuracy.Horizontal}},...t.detail.PositionProperties&&{metadata:{batteryLevel:t.detail.PositionProperties.batteryLevel}}}}};await pf(e)};0&&(module.exports={handler});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
//# sourceMappingURL=index.js.map
