"use strict";var wl=Object.create;var Lt=Object.defineProperty;var Cl=Object.getOwnPropertyDescriptor;var Ll=Object.getOwnPropertyNames;var Ol=Object.getPrototypeOf,Il=Object.prototype.hasOwnProperty;var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ql=(t,e)=>{for(var r in e)Lt(t,r,{get:e[r],enumerable:!0})},Li=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ll(e))!Il.call(t,i)&&i!==r&&Lt(t,i,{get:()=>e[i],enumerable:!(n=Cl(e,i))||n.enumerable});return t};var kr=(t,e,r)=>(r=t!=null?wl(Ol(t)):{},Li(e||!t||!t.__esModule?Lt(r,"default",{value:t,enumerable:!0}):r,t)),Nl=t=>Li(Lt({},"__esModule",{value:!0}),t);var Gr=d(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.PT_VERSION=void 0;Ot.PT_VERSION="1.11.1"});var Oi=d(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.createLogger=void 0;var xl=Wr(),Pl=(t={})=>new xl.Logger(t);It.createLogger=Pl});var qi=d(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0})});var Ni=d(Te=>{"use strict";var Ml=Te&&Te.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),$l=Te&&Te.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ml(e,t,r)};Object.defineProperty(Te,"__esModule",{value:!0});$l(qi(),Te)});var xi=d(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.Utility=void 0;var Xr=class{constructor(){this.coldStart=!0,this.defaultServiceName="service_undefined"}getColdStart(){return this.coldStart?(this.coldStart=!1,!0):!1}isColdStart(){return this.getColdStart()}getDefaultServiceName(){return this.defaultServiceName}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};qt.Utility=Xr});var Pi=d(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.ConfigService=void 0;var Hr=class{};Nt.ConfigService=Hr});var Mi=d(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.EnvironmentVariablesService=void 0;var Dl=Yr(),Kr=class extends Dl.ConfigService{constructor(){super(...arguments),this.serviceNameVariable="POWERTOOLS_SERVICE_NAME",this.xRayTraceIdVariable="_X_AMZN_TRACE_ID"}get(e){return process.env[e]?.trim()||""}getServiceName(){return this.get(this.serviceNameVariable)}getXrayTraceId(){return this.getXrayTraceData()?.Root}getXrayTraceSampled(){return this.getXrayTraceData()?.Sampled==="1"}isValueTrue(e){return["1","y","yes","t","true","on"].includes(e.toLowerCase())}getXrayTraceData(){let e=this.get(this.xRayTraceIdVariable);if(e==="")return;if(!e.includes("="))return{Root:e};let r={};return e.split(";").forEach(n=>{let[i,s]=n.split("=");r[i]=s}),r}};xt.EnvironmentVariablesService=Kr});var Yr=d(le=>{"use strict";var jl=le&&le.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),$i=le&&le.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&jl(e,t,r)};Object.defineProperty(le,"__esModule",{value:!0});$i(Pi(),le);$i(Mi(),le)});var Di=d(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.helloworldContext=void 0;var Fl={callbackWaitsForEmptyEventLoop:!0,functionVersion:"$LATEST",functionName:"foo-bar-function",memoryLimitInMB:"128",logGroupName:"/aws/lambda/foo-bar-function-123456abcdef",logStreamName:"2021/03/09/[$LATEST]abcdef123456abcdef123456abcdef123456",invokedFunctionArn:"arn:aws:lambda:eu-west-1:123456789012:function:foo-bar-function",awsRequestId:"c6af9ac6-7b61-11e6-9a41-93e812345678",getRemainingTimeInMillis:()=>1234,done:()=>console.log("Done!"),fail:()=>console.log("Failed!"),succeed:()=>console.log("Succeeded!")};Pt.helloworldContext=Fl});var ji=d(Ae=>{"use strict";var Bl=Ae&&Ae.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Vl=Ae&&Ae.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Bl(e,t,r)};Object.defineProperty(Ae,"__esModule",{value:!0});Vl(Di(),Ae)});var Fi=d(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.CustomEvent=void 0;Mt.CustomEvent={key1:"value1",key2:"value2",key3:"value3"}});var Bi=d($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.Custom=void 0;$t.Custom=Fi()});var Ui=d(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0})});var Gi=d(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.isNullOrUndefined=Y.isTruthy=Y.isString=Y.isRecord=void 0;var ki=t=>Object.prototype.toString.call(t)==="[object Object]"&&!Object.is(t,null);Y.isRecord=ki;var Ul=t=>typeof t=="string"?t!=="":typeof t=="number"?t!==0:typeof t=="boolean"?t:Array.isArray(t)?t.length>0:ki(t)?Object.keys(t).length>0:!1;Y.isTruthy=Ul;var kl=t=>Object.is(t,null)||Object.is(t,void 0);Y.isNullOrUndefined=kl;var Gl=t=>typeof t=="string";Y.isString=Gl});var Wi=d(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.addUserAgentMiddleware=void 0;var Wl=Gr(),Xl=process.env.AWS_EXECUTION_ENV||"NA",Hl={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},Kl=t=>(e,r)=>async n=>{let i=`PT/${t}/${Wl.PT_VERSION} PTEnv/${Xl}`;return n.request.headers["user-agent"]=`${n.request.headers["user-agent"]} ${i}`,await e(n)},Yl=(t,e)=>{try{if(t.middlewareStack.identify().includes("addPowertoolsToUserAgent: POWERTOOLS,USER_AGENT"))return;t.middlewareStack.addRelativeTo(Kl(e),Hl)}catch(r){console.warn("Failed to add user agent middleware",r)}};Dt.addUserAgentMiddleware=Yl});var Me=d(P=>{"use strict";var zl=P&&P.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Pe=P&&P.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&zl(e,t,r)};Object.defineProperty(P,"__esModule",{value:!0});P.Events=P.ContextExamples=void 0;Pe(Ni(),P);Pe(xi(),P);Pe(Yr(),P);P.ContextExamples=ji();P.Events=Bi();Pe(Ui(),P);Pe(Gi(),P);Pe(Wi(),P)});var Xi=d(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.LogFormatter=void 0;var zr=class{formatError(e){return{name:e.name,location:this.getCodeLocation(e.stack),message:e.message,stack:e.stack}}formatTimestamp(e){return e.toISOString()}getCodeLocation(e){if(!e)return"";let r=e.split(`
`),n=/\((.*):(\d+):(\d+)\)\\?$/,i;for(i=0;i<r.length;i++){let s=n.exec(r[i]);if(Array.isArray(s))return`${s[1]}:${Number(s[2])}`}return""}};jt.LogFormatter=zr});var Ki=d(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0})});var Yi=d(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.PowertoolLogFormatter=void 0;var Ql=Bt(),Qr=class extends Ql.LogFormatter{formatAttributes(e){return{cold_start:e.lambdaContext?.coldStart,function_arn:e.lambdaContext?.invokedFunctionArn,function_memory_size:e.lambdaContext?.memoryLimitInMB,function_name:e.lambdaContext?.functionName,function_request_id:e.lambdaContext?.awsRequestId,level:e.logLevel,message:e.message,sampling_rate:e.sampleRateValue,service:e.serviceName,timestamp:this.formatTimestamp(e.timestamp),xray_trace_id:e.xRayTraceId}}};Ft.PowertoolLogFormatter=Qr});var Bt=d(ee=>{"use strict";var Jl=ee&&ee.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Jr=ee&&ee.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Jl(e,t,r)};Object.defineProperty(ee,"__esModule",{value:!0});Jr(Xi(),ee);Jr(Ki(),ee);Jr(Yi(),ee)});var ln=d((Ze,$e)=>{var Zl=200,ss="__lodash_hash_undefined__",ed=800,td=16,as=9007199254740991,os="[object Arguments]",rd="[object Array]",nd="[object AsyncFunction]",id="[object Boolean]",sd="[object Date]",ad="[object Error]",us="[object Function]",od="[object GeneratorFunction]",ud="[object Map]",cd="[object Number]",ld="[object Null]",cs="[object Object]",dd="[object Proxy]",fd="[object RegExp]",hd="[object Set]",pd="[object String]",gd="[object Undefined]",md="[object WeakMap]",vd="[object ArrayBuffer]",_d="[object DataView]",Ed="[object Float32Array]",Sd="[object Float64Array]",bd="[object Int8Array]",yd="[object Int16Array]",Td="[object Int32Array]",Ad="[object Uint8Array]",Rd="[object Uint8ClampedArray]",wd="[object Uint16Array]",Cd="[object Uint32Array]",Ld=/[\\^$.*+?()[\]{}|]/g,Od=/^\[object .+?Constructor\]$/,Id=/^(?:0|[1-9]\d*)$/,T={};T[Ed]=T[Sd]=T[bd]=T[yd]=T[Td]=T[Ad]=T[Rd]=T[wd]=T[Cd]=!0;T[os]=T[rd]=T[vd]=T[id]=T[_d]=T[sd]=T[ad]=T[us]=T[ud]=T[cd]=T[cs]=T[fd]=T[hd]=T[pd]=T[md]=!1;var ls=typeof global=="object"&&global&&global.Object===Object&&global,qd=typeof self=="object"&&self&&self.Object===Object&&self,rt=ls||qd||Function("return this")(),ds=typeof Ze=="object"&&Ze&&!Ze.nodeType&&Ze,et=ds&&typeof $e=="object"&&$e&&!$e.nodeType&&$e,fs=et&&et.exports===ds,Zr=fs&&ls.process,zi=function(){try{var t=et&&et.require&&et.require("util").types;return t||Zr&&Zr.binding&&Zr.binding("util")}catch{}}(),Qi=zi&&zi.isTypedArray;function Nd(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function xd(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function Pd(t){return function(e){return t(e)}}function Md(t,e){return t?.[e]}function $d(t,e){return function(r){return t(e(r))}}var Dd=Array.prototype,jd=Function.prototype,kt=Object.prototype,en=rt["__core-js_shared__"],Gt=jd.toString,te=kt.hasOwnProperty,Ji=function(){var t=/[^.]+$/.exec(en&&en.keys&&en.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),hs=kt.toString,Fd=Gt.call(Object),Bd=RegExp("^"+Gt.call(te).replace(Ld,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=fs?rt.Buffer:void 0,Zi=rt.Symbol,es=rt.Uint8Array,ts=Vt?Vt.allocUnsafe:void 0,ps=$d(Object.getPrototypeOf,Object),rs=Object.create,Vd=kt.propertyIsEnumerable,Ud=Dd.splice,Re=Zi?Zi.toStringTag:void 0,Ut=function(){try{var t=on(Object,"defineProperty");return t({},"",{}),t}catch{}}(),kd=Vt?Vt.isBuffer:void 0,ns=Math.max,Gd=Date.now,gs=on(rt,"Map"),tt=on(Object,"create"),Wd=function(){function t(){}return function(e){if(!Ce(e))return{};if(rs)return rs(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function we(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Xd(){this.__data__=tt?tt(null):{},this.size=0}function Hd(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Kd(t){var e=this.__data__;if(tt){var r=e[t];return r===ss?void 0:r}return te.call(e,t)?e[t]:void 0}function Yd(t){var e=this.__data__;return tt?e[t]!==void 0:te.call(e,t)}function zd(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=tt&&e===void 0?ss:e,this}we.prototype.clear=Xd;we.prototype.delete=Hd;we.prototype.get=Kd;we.prototype.has=Yd;we.prototype.set=zd;function re(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Qd(){this.__data__=[],this.size=0}function Jd(t){var e=this.__data__,r=Wt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ud.call(e,r,1),--this.size,!0}function Zd(t){var e=this.__data__,r=Wt(e,t);return r<0?void 0:e[r][1]}function ef(t){return Wt(this.__data__,t)>-1}function tf(t,e){var r=this.__data__,n=Wt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}re.prototype.clear=Qd;re.prototype.delete=Jd;re.prototype.get=Zd;re.prototype.has=ef;re.prototype.set=tf;function De(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function rf(){this.size=0,this.__data__={hash:new we,map:new(gs||re),string:new we}}function nf(t){var e=Ht(this,t).delete(t);return this.size-=e?1:0,e}function sf(t){return Ht(this,t).get(t)}function af(t){return Ht(this,t).has(t)}function of(t,e){var r=Ht(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}De.prototype.clear=rf;De.prototype.delete=nf;De.prototype.get=sf;De.prototype.has=af;De.prototype.set=of;function je(t){var e=this.__data__=new re(t);this.size=e.size}function uf(){this.__data__=new re,this.size=0}function cf(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function lf(t){return this.__data__.get(t)}function df(t){return this.__data__.has(t)}function ff(t,e){var r=this.__data__;if(r instanceof re){var n=r.__data__;if(!gs||n.length<Zl-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new De(n)}return r.set(t,e),this.size=r.size,this}je.prototype.clear=uf;je.prototype.delete=cf;je.prototype.get=lf;je.prototype.has=df;je.prototype.set=ff;function hf(t,e){var r=sn(t),n=!r&&nn(t),i=!r&&!n&&Es(t),s=!r&&!n&&!i&&bs(t),a=r||n||i||s,o=a?xd(t.length,String):[],u=o.length;for(var c in t)(e||te.call(t,c))&&!(a&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||vs(c,u)))&&o.push(c);return o}function tn(t,e,r){(r!==void 0&&!Kt(t[e],r)||r===void 0&&!(e in t))&&an(t,e,r)}function pf(t,e,r){var n=t[e];(!(te.call(t,e)&&Kt(n,r))||r===void 0&&!(e in t))&&an(t,e,r)}function Wt(t,e){for(var r=t.length;r--;)if(Kt(t[r][0],e))return r;return-1}function an(t,e,r){e=="__proto__"&&Ut?Ut(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var gf=Lf();function Xt(t){return t==null?t===void 0?gd:ld:Re&&Re in Object(t)?Of(t):Mf(t)}function is(t){return nt(t)&&Xt(t)==os}function mf(t){if(!Ce(t)||xf(t))return!1;var e=cn(t)?Bd:Od;return e.test(Ff(t))}function vf(t){return nt(t)&&Ss(t.length)&&!!T[Xt(t)]}function _f(t){if(!Ce(t))return Pf(t);var e=_s(t),r=[];for(var n in t)n=="constructor"&&(e||!te.call(t,n))||r.push(n);return r}function ms(t,e,r,n,i){t!==e&&gf(e,function(s,a){if(i||(i=new je),Ce(s))Ef(t,e,a,r,ms,n,i);else{var o=n?n(rn(t,a),s,a+"",t,e,i):void 0;o===void 0&&(o=s),tn(t,a,o)}},ys)}function Ef(t,e,r,n,i,s,a){var o=rn(t,r),u=rn(e,r),c=a.get(u);if(c){tn(t,r,c);return}var l=s?s(o,u,r+"",t,e,a):void 0,f=l===void 0;if(f){var p=sn(u),h=!p&&Es(u),x=!p&&!h&&bs(u);l=u,p||h||x?sn(o)?l=o:Bf(o)?l=Rf(o):h?(f=!1,l=yf(u,!0)):x?(f=!1,l=Af(u,!0)):l=[]:Vf(u)||nn(u)?(l=o,nn(o)?l=Uf(o):(!Ce(o)||cn(o))&&(l=If(u))):f=!1}f&&(a.set(u,l),i(l,u,n,s,a),a.delete(u)),tn(t,r,l)}function Sf(t,e){return Df($f(t,e,Ts),t+"")}var bf=Ut?function(t,e){return Ut(t,"toString",{configurable:!0,enumerable:!1,value:Gf(e),writable:!0})}:Ts;function yf(t,e){if(e)return t.slice();var r=t.length,n=ts?ts(r):new t.constructor(r);return t.copy(n),n}function Tf(t){var e=new t.constructor(t.byteLength);return new es(e).set(new es(t)),e}function Af(t,e){var r=e?Tf(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function Rf(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function wf(t,e,r,n){var i=!r;r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],u=n?n(r[o],t[o],o,r,t):void 0;u===void 0&&(u=t[o]),i?an(r,o,u):pf(r,o,u)}return r}function Cf(t){return Sf(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,a&&qf(r[0],r[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var o=r[n];o&&t(e,o,n,s)}return e})}function Lf(t){return function(e,r,n){for(var i=-1,s=Object(e),a=n(e),o=a.length;o--;){var u=a[t?o:++i];if(r(s[u],u,s)===!1)break}return e}}function Ht(t,e){var r=t.__data__;return Nf(e)?r[typeof e=="string"?"string":"hash"]:r.map}function on(t,e){var r=Md(t,e);return mf(r)?r:void 0}function Of(t){var e=te.call(t,Re),r=t[Re];try{t[Re]=void 0;var n=!0}catch{}var i=hs.call(t);return n&&(e?t[Re]=r:delete t[Re]),i}function If(t){return typeof t.constructor=="function"&&!_s(t)?Wd(ps(t)):{}}function vs(t,e){var r=typeof t;return e=e??as,!!e&&(r=="number"||r!="symbol"&&Id.test(t))&&t>-1&&t%1==0&&t<e}function qf(t,e,r){if(!Ce(r))return!1;var n=typeof e;return(n=="number"?un(r)&&vs(e,r.length):n=="string"&&e in r)?Kt(r[e],t):!1}function Nf(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function xf(t){return!!Ji&&Ji in t}function _s(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||kt;return t===r}function Pf(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}function Mf(t){return hs.call(t)}function $f(t,e,r){return e=ns(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=ns(n.length-e,0),a=Array(s);++i<s;)a[i]=n[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=n[i];return o[e]=r(a),Nd(t,this,o)}}function rn(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Df=jf(bf);function jf(t){var e=0,r=0;return function(){var n=Gd(),i=td-(n-r);if(r=n,i>0){if(++e>=ed)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Ff(t){if(t!=null){try{return Gt.call(t)}catch{}try{return t+""}catch{}}return""}function Kt(t,e){return t===e||t!==t&&e!==e}var nn=is(function(){return arguments}())?is:function(t){return nt(t)&&te.call(t,"callee")&&!Vd.call(t,"callee")},sn=Array.isArray;function un(t){return t!=null&&Ss(t.length)&&!cn(t)}function Bf(t){return nt(t)&&un(t)}var Es=kd||Wf;function cn(t){if(!Ce(t))return!1;var e=Xt(t);return e==us||e==od||e==nd||e==dd}function Ss(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=as}function Ce(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function nt(t){return t!=null&&typeof t=="object"}function Vf(t){if(!nt(t)||Xt(t)!=cs)return!1;var e=ps(t);if(e===null)return!0;var r=te.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Gt.call(r)==Fd}var bs=Qi?Pd(Qi):vf;function Uf(t){return wf(t,ys(t))}function ys(t){return un(t)?hf(t,!0):_f(t)}var kf=Cf(function(t,e,r){ms(t,e,r)});function Gf(t){return function(){return t}}function Ts(t){return t}function Wf(){return!1}$e.exports=kf});var As=d(Fe=>{"use strict";var Xf=Fe&&Fe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.LogItem=void 0;var Hf=Xf(ln()),dn=class{constructor(e){this.attributes={},this.addAttributes(e.baseAttributes),this.addAttributes(e.persistentAttributes)}addAttributes(e){return this.attributes=(0,Hf.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.setAttributes(this.removeEmptyKeys(this.getAttributes()))}removeEmptyKeys(e){let r={};for(let n in e)e[n]!==void 0&&e[n]!==""&&e[n]!==null&&(r[n]=e[n]);return r}setAttributes(e){this.attributes=e}};Fe.LogItem=dn});var ws=d(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0})});var Ls=d(de=>{"use strict";var Kf=de&&de.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Cs=de&&de.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Kf(e,t,r)};Object.defineProperty(de,"__esModule",{value:!0});Cs(As(),de);Cs(ws(),de)});var Is=d(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0})});var qs=d(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.EnvironmentVariablesService=void 0;var Yf=Me(),fn=class extends Yf.EnvironmentVariablesService{constructor(){super(...arguments),this.awsRegionVariable="AWS_REGION",this.currentEnvironmentVariable="ENVIRONMENT",this.devModeVariable="POWERTOOLS_DEV",this.functionNameVariable="AWS_LAMBDA_FUNCTION_NAME",this.functionVersionVariable="AWS_LAMBDA_FUNCTION_VERSION",this.logEventVariable="POWERTOOLS_LOGGER_LOG_EVENT",this.logLevelVariable="LOG_LEVEL",this.memoryLimitInMBVariable="AWS_LAMBDA_FUNCTION_MEMORY_SIZE",this.sampleRateValueVariable="POWERTOOLS_LOGGER_SAMPLE_RATE"}getAwsRegion(){return this.get(this.awsRegionVariable)}getCurrentEnvironment(){return this.get(this.currentEnvironmentVariable)}getFunctionMemory(){let e=this.get(this.memoryLimitInMBVariable);return Number(e)}getFunctionName(){return this.get(this.functionNameVariable)}getFunctionVersion(){return this.get(this.functionVersionVariable)}getLogEvent(){let e=this.get(this.logEventVariable);return this.isValueTrue(e)}getLogLevel(){return this.get(this.logLevelVariable)}getSampleRateValue(){let e=this.get(this.sampleRateValueVariable);return e&&e.length>0?Number(e):void 0}isDevMode(){let e=this.get(this.devModeVariable);return this.isValueTrue(e)}};Yt.EnvironmentVariablesService=fn});var xs=d(fe=>{"use strict";var zf=fe&&fe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ns=fe&&fe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&zf(e,t,r)};Object.defineProperty(fe,"__esModule",{value:!0});Ns(Is(),fe);Ns(qs(),fe)});var pn=d(Be=>{"use strict";var Qf=Be&&Be.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Be,"__esModule",{value:!0});Be.Logger=void 0;var Jf=require("crypto"),Zf=require("console"),eh=Me(),th=Bt(),rh=Ls(),zt=Qf(ln()),nh=xs(),hn=class t extends eh.Utility{get level(){return this.logLevel}constructor(e={}){super(),this.logEvent=!1,this.logIndentation=0,this.logLevel=12,this.logLevelThresholds={DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},this.logsSampled=!1,this.persistentLogAttributes={},this.powertoolLogData={},this.setOptions(e)}addContext(e){let r={invokedFunctionArn:e.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:e.awsRequestId,memoryLimitInMB:Number(e.memoryLimitInMB),functionName:e.functionName,functionVersion:e.functionVersion};this.addToPowertoolLogData({lambdaContext:r})}addPersistentLogAttributes(e){(0,zt.default)(this.persistentLogAttributes,e)}appendKeys(e){this.addPersistentLogAttributes(e)}createChild(e={}){let r={logLevel:this.getLevelName(),customConfigService:this.getCustomConfigService(),logFormatter:this.getLogFormatter()},n=this.getPowertoolLogData(),i=new t((0,zt.default)(r,n,e)),s=this.getPersistentLogAttributes();return i.addPersistentLogAttributes(s),n.lambdaContext&&i.addContext(n.lambdaContext),i}critical(e,...r){this.processLogItem(24,e,r)}debug(e,...r){this.processLogItem(8,e,r)}error(e,...r){this.processLogItem(20,e,r)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getLogsSampled(){return this.logsSampled}getPersistentLogAttributes(){return this.persistentLogAttributes}info(e,...r){this.processLogItem(12,e,r)}injectLambdaContext(e){return(r,n,i)=>{let s=i.value,a=this;i.value=async function(o,u,c){let l={};e&&e.clearState===!0&&(l={...a.getPersistentLogAttributes()}),t.injectLambdaContextBefore(a,o,u,e);let f;try{f=await s.apply(this,[o,u,c])}catch(p){throw p}finally{t.injectLambdaContextAfterOrOnError(a,l,e)}return f}}}static injectLambdaContextAfterOrOnError(e,r,n){n&&n.clearState===!0&&e.setPersistentLogAttributes(r)}static injectLambdaContextBefore(e,r,n,i){e.addContext(n);let s;i&&i.hasOwnProperty("logEvent")&&(s=i.logEvent),e.logEventIfEnabled(r,s)}logEventIfEnabled(e,r){this.shouldLogEvent(r)&&this.info("Lambda invocation event",{event:e})}refreshSampleRateCalculation(){this.setLogsSampled()}removeKeys(e){this.removePersistentLogAttributes(e)}removePersistentLogAttributes(e){e.forEach(r=>{this.persistentLogAttributes&&r in this.persistentLogAttributes&&delete this.persistentLogAttributes[r]})}setLogLevel(e){if(this.isValidLogLevel(e))this.logLevel=this.logLevelThresholds[e];else throw new Error(`Invalid log level: ${e}`)}setPersistentLogAttributes(e){this.persistentLogAttributes=e}setSampleRateValue(e){this.powertoolLogData.sampleRateValue=e||this.getCustomConfigService()?.getSampleRateValue()||this.getEnvVarsService().getSampleRateValue()}shouldLogEvent(e){return typeof e=="boolean"?e:this.getLogEvent()}warn(e,...r){this.processLogItem(16,e,r)}shouldPrint(e){return e>=this.logLevel?!0:this.getLogsSampled()}addToPowertoolLogData(...e){e.forEach(r=>{(0,zt.default)(this.powertoolLogData,r)})}createAndPopulateLogItem(e,r,n){let i=(0,zt.default)({logLevel:this.getLogLevelNameFromNumber(e),timestamp:new Date,message:typeof r=="string"?r:r.message,xRayTraceId:this.envVarsService.getXrayTraceId()},this.getPowertoolLogData()),s=new rh.LogItem({baseAttributes:this.getLogFormatter().formatAttributes(i),persistentAttributes:this.getPersistentLogAttributes()});return typeof r!="string"&&s.addAttributes(r),n.forEach(a=>{let o=a instanceof Error?{error:a}:typeof a=="string"?{extra:a}:a;s.addAttributes(o)}),s}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(e){return Object.entries(this.logLevelThresholds).find(([n,i])=>{if(i===e)return n})[0]}getPowertoolLogData(){return this.powertoolLogData}getReplacer(){let e=new WeakSet;return(r,n)=>{let i=n;if(i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&n!==null){if(e.has(i))return;e.add(i)}return i}}getSampleRateValue(){return this.powertoolLogData.sampleRateValue||this.setSampleRateValue(),this.powertoolLogData.sampleRateValue}isValidLogLevel(e){return typeof e=="string"&&e in this.logLevelThresholds}printLog(e,r){r.prepareForPrint();let n=e===24?"error":this.getLogLevelNameFromNumber(e).toLowerCase();this.console[n](JSON.stringify(r.getAttributes(),this.getReplacer(),this.logIndentation))}processLogItem(e,r,n){this.shouldPrint(e)&&this.printLog(e,this.createAndPopulateLogItem(e,r,n))}setConsole(){this.getEnvVarsService().isDevMode()?this.console=console:this.console=new Zf.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new nh.EnvironmentVariablesService}setInitialLogLevel(e){let r=e?.toUpperCase();if(this.isValidLogLevel(r)){this.logLevel=this.logLevelThresholds[r];return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=this.logLevelThresholds[n];return}let i=this.getEnvVarsService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(i)){this.logLevel=this.logLevelThresholds[i];return}}setLogEvent(){this.getEnvVarsService().getLogEvent()&&(this.logEvent=!0)}setLogFormatter(e){this.logFormatter=e||new th.PowertoolLogFormatter}setLogIndentation(){this.getEnvVarsService().isDevMode()&&(this.logIndentation=4)}setLogsSampled(){let e=this.getSampleRateValue();this.logsSampled=e!==void 0&&(e===1||(0,Jf.randomInt)(0,100)/100<=e)}setOptions(e){let{logLevel:r,serviceName:n,sampleRateValue:i,logFormatter:s,customConfigService:a,persistentLogAttributes:o,environment:u}=e;return this.setEnvVarsService(),this.setConsole(),this.setCustomConfigService(a),this.setInitialLogLevel(r),this.setSampleRateValue(i),this.setLogsSampled(),this.setLogFormatter(s),this.setPowertoolLogData(n,u),this.setLogEvent(),this.setLogIndentation(),this.addPersistentLogAttributes(o),this}setPowertoolLogData(e,r,n={}){this.addToPowertoolLogData({awsRegion:this.getEnvVarsService().getAwsRegion(),environment:r||this.getCustomConfigService()?.getCurrentEnvironment()||this.getEnvVarsService().getCurrentEnvironment(),sampleRateValue:this.getSampleRateValue(),serviceName:e||this.getCustomConfigService()?.getServiceName()||this.getEnvVarsService().getServiceName()||this.getDefaultServiceName()},n)}};Be.Logger=hn});var gn=d(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.IDEMPOTENCY_KEY=z.LOGGER_KEY=z.METRICS_KEY=z.TRACER_KEY=void 0;var Qt="powertools-for-aws",ih=`${Qt}.tracer`;z.TRACER_KEY=ih;var sh=`${Qt}.metrics`;z.METRICS_KEY=sh;var ah=`${Qt}.logger`;z.LOGGER_KEY=ah;var oh=`${Qt}.idempotency`;z.IDEMPOTENCY_KEY=oh});var Ps=d(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.cleanupMiddlewares=void 0;var Jt=gn(),uh=t=>typeof t=="function",ch=async t=>{let e=[Jt.TRACER_KEY,Jt.METRICS_KEY,Jt.LOGGER_KEY,Jt.IDEMPOTENCY_KEY];for(let r of e)if(Object(t.internal).hasOwnProperty(r)){let n=t.internal[r];uh(n)&&await n(t)}};Zt.cleanupMiddlewares=ch});var mn=d(he=>{"use strict";var lh=he&&he.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ms=he&&he.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&lh(e,t,r)};Object.defineProperty(he,"__esModule",{value:!0});Ms(Ps(),he);Ms(gn(),he)});var Ds=d(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.injectLambdaContext=void 0;var $s=pn(),dh=mn(),fh=(t,e)=>{let r=t instanceof Array?t:[t],n=[],i=e&&e.clearState===!0,s=u=>{u.internal={...u.internal,[dh.LOGGER_KEY]:o}},a=async u=>{r.forEach((c,l)=>{i&&(n[l]={...c.getPersistentLogAttributes()},s(u)),$s.Logger.injectLambdaContextBefore(c,u.event,u.context,e)})},o=async()=>{i&&r.forEach((u,c)=>{$s.Logger.injectLambdaContextAfterOrOnError(u,n[c],e)})};return{before:a,after:o,onError:o}};er.injectLambdaContext=fh});var js=d(Le=>{"use strict";var hh=Le&&Le.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),ph=Le&&Le.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hh(e,t,r)};Object.defineProperty(Le,"__esModule",{value:!0});ph(Ds(),Le)});var Wr=d(Q=>{"use strict";var gh=Q&&Q.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),tr=Q&&Q.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&gh(e,t,r)};Object.defineProperty(Q,"__esModule",{value:!0});tr(Oi(),Q);tr(pn(),Q);tr(js(),Q);tr(Bt(),Q)});var Fs=d(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.createTracer=void 0;var mh=vn(),vh=(t={})=>new mh.Tracer(t);rr.createTracer=vh});var Vs=d(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0})});var Us=d(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.EnvironmentVariablesService=void 0;var _h=Me(),_n=class extends _h.EnvironmentVariablesService{constructor(){super(...arguments),this.awsExecutionEnv="AWS_EXECUTION_ENV",this.samLocalVariable="AWS_SAM_LOCAL",this.tracerCaptureErrorVariable="POWERTOOLS_TRACER_CAPTURE_ERROR",this.tracerCaptureHTTPsRequestsVariable="POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",this.tracerCaptureResponseVariable="POWERTOOLS_TRACER_CAPTURE_RESPONSE",this.tracingEnabledVariable="POWERTOOLS_TRACE_ENABLED"}getAwsExecutionEnv(){return this.get(this.awsExecutionEnv)}getCaptureHTTPsRequests(){return this.get(this.tracerCaptureHTTPsRequestsVariable)}getSamLocal(){return this.get(this.samLocalVariable)}getTracingCaptureError(){return this.get(this.tracerCaptureErrorVariable)}getTracingCaptureResponse(){return this.get(this.tracerCaptureResponseVariable)}getTracingEnabled(){return this.get(this.tracingEnabledVariable)}};nr.EnvironmentVariablesService=_n});var Gs=d(pe=>{"use strict";var Eh=pe&&pe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),ks=pe&&pe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Eh(e,t,r)};Object.defineProperty(pe,"__esModule",{value:!0});ks(Vs(),pe);ks(Us(),pe)});var Ks=d((RE,Hs)=>{"use strict";function En(t){return typeof t=="function"}var j=console.error.bind(console);function it(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function st(t){t&&t.logger&&(En(t.logger)?j=t.logger:j("new logger isn't a function, not replacing"))}function Ws(t,e,r){if(!t||!t[e]){j("no original function "+e+" to wrap");return}if(!r){j("no wrapper function"),j(new Error().stack);return}if(!En(t[e])||!En(r)){j("original object and wrapper must be functions");return}var n=t[e],i=r(n,e);return it(i,"__original",n),it(i,"__unwrap",function(){t[e]===i&&it(t,e,n)}),it(i,"__wrapped",!0),it(t,e,i),i}function Sh(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{j("must provide one or more modules to patch"),j(new Error().stack);return}if(!(e&&Array.isArray(e))){j("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(i){Ws(n,i,r)})})}function Xs(t,e){if(!t||!t[e]){j("no function to unwrap."),j(new Error().stack);return}if(!t[e].__unwrap)j("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function bh(t,e){if(t)Array.isArray(t)||(t=[t]);else{j("must provide one or more modules to patch"),j(new Error().stack);return}if(!(e&&Array.isArray(e))){j("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){Xs(r,n)})})}st.wrap=Ws;st.massWrap=Sh;st.unwrap=Xs;st.massUnwrap=bh;Hs.exports=st});var Zs=d((wE,Js)=>{"use strict";var zs=Ks(),Ve=zs.wrap,ir=zs.unwrap,ne="wrap@before";function sr(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function yh(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n],s=t[ne];if(typeof s=="function")s(i);else if(Array.isArray(s))for(var a=s.length,o=0;o<a;o++)s[o](i)}}function Qs(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function Th(t,e,r){var n=Qs(t,e),i=n.filter(function(s){return r.indexOf(s)===-1});i.length>0&&yh(t,i)}function Ys(t,e){if(t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}Js.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(a){return function(u,c){var l=Qs(this,u).slice();try{var f=a.call(this,u,c);return Th(this,u,l),f}finally{this.on.__wrapped||Ve(this,"on",i),this.addListener.__wrapped||Ve(this,"addListener",i)}}}function s(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(f){return function(){this._events[u]=c;try{return f.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Ys(c,n)}}}Ve(this,"removeListener",l);try{return this._events[u]=Ys(c,n),a.apply(this,arguments)}finally{ir(this,"removeListener"),this._events[u]=c}}}e[ne]?typeof e[ne]=="function"?sr(e,ne,[e[ne],r]):Array.isArray(e[ne])&&e[ne].push(r):sr(e,ne,r),e.__wrapped||(Ve(e,"addListener",i),Ve(e,"on",i),Ve(e,"emit",s),sr(e,"__unwrap",function(){ir(e,"addListener"),ir(e,"on"),ir(e,"emit"),delete e[ne],delete e.__wrapped}),sr(e,"__wrapped",!0))}});var na=d((CE,ra)=>{"use strict";var S=require("util"),ie=require("assert"),Ah=Zs(),A=require("async_hooks"),at="cls@contexts",ot="error@context",L=process.env.DEBUG_CLS_HOOKED,E=-1;ra.exports={getNamespace:ea,createNamespace:Rh,destroyNamespace:ta,reset:wh,ERROR_SYMBOL:ot};function k(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}k.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,L){let n=" ".repeat(this._indent<0?0:this._indent);w(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};k.prototype.get=function(e){if(!this.active){if(L){let r=A.currentId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(L){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(i+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),w(`${i}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${S.inspect(this.active)}`)}return this.active[e]};k.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=E,L){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${S.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};k.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(L){let n=A.triggerAsyncId(),i=A.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);w(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${S.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[ot]=r),n}finally{if(L){let n=A.triggerAsyncId(),i=A.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);w(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${S.inspect(r)}`)}this.exit(r)}};k.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};k.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return L&&w("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),n.then(i=>(L&&w("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),i)).catch(i=>{throw i[ot]=r,L&&w("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),i})};k.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[ot]=r),s}finally{n.exit(r)}}};k.prototype.enter=function(e){if(ie.ok(e,"context must be provided for entering"),L){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${S.inspect(e)}`)}this._set.push(this.active),this.active=e};k.prototype.exit=function(e){if(ie.ok(e,"context must be provided for exiting"),L){let n=A.executionAsyncId(),i=A.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);w(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${E} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${S.inspect(e)}`)}if(this.active===e){ie.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(L&&w("??ERROR?? context exiting but not entered - ignoring: "+S.inspect(e)),ie.ok(r>=0,`context not currently entered; can't exit. 
`+S.inspect(this)+`
`+S.inspect(e))):(ie.ok(r,"can't remove top context"),this._set.splice(r,1))};k.prototype.bindEmitter=function(e){ie.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){a&&(a[at]||(a[at]=Object.create(null)),a[at][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[at]))return a;let o=a,u=a[at];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}Ah(e,i,s)};k.prototype.fromException=function(e){return e[ot]};function ea(t){return process.namespaces[t]}function Rh(t){ie.ok(t,"namespace must be given a name."),L&&w(`NS-CREATING NAMESPACE (${t})`);let e=new k(t);return e.id=E,A.createHook({init(n,i,s,a){if(E=A.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),L){let o=" ".repeat(e._indent<0?0:e._indent);w(`${o}INIT [${i}] (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(E===0){let o=A.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(n,u),L){let c=" ".repeat(e._indent<0?0:e._indent);w(`${c}INIT USING CONTEXT FROM TRIGGERID [${i}] (${t}) asyncId:${n} currentUid:${E} triggerId:${o} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(L){let c=" ".repeat(e._indent<0?0:e._indent);w(`${c}INIT MISSING CONTEXT [${i}] (${t}) asyncId:${n} currentUid:${E} triggerId:${o} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(L&&i==="PROMISE"){w(S.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);w(`${u}INIT RESOURCE-PROMISE [${i}] (${t}) parentId:${o} asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){E=A.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(E),i){if(L){let s=A.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);w(`${a}BEFORE (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`),e._indent+=2}e.enter(i)}else if(L){let s=A.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);w(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${S.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){E=A.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(E),i){if(L){let s=A.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);w(`${a}AFTER (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`)}e.exit(i)}else if(L){let s=A.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);w(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`)}},destroy(n){if(E=A.executionAsyncId(),L){let i=A.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);w(`${s}DESTROY (${t}) currentUid:${E} asyncId:${n} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(e._contexts.get(E))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function ta(t){let e=ea(t);ie.ok(e,`can't delete nonexistent namespace! "`+t+'"'),ie.ok(e.id,"don't assign to process.namespaces directly! "+S.inspect(e)),process.namespaces[t]=null}function wh(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){ta(t)}),process.namespaces=Object.create(null)}process.namespaces={};function w(...t){L&&process._rawDebug(`${S.format(...t)}`)}});var C=d((LE,aa)=>{"use strict";var Sn=["debug","info","warn","error","silent"],ia=Sn.indexOf("error"),Ch=Lh(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),sa={error:ar("error"),info:ar("info"),warn:ar("warn"),debug:ar("debug")};function ar(t){var e=Sn.indexOf(t),r=console[t]||console.log||(()=>{});return e>=Ch?(n,i)=>{(n||i)&&r(qh(t,n,i))}:()=>{}}function Lh(t){if(t){var e=t.toLowerCase(),r=Sn.indexOf(e);return r>=0?r:ia}return ia}function Oh(t){var e=-t.getTimezoneOffset(),r=e>=0?"+":"-",n=function(i){var s=Math.floor(Math.abs(i));return(s<10?"0":"")+s};return new Date(t.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+r+n(e/60)+":"+n(e%60)}function Ih(){return process.env.LAMBDA_TASK_ROOT!==void 0}function qh(t,e,r){var n=[];Ih()||(n.push(Oh(new Date)),n.push(`[${t.toUpperCase()}]`)),e&&n.push(e);var i=n.join(" "),s=Nh(r);return[i,s].filter(a=>a.length>0).join(`
  `)}function Nh(t){return t?typeof t=="string"?t:JSON.stringify(t):""}var xh={setLogger:function(e){sa=e},getLogger:function(){return sa}};aa.exports=xh});var bn=d((OE,ua)=>{"use strict";var Ph=require("crypto");function oa(t,e){this.init(t,e)}oa.prototype.init=function(e,r){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!r,this.id=Ph.randomBytes(8).toString("hex"),n.stack){var i=n.stack.split(`
`);i.shift(),i.forEach(s=>{var a=s.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,u=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:o||"anonymous"};this.stack.push(c)},this)}};ua.exports=oa});var la=d((IE,ca)=>{ca.exports=Mh;function Mh(t){var e=!1,r=null,n=null,i=null;return a;function s(o){i&&jh(i,o),e=!1,i=n;var u=r;if(r=null,n=null,!u||!u.length){if(!i||!i.length){i=null;return}u||(u=[])}e=!0,t(u,s)}function a(o,u){e?(r||(r=[],n=[]),$h(r,o),u&&n.push(u)):(u&&(i=[u]),e=!0,t(Array.isArray(o)?o:[o],s))}}function $h(t,e){Array.isArray(e)?Dh(t,e):t.push(e)}function Dh(t,e){for(var r=0;r<e.length;r++)t.push(e[r])}function jh(t,e){for(var r=0;r<t.length;r++)t[r](e)}});var or=d((qE,ha)=>{"use strict";var da=C(),X={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?da.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(fa(e),da.getLogger().info("Configured daemon address to "+e+"."))}},fa=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var r=e.split(" ");if(r.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");X.udp_ip=n[0],X.tcp_ip=n[0],X.udp_port=n[1],X.tcp_port=n[1]}else if(r.length===2){var i=r[0].split(":"),s=r[1].split(":"),a={};if(a[i[0]]=i,a[s[0]]=s,X.udp_ip=a.udp[1],X.udp_port=parseInt(a.udp[2]),X.tcp_ip=a.tcp[1],X.tcp_port=parseInt(a.tcp[2]),!X.udp_port||!X.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&fa(process.env.AWS_XRAY_DAEMON_ADDRESS);ha.exports=X});var cr=d((NE,Ea)=>{"use strict";var ma=require("dgram"),Fh=la(),ur=C(),pa='{"format":"json","version":1}',ga=`
`;function Bh(t,e){var r=ma.createSocket("udp4");va(r,t,0,function(){try{r.close()}finally{e()}})}function va(t,e,r,n){if(r>=e.length){n();return}Vh(t,e[r],function(){va(t,e,r+1,n)})}function Vh(t,e,r){var n=e.msg,i=e.offset,s=e.length,a=e.port,o=e.address,u=e.callback;t.send(n,i,s,a,o,function(c){try{u(c)}finally{r()}})}function _a(){this.batchSend=Fh(Bh)}_a.prototype.send=function(t,e,r,n,i,s){var a={msg:t,offset:e,length:r,port:n,address:i,callback:s};this.batchSend(a)};var Uh={daemonConfig:or(),format:function(e){return pa+ga+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new _a:this.socket=ma.createSocket("udp4").unref());var r=this.socket,n=e.format(),i=pa+ga+n,s=Buffer.from(i),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";r.send(s,0,s.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?ur.getLogger().error(o+" too large to send: "+a+" ("+s.length+" bytes)."):ur.getLogger().error("Error occured sending segment: ",u):(ur.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),ur.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};Ea.exports=Uh});var dr=d((xE,Sa)=>{"use strict";var kh=require("crypto"),lr=C(),yn=class t{constructor(e,r){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=r||kh.randomBytes(12).toString("hex")}static Invalid(){return new t("00000000","000000000000000000000000")}static FromString(e){let r="-";var n=new t,i,s;if(!e||typeof e!="string")return lr.getLogger().error("Empty or non-string trace ID provided"),n;let a=e.trim().split(r);return a.length!==3?(lr.getLogger().error("Unrecognized trace ID format"),n):(i=parseInt(a[0]),isNaN(i)||i<1?(lr.getLogger().error("Trace ID version must be positive integer"),n):(s=parseInt(a[1],16).toString(16),s==="NaN"?(lr.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(n.version=i,n.timestamp=s,n.id=a[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};Sa.exports=yn});var M=d((PE,ba)=>{"use strict";var Gh=require("crypto"),ut=C(),Wh=dr(),Tn={getCauseTypeFromHttpStatus:function(e){var r=e.toString();if(r.match(/^[4][0-9]{2}$/)!==null)return"error";if(r.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,r){if(e===void 0||r===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,i=r.length,s=e.indexOf("*");if(e=e.toLowerCase(),r=r.toLowerCase(),s===-1||s===n-1){var a=function(){for(var p=0,h=0;h<n;h++){var x=e.charAt(h);if(x==="*")return!0;if(x==="?"){if(p===i)return!1;p++}else{if(p>=i||x!=r.charAt(p))return!1;p++}}return p===i};return a()}var o=[];o[0]=!0;for(var u=0;u<n;u++){var c,l=e.charAt(u);if(l!="*")for(c=i-1;c>=0;c--)o[c+1]=!!o[c]&&(l==="?"||l===r.charAt(c));else{for(c=0;c<=i&&!o[c];)c++;for(c;c<=i;c++)o[c]=!0}o[0]=o[0]&&l==="*"}return o[i]},LambdaUtils:{validTraceData:function(t){var e=!1;if(t){var r=Tn.processTraceData(t);e=!!(r&&r.root&&r.parent&&r.sampled)}return e},populateTraceData:function(t,e){ut.getLogger().debug("Lambda trace data found: "+e);let r=Tn.processTraceData(e);var n=!1;return r?!r.root||!r.parent||!r.sampled?ut.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(r={},ut.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),t.trace_id=Wh.FromString(r.root).toString(),t.id=r.parent||Gh.randomBytes(8).toString("hex"),r.root&&t.trace_id!==r.root&&(ut.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(r.sampled)?delete t.notTraced:t.notTraced=!0,r.data&&(t.userData=r.data),ut.getLogger().debug("Segment started: "+JSON.stringify(r)),n}},processTraceData:function(e){var r={},n={},i=["root","parent","sampled","self"],s=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let u=o[0].trim(),c=o[1].trim(),l=u.toLowerCase(),f=i.indexOf(l)!==-1;f?r[l]=c:!f&&s-(l.length+c.length)>=0&&(n[u]=c,s-=u.length+c.length)}}}),r.data=n),r},objectWithoutProperties:function(e,r,n){r=Array.isArray(r)?r:[],n=typeof n=="boolean"?n:!1;var i=n?Object.create(Object.getPrototypeOf(e)):{};for(var s in e)r.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i},safeParseInt:t=>!t||isNaN(t)?0:parseInt(t)};ba.exports=Tn});var ge=d((ME,Aa)=>{"use strict";var{safeParseInt:ya}=M(),Ta=C(),Xh=100,An={streamingThreshold:Xh,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(An.streamingThreshold=e,Ta.getLogger().debug("Subsegment streaming threshold set to: "+e)):Ta.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return An.streamingThreshold},getHttpResponseData:t=>{let e={};if(!t)return e;let r=ya(t.statusCode);return r!==0&&(e.status=r),t.headers&&t.headers["content-length"]&&(e.content_length=ya(t.headers["content-length"])),e}};Aa.exports=An});var Ca=d(($E,wa)=>{"use strict";var{getHttpResponseData:Hh}=ge(),{stripQueryStringFromPath:Kh}=M();function Ra(t,e,r){this.init(t,e,r)}Ra.prototype.init=function(e,r,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+Kh(e.path):"",method:e.method||""},n&&(this.request.traced=!0),r&&(this.response=Hh(r))};wa.exports=Ra});var ct=d((DE,La)=>{"use strict";var Yh=require("crypto"),zh=bn(),Qh=Ca(),Jh=cr(),Rn=ge(),Zh=M(),se=C();function b(t){this.init(t)}b.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=Yh.randomBytes(8).toString("hex"),this.name=e,this.start_time=Rn.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};b.prototype.addNewSubsegment=function(e){let r=new b(e);return this.addSubsegment(r),r};b.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};b.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new b(e);return this.addSubsegment(r),r.notTraced=!0,r};b.prototype.addSubsegment=function(t){if(!(t instanceof b))throw new Error("Failed to add subsegment:"+t+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),t.segment=this.segment,t.parent=this,t.notTraced=t.parent.notTraced,t.end_time===void 0&&this.incrementCounter(t.counter),this.subsegments.push(t)};b.prototype.removeSubsegment=function(e){if(!(e instanceof b))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};b.prototype.addAttribute=function(e,r){this[e]=r};b.prototype.addPrecursorId=function(t){typeof t!="string"&&se.getLogger().error("Failed to add id:"+t+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(t)};b.prototype.addAnnotation=function(t,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){se.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof t!="string"){se.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[t]=e};b.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){se.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){se.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};b.prototype.addSqlData=function(e){this.sql=e};b.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){se.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new zh(e,r))};b.prototype.addRemoteRequestData=function(e,r,n){this.http=new Qh(e,r,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};b.prototype.addFaultFlag=function(){this.fault=!0};b.prototype.addErrorFlag=function(){this.error=!0};b.prototype.addThrottleFlag=function(){this.throttle=!0};b.prototype.close=function(e,r){var n=this.segment;this.end_time=Rn.getCurrentTime(),delete this.in_progress,e&&this.addError(e,r),this.parent&&this.parent.decrementCounter(),n&&n.counter>Rn.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};b.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};b.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};b.prototype.isClosed=function(){return!this.in_progress};b.prototype.flush=function(){if(!this.parent||!this.segment){se.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?Jh.send(this):se.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):se.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};b.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(r){r.streamSubsegments()||e.push(r)}),this.subsegments=e}};b.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),JSON.stringify(this)};b.prototype.toString=function(){return JSON.stringify(this)};b.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=Zh.objectWithoutProperties(this,e,!1);return r};La.exports=b});var lt=d((jE,qa)=>{"use strict";var ep=require("crypto"),tp=bn(),rp=cr(),H=ge(),fr=ct(),Oa=dr(),Ia=M(),me=C();function y(t,e,r){this.init(t,e,r)}y.prototype.init=function(e,r,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var i;r&&typeof r=="string"?i=Oa.FromString(r):i=new Oa;var s=ep.randomBytes(8).toString("hex"),a=H.getCurrentTime();this.trace_id=i.toString(),this.id=s,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),H.serviceData&&this.setServiceData(H.serviceData),H.pluginData&&this.addPluginData(H.pluginData),H.origin&&(this.origin=H.origin),H.sdkData&&this.setSDKData(H.sdkData)};y.prototype.addIncomingRequestData=function(e){this.http=e};y.prototype.addAnnotation=function(e,r){if(typeof r!="boolean"&&typeof r!="string"&&!isFinite(r)){me.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){me.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=r};y.prototype.setUser=function(t){typeof t!="string"&&me.getLogger().error("Set user: "+t+" failed. User IDs must be of type string."),this.user=t};y.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){me.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){me.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};y.prototype.setSDKData=function(e){if(!e){me.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};y.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};y.prototype.setServiceData=function(e){if(!e){me.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};y.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};y.prototype.addNewSubsegment=function(e){var r=new fr(e);return this.addSubsegment(r),r};y.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};y.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new fr(e);return this.addSubsegment(r),r.notTraced=!0,r};y.prototype.addSubsegment=function(e){if(!(e instanceof fr))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};y.prototype.removeSubsegment=function(e){if(!(e instanceof fr))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};y.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){me.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new tp(e,r))};y.prototype.addFaultFlag=function(){this.fault=!0};y.prototype.addErrorFlag=function(){this.error=!0};y.prototype.addThrottleFlag=function(){this.throttle=!0};y.prototype.isClosed=function(){return!this.in_progress};y.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>H.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var r=[];this.subsegments.forEach(function(n){n.streamSubsegments()||r.push(n)}),this.subsegments=r}};y.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};y.prototype.close=function(t,e){this.end_time||(this.end_time=H.getCurrentTime()),t!==void 0&&this.addError(t,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};y.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Ia.objectWithoutProperties(this,["counter","notTraced"],!0);rp.send(e)}};y.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=Ia.objectWithoutProperties(this,e,!1);return JSON.stringify(r)};y.prototype.toString=function(){return JSON.stringify(this)};qa.exports=y});var Ee=d((FE,Ma)=>{"use strict";var dt=na(),J=C(),wn=lt(),Na=ct(),ve=!0,_e="AWSXRay",xa="segment",Pa=!1,$={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var r=new Error(e);J.getLogger().error(r.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!$.isAutomaticMode()){var r=e.XRaySegment||e.XraySegment,n=e.Segment,i=null;return r&&(r instanceof wn||r instanceof Na)?(i=r,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof wn||n instanceof Na)&&(i=n,delete e.Segment),i}},getNamespace:function(){return dt.getNamespace(_e)||dt.createNamespace(_e)},resolveSegment:function(e){if(ve)return this.getSegment();if(e&&!ve)return e;!e&&!ve&&$.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(ve){var e=$.getNamespace(_e).get(xa);return e?e instanceof wn&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():$.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else $.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){ve?$.getNamespace(_e).set(xa,e)||J.getLogger().warn("Failed to set the current sub/segment on the context."):$.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return ve},enableAutomaticMode:function(){ve=!0,$.getNamespace(_e),J.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){ve=!1,dt.getNamespace(_e)&&dt.destroyNamespace(_e),J.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Pa)J.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var r=$.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(r)$.contextMissingStrategy.contextMissing=r.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?J.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):J.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys($.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")$.contextMissingStrategy.contextMissing=e,J.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};dt.createNamespace(_e);J.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default).");process.env.AWS_XRAY_CONTEXT_MISSING?($.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Pa=!0):($.contextMissingStrategy.contextMissing=$.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,J.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Ma.exports=$});var Ln=d((BE,$a)=>{"use strict";var{getHttpResponseData:np}=ge();function Cn(t){this.init(t)}Cn.prototype.init=function(e){var r=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:ip(e)||"",url:n||""},r&&(this.request.x_forwarded_for=r)};var ip=function(e){var r;return e.headers["x-forwarded-for"]?r=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?r=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?r=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(r=e.connection.socket.remoteAddress),r};Cn.prototype.close=function(e){this.response=np(e)};$a.exports=Cn});var ja=d((VE,Da)=>{"use strict";function On(t,e){this.init(t,e)}On.prototype.init=function(e,r){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof r=="number"&&r>=0&&r<=1)this.fallbackRate=r;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};On.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Da.exports=On});var Fa=d((UE,sp)=>{sp.exports={default:{fixed_target:1,rate:.05},version:2}});var qn=d((kE,Ga)=>{"use strict";var ap=require("fs"),Ba=ja(),In=M(),op=Fa(),hr=C(),Ua={shouldSample:function(e){var r=e.host,n=e.httpMethod,i=e.urlPath,s="{ http_method: "+n+", host: "+r+", url_path: "+i+" }",a;return this.rules.some(function(o){if(o.default||r==null||In.wildcardMatch(o.host,r)&&(n==null||In.wildcardMatch(o.http_method,n))&&(i==null||In.wildcardMatch(o.url_path,i)))return a=o.reservoir,hr.getLogger().debug("Local sampling rule match found for "+s+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(hr.getLogger().debug("No sampling rule matched for "+s),!1)},setLocalRules:function(e){e?typeof e=="string"?(hr.getLogger().info("Using custom sampling rules file: "+e),this.rules=Va(JSON.parse(ap.readFileSync(e,"utf8")))):(hr.getLogger().info("Using custom sampling rules source."),this.rules=Va(e)):this.rules=ka(op)}},Va=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return ka(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},ka=function(e){var r,n=[];if(e.default){var i=[];for(var s in e.default){if(s!=="fixed_target"&&s!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+s+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[s]!="number")throw new Error("Error in sampling file. Default "+s+" must be a number.")}if(typeof e.default.fixed_target>"u"&&i.push("fixed_target"),typeof e.default.rate>"u"&&i.push("rate"),i.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+i+".");r={default:!0,reservoir:new Ba(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in a){var l=a[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(o[c]=l),e.version===1&&c==="service_name"?o.host=l:o[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(u)+".");var f=o;f.reservoir=new Ba(a.fixed_target,a.rate),n.push(f)}),n.push(r),n};Ua.setLocalRules();Ga.exports=Ua});var Xa=d((GE,Wa)=>{"use strict";function Ue(){this.init()}Ue.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Ue.prototype.borrowOrTake=function(e,r){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(r)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Ue.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Ue.prototype.loadNewQuota=function(e,r,n){e&&(this.quota=e),r&&(this.TTL=r),n&&(this.reportInterval=n/10)};Ue.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};Wa.exports=Ue});var Ka=d((WE,Ha)=>{"use strict";var ft=M(),up=Xa();function q(t,e,r,n,i,s,a,o,u){this.init(t,e,r,n,i,s,a,o,u)}q.prototype.init=function(e,r,n,i,s,a,o,u,c){this.name=e,this.priority=r,this.rate=n,this.host=s,this.httpMethod=a,this.urlPath=o,this.serviceName=u,this.serviceType=c,this.reservoir=new up,this.borrow=!!i,this.resetStatistics()};q.prototype.match=function(e){var r=e.host,n=e.httpMethod,i=e.serviceName,s=e.urlPath,a=e.serviceType;return this.isDefault()||(!r||ft.wildcardMatch(this.host,r))&&(!n||ft.wildcardMatch(this.httpMethod,n))&&(!i||ft.wildcardMatch(this.serviceName,i))&&(!s||ft.wildcardMatch(this.urlPath,s))&&(!a||ft.wildcardMatch(this.serviceType,a))};q.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};q.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};q.prototype.isDefault=function(){return this.name==="Default"};q.prototype.incrementRequestCount=function(){this.requestCount++};q.prototype.incrementBorrowCount=function(){this.borrowCount++};q.prototype.incrementSampledCount=function(){this.sampledCount++};q.prototype.setRate=function(e){this.rate=e};q.prototype.getRate=function(){return this.rate};q.prototype.getName=function(){return this.name};q.prototype.getPriority=function(){return this.priority};q.prototype.getReservoir=function(){return this.reservoir};q.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};q.prototype.canBorrow=function(){return this.borrow};q.prototype.everMatched=function(){return this.requestCount>0};q.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Ha.exports=q});var Nn=d((XE,Ja)=>{"use strict";var cp=require("crypto"),lp=C(),dp=Ka(),pr=or(),fp=require("util"),hp=require("http"),za={clientId:cp.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:lp,httpClient:hp,fetchSamplingRules:function(e){let r="{}",n=Ya(this.samplingRulesPath,r.length),s=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,a=>{var o="";a.on("data",u=>{o+=u}),a.on("error",u=>{e(u)}),a.on("end",()=>{var u;try{u=JSON.parse(o)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=gp(u);e(null,c)})});s.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),s.write(r),s.end()},fetchTargets:function(e,r){let n=JSON.stringify(pp(e)),i=Ya(this.samplingTargetsPath,n.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(i,o=>{var u="";o.on("data",c=>{u+=c}),o.on("error",c=>{r(c)}),o.on("end",()=>{var c;try{c=JSON.parse(u)}catch(p){r(p);return}if(!c||typeof c.LastRuleModification!="number"){r(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=mp(c),f=Qa(c.LastRuleModification);r(null,l,f)})});a.on("error",()=>{r(new Error(`Failed to connect to X-Ray daemon at ${i.hostname}:${i.port} to get sampling targets.`))}),a.write(n),a.end()}},pp=function(e){var r=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(i){var s=i.snapshotStatistics(),a={RuleName:i.getName(),ClientID:za.clientId,RequestCount:s.requestCount,BorrowCount:s.borrowCount,SampledCount:s.sampledCount,Timestamp:n};r.push(a)}),{SamplingStatisticsDocuments:r}},gp=function(e){var r=[],n=e.SamplingRuleRecords||[];return n.forEach(function(i){if(i=i.SamplingRule,vp(i)){var s=new dp(i.RuleName,i.Priority,i.FixedRate,i.ReservoirSize,i.Host,i.HTTPMethod,i.URLPath,i.ServiceName,i.ServiceType);r.push(s)}}),r},mp=function(e){var r=e.SamplingTargetDocuments||[],n={};return r.forEach(function(i){var s={rate:i.FixedRate,quota:i.ReservoirQuota,TTL:Qa(i.ReservoirQuotaTTL),interval:i.Interval};n[i.RuleName]=s}),n},vp=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Qa=function(e){return new Date(e).getTime()/1e3},Ya=function(e,r){return{hostname:pr.tcp_ip,port:pr.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":r,Host:fp.format("%s:%d",pr.tcp_ip,pr.tcp_port)}}};Ja.exports=za});var gr=d((HE,Za)=>{"use strict";var _p=3600,xn={rules:[],lastUpdated:null,getMatchedRule:function(e,r){if(Ep(r))return null;var n;return this.rules.forEach(function(i){!n&&i.match(e)&&(n=i),i.isDefault()&&!n&&(n=i)}),n},loadRules:function(e){var r={};this.rules.forEach(function(n){r[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var i=r[n.getName()];i&&n.merge(i)}),this.rules.sort(function(n,i){var s=n.getPriority()-i.getPriority();return s!==0?s:n.getName()>i.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(r){var n=e[r.getName()];n&&(r.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),r.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},Ep=function(e){return xn.getLastUpdated()?e>xn.getLastUpdated()+_p:!0};Za.exports=xn});var Mn=d((KE,no)=>{"use strict";var Pn=C(),Sp=Nn(),eo=gr(),bp=5*60*1e3,yp={start:function(){this.poller&&clearInterval(this.poller),to(!1),this.poller=setInterval(to,bp),this.poller.unref()}},to=function(e){if(e=typeof e>"u"?!0:e,e){var r=Ap();setTimeout(ro,r)}else ro()},ro=function(){try{Tp()}catch(e){Pn.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},Tp=function(){var e=Math.floor(new Date().getTime()/1e3);Sp.fetchSamplingRules(function(r,n){r?Pn.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",r):n.length!==0&&(eo.loadRules(n),eo.timestamp(e),Pn.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},Ap=function(){return Math.random()*5};no.exports=yp});var oo=d((YE,ao)=>{"use strict";var Rp=Mn(),wp=Nn(),$n=gr(),mr=C(),io=10*1e3,so={interval:io,start:function(){this.poller=setInterval(Cp,io+Ip()),this.poller.unref()}},Cp=function(){try{Lp()}catch(e){mr.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},Lp=function(){var e=Op();e&&e.length>0&&wp.fetchTargets(e,function(r,n,i){if(r){mr.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",r);return}$n.loadTargets(n),i>$n.getLastUpdated()&&(mr.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),Rp.start()),mr.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},Op=function(){var e=$n.getRules(),r=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&r.push(n)}),r},Ip=function(){return Math.random()/so.interval};ao.exports=so});var co=d((zE,uo)=>{"use strict";var Dn=C(),qp=require("util"),Np=ge(),xp={localSampler:qn(),rulePoller:Mn(),targetPoller:oo(),ruleCache:gr(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=Np.origin);var r=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,r);return n?(Dn.getLogger().debug(qp.format("Rule %s is matched.",n.getName())),Pp(n,r)):(Dn.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(i){Dn.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+i)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},Pp=function(e,r){e.incrementRequestCount();var n=e.getReservoir(),i=!0,s=n.borrowOrTake(r,e.canBorrow());return s==="borrow"?e.incrementBorrowCount():s==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():i=!1,i?e.getName():!1};uo.exports=xp});var Fn=d((QE,lo)=>{"use strict";var Mp=lt(),$p=Ln(),Dp=C(),jp=M(),Fp=M().wildcardMatch,Bp=M().processTraceData,jn="x-amzn-trace-id",Vp=!!process.env.AWS_XRAY_TRACING_NAME,Up={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:co(),enableDynamicNaming:function(t){if(this.dynamicNaming=!0,t&&typeof t!="string")throw new Error("Host pattern must be a string.");this.hostPattern=t||null},processHeaders:function(e){var r={};return e&&e.headers&&e.headers[jn]&&(r=Bp(e.headers[jn])),r},resolveName:function(e){var r;return this.dynamicNaming&&e?r=this.hostPattern?Fp(this.hostPattern,e)?e:this.defaultName:e:r=this.defaultName,r},resolveSampling:function(e,r,n){var i;if(e.sampled==="1")i=!0;else if(e.sampled==="0")i=!1;else{var s={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:r.name};i=this.sampler.shouldSample(s),(i instanceof String||typeof i=="string")&&(r.setMatchedSamplingRule(i),i=!0)}e.sampled==="?"&&(n.header[jn]="Root="+e.root+";Sampled="+(i?"1":"0")),i||(r.notTraced=!0)},setDefaultName:function(e){Vp||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=qn()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,r,n){Dp.getLogger().debug(e+": { url: "+r+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,r){var n=this.processHeaders(e),i=this.resolveName(e.headers.host),s=new Mp(i,n.root,n.parent),a=Object.assign({},r,{req:e});this.resolveSampling(n,s,a),s.addIncomingRequestData(new $p(e)),this.middlewareLog("Starting middleware segment",e.url,s);var o=this.middlewareLog,u=!1,c=function(){if(u)return;u=!0,r.statusCode===429&&s.addThrottleFlag();let l=jp.getCauseTypeFromHttpStatus(r.statusCode);l&&(s[l]=!0),s.http.close(r),s.close(),o("Closed middleware segment successfully",e.url,s)};return r.on("finish",c),r.on("close",c),s}};lo.exports=Up});var po=d((JE,ho)=>{"use strict";var vr=Ee(),kp=Fn(),Bn=M().LambdaUtils,Gp=lt(),Wp=cr(),Xp=ge(),Un=C(),fo=dr(),Vn=null;ho.exports.init=function(){vr.enableManualMode=function(){Un.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Wp.disableReusableSocket(),Xp.setStreamingThreshold(0),Un.getLogger().info("Disabling centralized sampling in Lambda environment."),kp.disableCentralizedSampling();var e=vr.getNamespace();e.enter(e.createContext()),vr.setSegment(Hp())};var Hp=function(){var e=new Gp("facade"),r=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],i=process.env._X_AMZN_TRACE_ID;for(var s in e)typeof e[s]=="function"&&r.indexOf(s)===-1&&(n.indexOf(s)===-1?e[s]=function(){var a=s;return function(){Un.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[s]=function(){});return e.trace_id=fo.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=fo.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){var o=process.env._X_AMZN_TRACE_ID;o?o!=Vn&&(this.reset(),Bn.populateTraceData(e,o)&&(Vn=o)):(this.reset(),vr.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},Bn.validTraceData(i)&&Bn.populateTraceData(e,i)&&(Vn=i),e}});var go=d((ZE,Kp)=>{Kp.exports={name:"aws-xray-sdk-core",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/service-error-classification":"^3.4.1","@aws-sdk/types":"^3.4.1","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.3.8"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov && codecov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var _o=d((eS,vo)=>{"use strict";var kn=require("http"),mo={METADATA_TIMEOUT:1e3,getPluginMetadata:function(t,e){var i=5,s=function(){var a=kn.__request?kn.__request:kn.request,o=a(t,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else i>0&&Math.floor(this.statusCode/100)===5?(i--,setTimeout(s,250)):e(new Error(`Failed to retrieve metadata with options: ${t}`))})});o.on("error",function(u){e(u)}),o.on("timeout",function(){o.abort()}),o.setTimeout(mo.METADATA_TIMEOUT),o.end()};s()}};vo.exports=mo});var To=d((tS,yo)=>{"use strict";var So=_o(),Eo=C(),Gn=require("http"),Yp={getData:function(t){let e="/latest/dynamic/instance-identity/document";function r(n){let i=bo(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});So.getPluginMetadata(i,function(s,a){if(s||!a){Eo.getLogger().error("Error loading EC2 plugin metadata: ",s?s.toString():"Could not retrieve data from IMDS."),t();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};t(o)})}zp(function(n){n===null&&Eo.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),r(n)})},originName:"AWS::EC2::Instance"};function zp(t){let e=Gn.__request?Gn.__request:Gn.request,i=bo("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),s=e(i,function(a){let o="";a.on("data",function(u){o+=u}),a.on("end",function(){this.statusCode===200||this.statusCode===300?t(o):t(null)})});s.on("error",function(){t(null)}),s.on("timeout",function(){s.abort(),t(null)}),s.setTimeout(So.METADATA_TIMEOUT),s.end()}function bo(t,e,r){return e||(e="GET"),r||(r={}),{host:"169.254.169.254",path:t,method:e,headers:r}}yo.exports=Yp});var Ro=d((rS,Ao)=>{"use strict";var Qp=require("os"),Jp={getData:function(t){t({ecs:{container:Qp.hostname()}})},originName:"AWS::ECS::Container"};Ao.exports=Jp});var Co=d((nS,wo)=>{"use strict";var Zp=require("fs"),eg=C(),tg="/var/elasticbeanstalk/xray/environment.conf",rg={getData:function(t){Zp.readFile(tg,"utf8",function(e,r){if(e)eg.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),t();else{var n=JSON.parse(r),i={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};t(i)}})},originName:"AWS::ElasticBeanstalk::Environment"};wo.exports=rg});var Lo=d((iS,ng)=>{ng.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Po=d((sS,xo)=>{"use strict";var qo=require("fs"),ke=C(),ig=Lo(),_r={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function Sr(t){this.init(t)}Sr.prototype.init=function(e){e?typeof e=="string"?(ke.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Er(JSON.parse(qo.readFileSync(e,"utf8")))):(ke.getLogger().info("Using custom AWS whitelist source."),this.services=Er(e)):this.services=ig.services};Sr.prototype.append=function(e){var r={};typeof e=="string"?(ke.getLogger().info("Appending AWS whitelist with custom file: "+e),r=Er(JSON.parse(qo.readFileSync(e,"utf8")))):(ke.getLogger().info("Appending AWS whitelist with a custom source."),r=Er(e));for(var n in r)this.services[n]=r[n]};Sr.prototype.capture=function(e,r){var n=r.request.operation,i=this.services[e]!==void 0?this.services[e].operations[n]:null;if(i===null){ke.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var s={};for(var a in i){var o=i[a];a===_r.REQ_PARAMS?Oo(o,r.request.params,s):a===_r.REQ_DESC?Io(o,r.request.params,s):a===_r.RES_PARAMS?r.data&&Oo(o,r.data,s):a===_r.RES_DESC?r.data&&Io(o,r.data,s):ke.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return s};function Oo(t,e,r){t.forEach(function(n){if(typeof e[n]<"u"){var i=No(n);this[i]=e[n]}},r)}function Io(t,e,r){for(var n in t){var i=t[n];if(typeof e[n]<"u"){var s;if(i.list&&i.get_count?s=e[n]?e[n].length:0:s=i.get_keys===!0?Object.keys(e[n]):e[n],typeof i.rename_to=="string")r[i.rename_to]=s;else{var a=No(n);r[a]=s}}}}function No(t){return t==="IPAddress"?"ip_address":t.split(/(?=[A-Z])/).join("_").toLowerCase()}function Er(t){var e=t;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}xo.exports=Sr});var ht=d((aS,br)=>{"use strict";var Mo=Po(),Wn=new Mo;function Xn(t,e){this.init(t,e)}Xn.prototype.init=function(e,r){this.operation=og(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&r&&r.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),r&&this.addData(Wn.capture(r.toLowerCase(),e))};Xn.prototype.addData=function(e){for(var r in e)this[r]=e[r]};var sg=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Wn=new Mo(e)},ag=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Wn.append(e)};function og(t){if(t)return t.charAt(0).toUpperCase()+t.slice(1)}br.exports=Xn;br.exports.appendAWSWhitelist=ag;br.exports.setAWSWhitelist=sg});var Tr=d((oS,yr)=>{"use strict";var Oe=Ee(),pt=C(),$o=function(e,r,n){Hn(e,r);var i,s,a=Oe.resolveSegment(n);if(!a)return pt.getLogger().warn("Failed to capture function."),r();i=a.addNewSubsegment(e),s=Do(r,i);try{let o=s(i);return i.close(),o}catch(o){throw i.close(o),o}},ug=function(e,r,n){Hn(e,r);var i,s,a=Oe.resolveSegment(n);if(!a)return pt.getLogger().warn("Failed to capture async function."),r();i=a.addNewSubsegment(e),s=Do(r,i);try{return s(i)}catch(o){throw i.close(o),o}},cg=function(e,r,n){Hn(e,r);var i=Oe.resolveSegment(n);return i?(i.incrementCounter(),function(){var s=Oe.resolveSegment(n),a=Array.prototype.slice.call(arguments);$o(e,r.bind.apply(r,[null].concat(a)),s),i.decrementCounter()}.bind(this)):(pt.getLogger().warn("Failed to capture callback function."),r)};function Do(t,e){var r;if(Oe.isAutomaticMode()){var n=Oe.getNamespace(),i=function(){var s;return n.run(function(){Oe.setSegment(e),s=t(e)}),s};r=i}else r=t;return r}function Hn(t,e){var r;if(!t||typeof t!="string")throw r='Param "name" must be a non-empty string.',pt.getLogger().error(r),new Error(r);if(typeof e!="function")throw r='Param "fcn" must be a function.',pt.getLogger().error(r),new Error(r)}yr.exports.captureFunc=$o;yr.exports.captureAsyncFunc=ug;yr.exports.captureCallbackFunc=cg});var gt=d((uS,jo)=>{var lg="2.0.0",dg=Number.MAX_SAFE_INTEGER||9007199254740991,fg=16,hg=256-6,pg=["major","premajor","minor","preminor","patch","prepatch","prerelease"];jo.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:fg,MAX_SAFE_BUILD_LENGTH:hg,MAX_SAFE_INTEGER:dg,RELEASE_TYPES:pg,SEMVER_SPEC_VERSION:lg,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var mt=d((cS,Fo)=>{var gg=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Fo.exports=gg});var Ge=d((ae,Bo)=>{var{MAX_SAFE_COMPONENT_LENGTH:Kn,MAX_SAFE_BUILD_LENGTH:mg,MAX_LENGTH:vg}=gt(),_g=mt();ae=Bo.exports={};var Eg=ae.re=[],Sg=ae.safeRe=[],g=ae.src=[],m=ae.t={},bg=0,Yn="[a-zA-Z0-9-]",yg=[["\\s",1],["\\d",vg],[Yn,mg]],Tg=t=>{for(let[e,r]of yg)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},v=(t,e,r)=>{let n=Tg(e),i=bg++;_g(t,i,e),m[t]=i,g[i]=e,Eg[i]=new RegExp(e,r?"g":void 0),Sg[i]=new RegExp(n,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","\\d+");v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Yn}*`);v("MAINVERSION",`(${g[m.NUMERICIDENTIFIER]})\\.(${g[m.NUMERICIDENTIFIER]})\\.(${g[m.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${g[m.NUMERICIDENTIFIERLOOSE]})\\.(${g[m.NUMERICIDENTIFIERLOOSE]})\\.(${g[m.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${g[m.NUMERICIDENTIFIER]}|${g[m.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${g[m.NUMERICIDENTIFIERLOOSE]}|${g[m.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${g[m.PRERELEASEIDENTIFIER]}(?:\\.${g[m.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${g[m.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${g[m.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER",`${Yn}+`);v("BUILD",`(?:\\+(${g[m.BUILDIDENTIFIER]}(?:\\.${g[m.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${g[m.MAINVERSION]}${g[m.PRERELEASE]}?${g[m.BUILD]}?`);v("FULL",`^${g[m.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${g[m.MAINVERSIONLOOSE]}${g[m.PRERELEASELOOSE]}?${g[m.BUILD]}?`);v("LOOSE",`^${g[m.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${g[m.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${g[m.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${g[m.XRANGEIDENTIFIER]})(?:\\.(${g[m.XRANGEIDENTIFIER]})(?:\\.(${g[m.XRANGEIDENTIFIER]})(?:${g[m.PRERELEASE]})?${g[m.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${g[m.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[m.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[m.XRANGEIDENTIFIERLOOSE]})(?:${g[m.PRERELEASELOOSE]})?${g[m.BUILD]}?)?)?`);v("XRANGE",`^${g[m.GTLT]}\\s*${g[m.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${g[m.GTLT]}\\s*${g[m.XRANGEPLAINLOOSE]}$`);v("COERCE",`(^|[^\\d])(\\d{1,${Kn}})(?:\\.(\\d{1,${Kn}}))?(?:\\.(\\d{1,${Kn}}))?(?:$|[^\\d])`);v("COERCERTL",g[m.COERCE],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${g[m.LONETILDE]}\\s+`,!0);ae.tildeTrimReplace="$1~";v("TILDE",`^${g[m.LONETILDE]}${g[m.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${g[m.LONETILDE]}${g[m.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${g[m.LONECARET]}\\s+`,!0);ae.caretTrimReplace="$1^";v("CARET",`^${g[m.LONECARET]}${g[m.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${g[m.LONECARET]}${g[m.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${g[m.GTLT]}\\s*(${g[m.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${g[m.GTLT]}\\s*(${g[m.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${g[m.GTLT]}\\s*(${g[m.LOOSEPLAIN]}|${g[m.XRANGEPLAIN]})`,!0);ae.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${g[m.XRANGEPLAIN]})\\s+-\\s+(${g[m.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${g[m.XRANGEPLAINLOOSE]})\\s+-\\s+(${g[m.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Ar=d((lS,Vo)=>{var Ag=Object.freeze({loose:!0}),Rg=Object.freeze({}),wg=t=>t?typeof t!="object"?Ag:t:Rg;Vo.exports=wg});var zn=d((dS,Go)=>{var Uo=/^[0-9]+$/,ko=(t,e)=>{let r=Uo.test(t),n=Uo.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},Cg=(t,e)=>ko(e,t);Go.exports={compareIdentifiers:ko,rcompareIdentifiers:Cg}});var D=d((fS,Ko)=>{var Rr=mt(),{MAX_LENGTH:Wo,MAX_SAFE_INTEGER:wr}=gt(),{safeRe:Xo,t:Ho}=Ge(),Lg=Ar(),{compareIdentifiers:We}=zn(),Qn=class t{constructor(e,r){if(r=Lg(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Wo)throw new TypeError(`version is longer than ${Wo} characters`);Rr("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?Xo[Ho.LOOSE]:Xo[Ho.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>wr||this.major<0)throw new TypeError("Invalid major version");if(this.minor>wr||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>wr||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<wr)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Rr("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),We(this.major,e.major)||We(this.minor,e.minor)||We(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],i=e.prerelease[r];if(Rr("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return We(n,i)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],i=e.build[r];if(Rr("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return We(n,i)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(r){let s=[r,i];n===!1&&(s=[r]),We(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Ko.exports=Qn});var Ie=d((hS,zo)=>{var Yo=D(),Og=(t,e,r=!1)=>{if(t instanceof Yo)return t;try{return new Yo(t,e)}catch(n){if(!r)return null;throw n}};zo.exports=Og});var Jo=d((pS,Qo)=>{var Ig=Ie(),qg=(t,e)=>{let r=Ig(t,e);return r?r.version:null};Qo.exports=qg});var eu=d((gS,Zo)=>{var Ng=Ie(),xg=(t,e)=>{let r=Ng(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};Zo.exports=xg});var nu=d((mS,ru)=>{var tu=D(),Pg=(t,e,r,n,i)=>{typeof r=="string"&&(i=n,n=r,r=void 0);try{return new tu(t instanceof tu?t.version:t,r).inc(e,n,i).version}catch{return null}};ru.exports=Pg});var au=d((vS,su)=>{var iu=Ie(),Mg=(t,e)=>{let r=iu(t,null,!0),n=iu(e,null,!0),i=r.compare(n);if(i===0)return null;let s=i>0,a=s?r:n,o=s?n:r,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u)return!o.patch&&!o.minor?"major":a.patch?"patch":a.minor?"minor":"major";let l=u?"pre":"";return r.major!==n.major?l+"major":r.minor!==n.minor?l+"minor":r.patch!==n.patch?l+"patch":"prerelease"};su.exports=Mg});var uu=d((_S,ou)=>{var $g=D(),Dg=(t,e)=>new $g(t,e).major;ou.exports=Dg});var lu=d((ES,cu)=>{var jg=D(),Fg=(t,e)=>new jg(t,e).minor;cu.exports=Fg});var fu=d((SS,du)=>{var Bg=D(),Vg=(t,e)=>new Bg(t,e).patch;du.exports=Vg});var pu=d((bS,hu)=>{var Ug=Ie(),kg=(t,e)=>{let r=Ug(t,e);return r&&r.prerelease.length?r.prerelease:null};hu.exports=kg});var G=d((yS,mu)=>{var gu=D(),Gg=(t,e,r)=>new gu(t,r).compare(new gu(e,r));mu.exports=Gg});var _u=d((TS,vu)=>{var Wg=G(),Xg=(t,e,r)=>Wg(e,t,r);vu.exports=Xg});var Su=d((AS,Eu)=>{var Hg=G(),Kg=(t,e)=>Hg(t,e,!0);Eu.exports=Kg});var Cr=d((RS,yu)=>{var bu=D(),Yg=(t,e,r)=>{let n=new bu(t,r),i=new bu(e,r);return n.compare(i)||n.compareBuild(i)};yu.exports=Yg});var Au=d((wS,Tu)=>{var zg=Cr(),Qg=(t,e)=>t.sort((r,n)=>zg(r,n,e));Tu.exports=Qg});var wu=d((CS,Ru)=>{var Jg=Cr(),Zg=(t,e)=>t.sort((r,n)=>Jg(n,r,e));Ru.exports=Zg});var vt=d((LS,Cu)=>{var em=G(),tm=(t,e,r)=>em(t,e,r)>0;Cu.exports=tm});var Lr=d((OS,Lu)=>{var rm=G(),nm=(t,e,r)=>rm(t,e,r)<0;Lu.exports=nm});var Jn=d((IS,Ou)=>{var im=G(),sm=(t,e,r)=>im(t,e,r)===0;Ou.exports=sm});var Zn=d((qS,Iu)=>{var am=G(),om=(t,e,r)=>am(t,e,r)!==0;Iu.exports=om});var Or=d((NS,qu)=>{var um=G(),cm=(t,e,r)=>um(t,e,r)>=0;qu.exports=cm});var Ir=d((xS,Nu)=>{var lm=G(),dm=(t,e,r)=>lm(t,e,r)<=0;Nu.exports=dm});var ei=d((PS,xu)=>{var fm=Jn(),hm=Zn(),pm=vt(),gm=Or(),mm=Lr(),vm=Ir(),_m=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return fm(t,r,n);case"!=":return hm(t,r,n);case">":return pm(t,r,n);case">=":return gm(t,r,n);case"<":return mm(t,r,n);case"<=":return vm(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};xu.exports=_m});var Mu=d((MS,Pu)=>{var Em=D(),Sm=Ie(),{safeRe:qr,t:Nr}=Ge(),bm=(t,e)=>{if(t instanceof Em)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(qr[Nr.COERCE]);else{let n;for(;(n=qr[Nr.COERCERTL].exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||n.index+n[0].length!==r.index+r[0].length)&&(r=n),qr[Nr.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;qr[Nr.COERCERTL].lastIndex=-1}return r===null?null:Sm(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,e)};Pu.exports=bm});var Du=d(($S,$u)=>{"use strict";$u.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}});var Fu=d((DS,ju)=>{"use strict";ju.exports=_;_.Node=qe;_.create=_;function _(t){var e=this;if(e instanceof _||(e=new _),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(i){e.push(i)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}_.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};_.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};_.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};_.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)Tm(this,arguments[t]);return this.length};_.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)Am(this,arguments[t]);return this.length};_.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};_.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};_.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};_.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};_.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};_.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};_.prototype.map=function(t,e){e=e||this;for(var r=new _,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};_.prototype.mapReverse=function(t,e){e=e||this;for(var r=new _,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};_.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;n!==null;i++)r=t(r,n.value,i),n=n.next;return r};_.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;n!==null;i--)r=t(r,n.value,i),n=n.prev;return r};_.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};_.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};_.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(;i!==null&&n<e;n++,i=i.next)r.push(i.value);return r};_.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,i=this.tail;i!==null&&n>e;n--)i=i.prev;for(;i!==null&&n>t;n--,i=i.prev)r.push(i.value);return r};_.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(var s=[],n=0;i&&n<e;n++)s.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var n=0;n<r.length;n++)i=ym(this,i,r[n]);return s};_.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function ym(t,e,r){var n=e===t.head?new qe(r,null,e,t):new qe(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function Tm(t,e){t.tail=new qe(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function Am(t,e){t.head=new qe(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function qe(t,e,r,n){if(!(this instanceof qe))return new qe(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{Du()(_)}catch{}});var Gu=d((jS,ku)=>{"use strict";var Rm=Fu(),Ne=Symbol("max"),ue=Symbol("length"),Xe=Symbol("lengthCalculator"),Et=Symbol("allowStale"),xe=Symbol("maxAge"),oe=Symbol("dispose"),Bu=Symbol("noDisposeOnSet"),N=Symbol("lruList"),K=Symbol("cache"),Uu=Symbol("updateAgeOnGet"),ti=()=>1,ni=class{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");let r=this[Ne]=e.max||1/0,n=e.length||ti;if(this[Xe]=typeof n!="function"?ti:n,this[Et]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[xe]=e.maxAge||0,this[oe]=e.dispose,this[Bu]=e.noDisposeOnSet||!1,this[Uu]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[Ne]=e||1/0,_t(this)}get max(){return this[Ne]}set allowStale(e){this[Et]=!!e}get allowStale(){return this[Et]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[xe]=e,_t(this)}get maxAge(){return this[xe]}set lengthCalculator(e){typeof e!="function"&&(e=ti),e!==this[Xe]&&(this[Xe]=e,this[ue]=0,this[N].forEach(r=>{r.length=this[Xe](r.value,r.key),this[ue]+=r.length})),_t(this)}get lengthCalculator(){return this[Xe]}get length(){return this[ue]}get itemCount(){return this[N].length}rforEach(e,r){r=r||this;for(let n=this[N].tail;n!==null;){let i=n.prev;Vu(this,e,n,r),n=i}}forEach(e,r){r=r||this;for(let n=this[N].head;n!==null;){let i=n.next;Vu(this,e,n,r),n=i}}keys(){return this[N].toArray().map(e=>e.key)}values(){return this[N].toArray().map(e=>e.value)}reset(){this[oe]&&this[N]&&this[N].length&&this[N].forEach(e=>this[oe](e.key,e.value)),this[K]=new Map,this[N]=new Rm,this[ue]=0}dump(){return this[N].map(e=>xr(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[N]}set(e,r,n){if(n=n||this[xe],n&&typeof n!="number")throw new TypeError("maxAge must be a number");let i=n?Date.now():0,s=this[Xe](r,e);if(this[K].has(e)){if(s>this[Ne])return He(this,this[K].get(e)),!1;let u=this[K].get(e).value;return this[oe]&&(this[Bu]||this[oe](e,u.value)),u.now=i,u.maxAge=n,u.value=r,this[ue]+=s-u.length,u.length=s,this.get(e),_t(this),!0}let a=new ii(e,r,s,i,n);return a.length>this[Ne]?(this[oe]&&this[oe](e,r),!1):(this[ue]+=a.length,this[N].unshift(a),this[K].set(e,this[N].head),_t(this),!0)}has(e){if(!this[K].has(e))return!1;let r=this[K].get(e).value;return!xr(this,r)}get(e){return ri(this,e,!0)}peek(e){return ri(this,e,!1)}pop(){let e=this[N].tail;return e?(He(this,e),e.value):null}del(e){He(this,this[K].get(e))}load(e){this.reset();let r=Date.now();for(let n=e.length-1;n>=0;n--){let i=e[n],s=i.e||0;if(s===0)this.set(i.k,i.v);else{let a=s-r;a>0&&this.set(i.k,i.v,a)}}}prune(){this[K].forEach((e,r)=>ri(this,r,!1))}},ri=(t,e,r)=>{let n=t[K].get(e);if(n){let i=n.value;if(xr(t,i)){if(He(t,n),!t[Et])return}else r&&(t[Uu]&&(n.value.now=Date.now()),t[N].unshiftNode(n));return i.value}},xr=(t,e)=>{if(!e||!e.maxAge&&!t[xe])return!1;let r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[xe]&&r>t[xe]},_t=t=>{if(t[ue]>t[Ne])for(let e=t[N].tail;t[ue]>t[Ne]&&e!==null;){let r=e.prev;He(t,e),e=r}},He=(t,e)=>{if(e){let r=e.value;t[oe]&&t[oe](r.key,r.value),t[ue]-=r.length,t[K].delete(r.key),t[N].removeNode(e)}},ii=class{constructor(e,r,n,i,s){this.key=e,this.value=r,this.length=n,this.now=i,this.maxAge=s||0}},Vu=(t,e,r,n)=>{let i=r.value;xr(t,i)&&(He(t,r),t[Et]||(i=void 0)),i&&e.call(n,i.value,i.key,t)};ku.exports=ni});var W=d((FS,Ku)=>{var si=class t{constructor(e,r){if(r=Cm(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof ai)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!Xu(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&Pm(i[0])){this.set=[i];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&Nm)|(this.options.loose&&xm))+":"+e,i=Wu.get(n);if(i)return i;let s=this.options.loose,a=s?U[F.HYPHENRANGELOOSE]:U[F.HYPHENRANGE];e=e.replace(a,Gm(this.options.includePrerelease)),R("hyphen replace",e),e=e.replace(U[F.COMPARATORTRIM],Om),R("comparator trim",e),e=e.replace(U[F.TILDETRIM],Im),R("tilde trim",e),e=e.replace(U[F.CARETTRIM],qm),R("caret trim",e);let o=e.split(" ").map(f=>Mm(f,this.options)).join(" ").split(/\s+/).map(f=>km(f,this.options));s&&(o=o.filter(f=>(R("loose invalid filter",f,this.options),!!f.match(U[F.COMPARATORLOOSE])))),R("range list",o);let u=new Map,c=o.map(f=>new ai(f,this.options));for(let f of c){if(Xu(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return Wu.set(n,l),l}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>Hu(n,r)&&e.set.some(i=>Hu(i,r)&&n.every(s=>i.every(a=>s.intersects(a,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Lm(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(Wm(this.set[r],e,this.options))return!0;return!1}};Ku.exports=si;var wm=Gu(),Wu=new wm({max:1e3}),Cm=Ar(),ai=St(),R=mt(),Lm=D(),{safeRe:U,t:F,comparatorTrimReplace:Om,tildeTrimReplace:Im,caretTrimReplace:qm}=Ge(),{FLAG_INCLUDE_PRERELEASE:Nm,FLAG_LOOSE:xm}=gt(),Xu=t=>t.value==="<0.0.0-0",Pm=t=>t.value==="",Hu=(t,e)=>{let r=!0,n=t.slice(),i=n.pop();for(;r&&n.length;)r=n.every(s=>i.intersects(s,e)),i=n.pop();return r},Mm=(t,e)=>(R("comp",t,e),t=jm(t,e),R("caret",t),t=$m(t,e),R("tildes",t),t=Bm(t,e),R("xrange",t),t=Um(t,e),R("stars",t),t),B=t=>!t||t.toLowerCase()==="x"||t==="*",$m=(t,e)=>t.trim().split(/\s+/).map(r=>Dm(r,e)).join(" "),Dm=(t,e)=>{let r=e.loose?U[F.TILDELOOSE]:U[F.TILDE];return t.replace(r,(n,i,s,a,o)=>{R("tilde",t,n,i,s,a,o);let u;return B(i)?u="":B(s)?u=`>=${i}.0.0 <${+i+1}.0.0-0`:B(a)?u=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:o?(R("replaceTilde pr",o),u=`>=${i}.${s}.${a}-${o} <${i}.${+s+1}.0-0`):u=`>=${i}.${s}.${a} <${i}.${+s+1}.0-0`,R("tilde return",u),u})},jm=(t,e)=>t.trim().split(/\s+/).map(r=>Fm(r,e)).join(" "),Fm=(t,e)=>{R("caret",t,e);let r=e.loose?U[F.CARETLOOSE]:U[F.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(i,s,a,o,u)=>{R("caret",t,i,s,a,o,u);let c;return B(s)?c="":B(a)?c=`>=${s}.0.0${n} <${+s+1}.0.0-0`:B(o)?s==="0"?c=`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:u?(R("replaceCaret pr",u),s==="0"?a==="0"?c=`>=${s}.${a}.${o}-${u} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}-${u} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o}-${u} <${+s+1}.0.0-0`):(R("no pr"),s==="0"?a==="0"?c=`>=${s}.${a}.${o}${n} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o} <${+s+1}.0.0-0`),R("caret return",c),c})},Bm=(t,e)=>(R("replaceXRanges",t,e),t.split(/\s+/).map(r=>Vm(r,e)).join(" ")),Vm=(t,e)=>{t=t.trim();let r=e.loose?U[F.XRANGELOOSE]:U[F.XRANGE];return t.replace(r,(n,i,s,a,o,u)=>{R("xRange",t,n,i,s,a,o,u);let c=B(s),l=c||B(a),f=l||B(o),p=f;return i==="="&&p&&(i=""),u=e.includePrerelease?"-0":"",c?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&p?(l&&(a=0),o=0,i===">"?(i=">=",l?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",l?s=+s+1:a=+a+1),i==="<"&&(u="-0"),n=`${i+s}.${a}.${o}${u}`):l?n=`>=${s}.0.0${u} <${+s+1}.0.0-0`:f&&(n=`>=${s}.${a}.0${u} <${s}.${+a+1}.0-0`),R("xRange return",n),n})},Um=(t,e)=>(R("replaceStars",t,e),t.trim().replace(U[F.STAR],"")),km=(t,e)=>(R("replaceGTE0",t,e),t.trim().replace(U[e.includePrerelease?F.GTE0PRE:F.GTE0],"")),Gm=t=>(e,r,n,i,s,a,o,u,c,l,f,p,h)=>(B(n)?r="":B(i)?r=`>=${n}.0.0${t?"-0":""}`:B(s)?r=`>=${n}.${i}.0${t?"-0":""}`:a?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,B(c)?u="":B(l)?u=`<${+c+1}.0.0-0`:B(f)?u=`<${c}.${+l+1}.0-0`:p?u=`<=${c}.${l}.${f}-${p}`:t?u=`<${c}.${l}.${+f+1}-0`:u=`<=${u}`,`${r} ${u}`.trim()),Wm=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(R(t[n].semver),t[n].semver!==ai.ANY&&t[n].semver.prerelease.length>0){let i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var St=d((BS,ec)=>{var bt=Symbol("SemVer ANY"),ci=class t{static get ANY(){return bt}constructor(e,r){if(r=Yu(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),ui("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===bt?this.value="":this.value=this.operator+this.semver.version,ui("comp",this)}parse(e){let r=this.options.loose?zu[Qu.COMPARATORLOOSE]:zu[Qu.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ju(n[2],this.options.loose):this.semver=bt}toString(){return this.value}test(e){if(ui("Comparator.test",e,this.options.loose),this.semver===bt||e===bt)return!0;if(typeof e=="string")try{e=new Ju(e,this.options)}catch{return!1}return oi(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Zu(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new Zu(this.value,r).test(e.semver):(r=Yu(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||oi(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||oi(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};ec.exports=ci;var Yu=Ar(),{safeRe:zu,t:Qu}=Ge(),oi=ei(),ui=mt(),Ju=D(),Zu=W()});var yt=d((VS,tc)=>{var Xm=W(),Hm=(t,e,r)=>{try{e=new Xm(e,r)}catch{return!1}return e.test(t)};tc.exports=Hm});var nc=d((US,rc)=>{var Km=W(),Ym=(t,e)=>new Km(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));rc.exports=Ym});var sc=d((kS,ic)=>{var zm=D(),Qm=W(),Jm=(t,e,r)=>{let n=null,i=null,s=null;try{s=new Qm(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new zm(n,r))}),n};ic.exports=Jm});var oc=d((GS,ac)=>{var Zm=D(),ev=W(),tv=(t,e,r)=>{let n=null,i=null,s=null;try{s=new ev(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new Zm(n,r))}),n};ac.exports=tv});var lc=d((WS,cc)=>{var li=D(),rv=W(),uc=vt(),nv=(t,e)=>{t=new rv(t,e);let r=new li("0.0.0");if(t.test(r)||(r=new li("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let i=t.set[n],s=null;i.forEach(a=>{let o=new li(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||uc(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!r||uc(r,s))&&(r=s)}return r&&t.test(r)?r:null};cc.exports=nv});var fc=d((XS,dc)=>{var iv=W(),sv=(t,e)=>{try{return new iv(t,e).range||"*"}catch{return null}};dc.exports=sv});var Pr=d((HS,mc)=>{var av=D(),gc=St(),{ANY:ov}=gc,uv=W(),cv=yt(),hc=vt(),pc=Lr(),lv=Ir(),dv=Or(),fv=(t,e,r,n)=>{t=new av(t,n),e=new uv(e,n);let i,s,a,o,u;switch(r){case">":i=hc,s=lv,a=pc,o=">",u=">=";break;case"<":i=pc,s=dv,a=hc,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(cv(t,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],f=null,p=null;if(l.forEach(h=>{h.semver===ov&&(h=new gc(">=0.0.0")),f=f||h,p=p||h,i(h.semver,f.semver,n)?f=h:a(h.semver,p.semver,n)&&(p=h)}),f.operator===o||f.operator===u||(!p.operator||p.operator===o)&&s(t,p.semver))return!1;if(p.operator===u&&a(t,p.semver))return!1}return!0};mc.exports=fv});var _c=d((KS,vc)=>{var hv=Pr(),pv=(t,e,r)=>hv(t,e,">",r);vc.exports=pv});var Sc=d((YS,Ec)=>{var gv=Pr(),mv=(t,e,r)=>gv(t,e,"<",r);Ec.exports=mv});var Tc=d((zS,yc)=>{var bc=W(),vv=(t,e,r)=>(t=new bc(t,r),e=new bc(e,r),t.intersects(e,r));yc.exports=vv});var Rc=d((QS,Ac)=>{var _v=yt(),Ev=G();Ac.exports=(t,e,r)=>{let n=[],i=null,s=null,a=t.sort((l,f)=>Ev(l,f,r));for(let l of a)_v(l,e,r)?(s=l,i||(i=l)):(s&&n.push([i,s]),s=null,i=null);i&&n.push([i,null]);let o=[];for(let[l,f]of n)l===f?o.push(l):!f&&l===a[0]?o.push("*"):f?l===a[0]?o.push(`<=${f}`):o.push(`${l} - ${f}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var qc=d((JS,Ic)=>{var wc=W(),fi=St(),{ANY:di}=fi,Tt=yt(),hi=G(),Sv=(t,e,r={})=>{if(t===e)return!0;t=new wc(t,r),e=new wc(e,r);let n=!1;e:for(let i of t.set){for(let s of e.set){let a=yv(i,s,r);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},bv=[new fi(">=0.0.0-0")],Cc=[new fi(">=0.0.0")],yv=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===di){if(e.length===1&&e[0].semver===di)return!0;r.includePrerelease?t=bv:t=Cc}if(e.length===1&&e[0].semver===di){if(r.includePrerelease)return!0;e=Cc}let n=new Set,i,s;for(let h of t)h.operator===">"||h.operator===">="?i=Lc(i,h,r):h.operator==="<"||h.operator==="<="?s=Oc(s,h,r):n.add(h.semver);if(n.size>1)return null;let a;if(i&&s){if(a=hi(i.semver,s.semver,r),a>0)return null;if(a===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let h of n){if(i&&!Tt(h,String(i),r)||s&&!Tt(h,String(s),r))return null;for(let x of e)if(!Tt(h,String(x),r))return!1;return!0}let o,u,c,l,f=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",i){if(p&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===p.major&&h.semver.minor===p.minor&&h.semver.patch===p.patch&&(p=!1),h.operator===">"||h.operator===">="){if(o=Lc(i,h,r),o===h&&o!==i)return!1}else if(i.operator===">="&&!Tt(i.semver,String(h),r))return!1}if(s){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator==="<"||h.operator==="<="){if(u=Oc(s,h,r),u===h&&u!==s)return!1}else if(s.operator==="<="&&!Tt(s.semver,String(h),r))return!1}if(!h.operator&&(s||i)&&a!==0)return!1}return!(i&&c&&!s&&a!==0||s&&l&&!i&&a!==0||p||f)},Lc=(t,e,r)=>{if(!t)return e;let n=hi(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},Oc=(t,e,r)=>{if(!t)return e;let n=hi(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};Ic.exports=Sv});var Mc=d((ZS,Pc)=>{var pi=Ge(),Nc=gt(),Tv=D(),xc=zn(),Av=Ie(),Rv=Jo(),wv=eu(),Cv=nu(),Lv=au(),Ov=uu(),Iv=lu(),qv=fu(),Nv=pu(),xv=G(),Pv=_u(),Mv=Su(),$v=Cr(),Dv=Au(),jv=wu(),Fv=vt(),Bv=Lr(),Vv=Jn(),Uv=Zn(),kv=Or(),Gv=Ir(),Wv=ei(),Xv=Mu(),Hv=St(),Kv=W(),Yv=yt(),zv=nc(),Qv=sc(),Jv=oc(),Zv=lc(),e_=fc(),t_=Pr(),r_=_c(),n_=Sc(),i_=Tc(),s_=Rc(),a_=qc();Pc.exports={parse:Av,valid:Rv,clean:wv,inc:Cv,diff:Lv,major:Ov,minor:Iv,patch:qv,prerelease:Nv,compare:xv,rcompare:Pv,compareLoose:Mv,compareBuild:$v,sort:Dv,rsort:jv,gt:Fv,lt:Bv,eq:Vv,neq:Uv,gte:kv,lte:Gv,cmp:Wv,coerce:Xv,Comparator:Hv,Range:Kv,satisfies:Yv,toComparators:zv,maxSatisfying:Qv,minSatisfying:Jv,minVersion:Zv,validRange:e_,outside:t_,gtr:r_,ltr:n_,intersects:i_,simplifyRange:s_,subset:a_,SemVer:Tv,re:pi.re,src:pi.src,tokens:pi.t,SEMVER_SPEC_VERSION:Nc.SEMVER_SPEC_VERSION,RELEASE_TYPES:Nc.RELEASE_TYPES,compareIdentifiers:xc.compareIdentifiers,rcompareIdentifiers:xc.rcompareIdentifiers}});var mi=d((eb,gi)=>{"use strict";var o_=Mc(),u_=ht(),Ke=Ee(),$c=M(),Dc=C(),jc="2.7.15",c_=function(){return!1},l_=function(e){if(!o_.gte(e.VERSION,jc))throw new Error("AWS SDK version "+jc+" or greater required.");for(var r in e)if(e[r].serviceIdentifier){var n=e[r];n.prototype.customizeRequests(Fc)}return e},d_=function(e){return e.customizeRequests(Fc),e};function Fc(t){var e=Ke.resolveSegment(Ke.resolveManualSegmentParams(t.params));if(!e){var r=this.serviceIdentifier+"."+t.operation;return Ke.isAutomaticMode()?Dc.getLogger().info("Call "+r+" is missing the sub/segment context for automatic mode. Ignoring."):Dc.getLogger().info("Call "+r+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),t}var n=this.throttledError||c_,i=new Error().stack;let s;e.notTraced?s=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):s=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){let f="Root="+a+";Parent="+s.id+";Sampled="+(s.notTraced?"0":"1");if(o!=null)for(let[p,h]of Object.entries(o))f+=";"+p+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=f},c=function(l){s.addAttribute("namespace","aws"),s.addAttribute("aws",new u_(l,s.name));var f=l.httpResponse;if(f&&(s.addAttribute("http",new Bc(f)),(f.statusCode===429||l.error&&n(l.error))&&s.addThrottleFlag()),l.error){var p={message:l.error.message,name:l.error.code,stack:i};f&&f.statusCode?($c.getCauseTypeFromHttpStatus(f.statusCode)=="error"&&s.addErrorFlag(),s.close(p,!0)):s.close(p)}else{if(f&&f.statusCode){var h=$c.getCauseTypeFromHttpStatus(f.statusCode);h&&(s[h]=!0)}s.close()}};t.on("beforePresign",function(l){e.removeSubsegment(s),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),t.on("build",u).on("complete",c),t.__send||(t.__send=t.send,t.send=function(l){if(Ke.isAutomaticMode()){var f=Ke.getNamespace();f.run(function(){Ke.setSegment(s),t.__send(l)})}else t.__send(l)})}function Bc(t){this.init(t)}Bc.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};gi.exports.captureAWSClient=d_;gi.exports.captureAWS=l_});var Xc=d(Ye=>{"use strict";var Gc=Ye&&Ye.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.captureAWSClient=void 0;var f_=require("@aws-sdk/service-error-classification"),h_=Gc(ht()),p_=require("querystring"),g_=Gc(ct()),vi=Ee(),Vc=C(),{safeParseInt:Mr}=M(),m_=M(),Wc="XRaySDKInstrumentation",Uc=async(t,e,r,n,i)=>{var s,a,o;let{extendedRequestId:u,requestId:c,httpStatusCode:l,attempts:f}=((s=n?.output)===null||s===void 0?void 0:s.$metadata)||i?.$metadata,p=new h_.default({extendedRequestId:u,requestId:c,retryCount:f,request:{operation:e,httpRequest:{region:r,statusCode:l}}},t),h={};return l&&(h.response={},h.response.status=l),!((a=n?.response)===null||a===void 0)&&a.headers&&((o=n?.response)===null||o===void 0?void 0:o.headers["content-length"])!==void 0&&(h.response||(h.response={}),h.response.content_length=Mr(n.response.headers["content-length"])),[p,h]};function kc(t,e,r){var n,i,s;(r&&(0,f_.isThrottlingError)(r)||Mr((n=t.response)===null||n===void 0?void 0:n.status)===429||Mr((i=r?.$metadata)===null||i===void 0?void 0:i.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,m_.getCauseTypeFromHttpStatus)(Mr((s=t.response)===null||s===void 0?void 0:s.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var v_=(t,e)=>(r,n)=>async i=>{let s=vi.isAutomaticMode()?vi.resolveSegment():e,{clientName:a,commandName:o}=n,u=o.slice(0,-7),c=a.slice(0,-6);if(!s){let h=c+"."+u.charAt(0).toLowerCase()+u.slice(1);return vi.isAutomaticMode()?Vc.getLogger().info("Call "+h+" is missing the sub/segment context for automatic mode. Ignoring."):Vc.getLogger().info("Call "+h+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),r(i)}let l;s.notTraced?l=s.addNewSubsegmentWithoutSampling(c):l=s.addNewSubsegment(c),l.addAttribute("namespace","aws");let f=s instanceof g_.default?s.segment:s;i.request.headers["X-Amzn-Trace-Id"]=(0,p_.stringify)({Root:f.trace_id,Parent:l.id,Sampled:l.notTraced?"0":"1"},";");let p;try{if(p=await r(i),!p)throw new Error("Failed to get response from instrumented AWS Client.");let[h,x]=await Uc(c,u,await t.region(),p,null);return l.addAttribute("aws",h),l.addAttribute("http",x),kc(x,l),l.close(),p}catch(h){if(h.$metadata){let[O,Ct]=await Uc(c,u,await t.region(),null,h);l.addAttribute("aws",O),l.addAttribute("http",Ct),kc(Ct,l,h)}let x={message:h.message,name:h.name,stack:h.stack||new Error().stack};throw l.close(x,!0),h}},__={name:Wc,step:"build"},E_=(t,e)=>({applyToStack:r=>{r.add(v_(t,e),__)}});function S_(t,e){return t.middlewareStack.remove(Wc),t.middlewareStack.use(E_(t.config,e)),t}Ye.captureAWSClient=S_});var Ei=d((rb,_i)=>{"use strict";var Hc=require("url"),ze=Ee(),$r=M(),Kc=C(),b_=require("events"),y_=function(e,r,n){e.__request||Yc(e,r,n)},T_=function(e,r,n){if(e.__request)return e;var i={};return Object.keys(e).forEach(function(s){i[s]=e[s]}),Yc(i,r,n),i};function Yc(t,e,r){function n(a,...o){let u,c,l,f,p=o[0];if(typeof o[1]=="object"?(l=!0,f=typeof p=="string"?new Hc.URL(p):p,u=o[1],c=o[2]):(l=!1,u=p,c=o[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return a(...o);typeof u=="string"&&(u=new Hc.URL(u)),l||(f=u);let h=ze.resolveSegment(ze.resolveManualSegmentParams(u)),x=u.hostname||u.host||f.hostname||f.host||"Unknown host";if(!h){let I="[ host: "+x;return I=u.method?I+", method: "+u.method:I,I+=", path: "+(f.pathname||$r.stripQueryStringFromPath(u.path))+" ]",ze.isAutomaticMode()?Kc.getLogger().info("Options for request "+I+" is missing the sub/segment context for automatic mode. Ignoring."):Kc.getLogger().info("Options for request "+I+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let O;h.notTraced?O=h.addNewSubsegmentWithoutSampling(x):O=h.addNewSubsegment(x);let Ct=h.segment?h.segment:h;O.namespace="remote",u.headers||(u.headers={}),u.headers["X-Amzn-Trace-Id"]="Root="+Ct.trace_id+";Parent="+O.id+";Sampled="+(O.notTraced?"0":"1");let Tl=function(ce){if(r&&r(O,this,null,ce),O.http&&O.http.response)$r.getCauseTypeFromHttpStatus(O.http.response.status)==="error"&&O.addErrorFlag(),O.close(ce,!0);else{let Rl=ce.code!=="ECONNREFUSED";O.addRemoteRequestData(this,null,Rl&&e),O.close(ce)}},Al=$r.objectWithoutProperties(u,["Segment"],!0),Ci=a(...l?[p,Al]:[u],function(I){I.on("end",function(){r&&r(O,this.req,I),I.statusCode===429&&O.addThrottleFlag();let ce=$r.getCauseTypeFromHttpStatus(I.statusCode);ce&&(O[ce]=!0),O.addRemoteRequestData(I.req,I,!!e),O.close()}),typeof c=="function"?ze.isAutomaticMode()?ze.getNamespace().run(function(){ze.setSegment(O),c(I)}):c(I):I.req&&I.req.listenerCount("response")===0&&I.resume()});return Ci.on(b_.errorMonitor||"error",Tl),Ci}t.__request=t.request;function i(...a){return n(t.__request,...a)}t.__get=t.get;function s(...a){return n(t.__get,...a)}Object.defineProperties(t,{request:{value:i,configurable:!0,enumerable:!0,writable:!0},get:{value:s,configurable:!0,enumerable:!0,writable:!0}})}_i.exports.captureHTTPsGlobal=y_;_i.exports.captureHTTPs=T_});var Zc=d((nb,Si)=>{"use strict";var At=Ee(),Dr=Symbol("original then"),jr=Symbol("original catch");function Qc(t){let e=t.prototype.then;e[Dr]||(t.prototype.then=function(n,i){if(At.isAutomaticMode()&&zc()){let s=At.getNamespace();n=n&&s.bind(n),i=i&&s.bind(i)}return e.call(this,n,i)},t.prototype.then[Dr]=e);let r=t.prototype.catch;r&&!r[jr]&&(t.prototype.catch=function(n){if(At.isAutomaticMode()&&zc()){let i=At.getNamespace();n=n&&i.bind(n)}return r.call(this,n)},t.prototype.catch[jr]=r)}function A_(t){let e=t.prototype.then;e[Dr]&&(t.prototype.then=e[Dr]);let r=t.prototype.catch;r&&r[jr]&&(t.prototype.catch=r[jr])}function zc(){try{return At.getSegment()}catch{return}}function Jc(){Qc(Promise)}function R_(){A_(Promise)}Jc.patchThirdPartyPromise=Qc;Si.exports.capturePromise=Jc;Si.exports.uncapturePromise=R_});var rl=d((ib,tl)=>{"use strict";function el(t,e,r,n,i){this.init(t,e,r,n,i)}el.prototype.init=function(e,r,n,i,s){e&&(this.database_version=e),r&&(this.driver_version=r),s&&(this.preparation=s),this.url=i,this.user=n};tl.exports=el});var sl=d((sb,il)=>{"use strict";var Se=Ee(),bi=C(),Qe=ge(),w_=M(),C_=po(),wt={};try{wt=go()}catch(t){bi.getLogger().debug("Failed to load SDK data:",t)}var Rt="unknown",nl={plugins:{EC2Plugin:To(),ECSPlugin:Ro(),ElasticBeanstalkPlugin:Co()},config:function(t){var e={};t.forEach(function(r){r.getData(function(n){if(n)for(var i in n)e[i]=n[i]}),Qe.setOrigin(r.originName),Qe.setPluginData(e)})},setAWSWhitelist:ht().setAWSWhitelist,appendAWSWhitelist:ht().appendAWSWhitelist,setStreamingThreshold:Qe.setStreamingThreshold,setLogger:bi.setLogger,getLogger:bi.getLogger,setDaemonAddress:or().setDaemonAddress,captureFunc:Tr().captureFunc,captureAsyncFunc:Tr().captureAsyncFunc,captureCallbackFunc:Tr().captureCallbackFunc,captureAWS:mi().captureAWS,captureAWSClient:mi().captureAWSClient,captureAWSv3Client:Xc().captureAWSClient,captureHTTPs:Ei().captureHTTPs,captureHTTPsGlobal:Ei().captureHTTPsGlobal,capturePromise:Zc().capturePromise,utils:w_,database:{SqlData:rl()},middleware:Fn(),getNamespace:Se.getNamespace,resolveSegment:Se.resolveSegment,getSegment:Se.getSegment,setSegment:Se.setSegment,isAutomaticMode:Se.isAutomaticMode,enableAutomaticMode:Se.enableAutomaticMode,enableManualMode:Se.enableManualMode,setContextMissingStrategy:Se.setContextMissingStrategy,Segment:lt(),Subsegment:ct(),SegmentUtils:Qe};nl.middleware.IncomingRequestData=Ln(),function(){var t={runtime:process.release&&process.release.name?process.release.name:Rt,runtime_version:process.version,version:process.env.npm_package_version||Rt,name:process.env.npm_package_name||Rt},e={sdk:"X-Ray for Node.js",sdk_version:wt.version?wt.version:Rt,package:wt.name?wt.name:Rt};Qe.setSDKData(e),Qe.setServiceData(t),process.env.LAMBDA_TASK_ROOT&&C_.init()}();il.exports=nl});var yi=d((ab,al)=>{"use strict";al.exports=sl()});var ol=d(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.ProviderService=void 0;var V=yi(),L_=Me(),Ti=class{captureAWS(e){return(0,V.captureAWS)(e)}captureAWSClient(e){return(0,V.captureAWSClient)(e)}captureAWSv3Client(e){return(0,L_.addUserAgentMiddleware)(e,"tracer"),(0,V.captureAWSv3Client)(e)}captureAsyncFunc(e,r,n){return(0,V.captureAsyncFunc)(e,r)}captureFunc(e,r,n){return(0,V.captureFunc)(e,r)}captureHTTPsGlobal(){(0,V.captureHTTPsGlobal)(require("http")),(0,V.captureHTTPsGlobal)(require("https"))}getNamespace(){return(0,V.getNamespace)()}getSegment(){return(0,V.getSegment)()}putAnnotation(e,r){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(n instanceof V.Segment){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}n.addAnnotation(e,r)}putMetadata(e,r,n){let i=this.getSegment();if(i===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(i instanceof V.Segment){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}i.addMetadata(e,r,n)}setContextMissingStrategy(e){(0,V.setContextMissingStrategy)(e)}setDaemonAddress(e){(0,V.setDaemonAddress)(e)}setLogger(e){(0,V.setLogger)(e)}setSegment(e){(0,V.setSegment)(e)}};Fr.ProviderService=Ti});var cl=d(ul=>{"use strict";Object.defineProperty(ul,"__esModule",{value:!0})});var dl=d(be=>{"use strict";var O_=be&&be.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),ll=be&&be.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&O_(e,t,r)};Object.defineProperty(be,"__esModule",{value:!0});ll(ol(),be);ll(cl(),be)});var fl=d(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.Tracer=void 0;var I_=Me(),q_=Gs(),N_=dl(),x_=yi(),Ai=class extends I_.Utility{constructor(e={}){super(),this.captureError=!0,this.captureHTTPsRequests=!0,this.captureResponse=!0,this.tracingEnabled=!0,this.setOptions(e),this.provider=new N_.ProviderService,this.isTracingEnabled()&&this.captureHTTPsRequests&&this.provider.captureHTTPsGlobal(),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(e,r){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(e,r||!1)}}addResponseAsMetadata(e,r){e===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${r} response`,e)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(e){return this.isTracingEnabled()?this.provider.captureAWS(e):e}captureAWSClient(e){if(!this.isTracingEnabled())return e;try{return this.provider.captureAWSClient(e)}catch(r){try{return this.provider.captureAWSClient(e.service),e}catch{throw r}}}captureAWSv3Client(e){return this.isTracingEnabled()?this.provider.captureAWSv3Client(e):e}captureLambdaHandler(e){return(r,n,i)=>{let s=i.value,a=this;return i.value=function(o,u,c){let l=this;return a.isTracingEnabled()?a.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async f=>{a.annotateColdStart(),a.addServiceNameAnnotation();let p;try{p=await s.apply(l,[o,u,c]),(e?.captureResponse??!0)&&a.addResponseAsMetadata(p,process.env._HANDLER)}catch(h){throw a.addErrorAsMetadata(h),h}finally{f?.close(),f?.flush()}return p}):s.apply(l,[o,u,c])},i}}captureMethod(e){return(r,n,i)=>{let s=i.value,a=this;return i.value=function(...o){if(!a.isTracingEnabled())return s.apply(this,[...o]);let u=String(n),c=e?.subSegmentName?e.subSegmentName:`### ${u}`;return a.provider.captureAsyncFunc(c,async l=>{let f;try{f=await s.apply(this,[...o]),(e?.captureResponse??!0)&&a.addResponseAsMetadata(f,u)}catch(p){throw a.addErrorAsMetadata(p),p}finally{l?.close(),l?.flush()}return f})},i}}getRootXrayTraceId(){return this.envVarsService.getXrayTraceId()}getSegment(){if(!this.isTracingEnabled())return new x_.Subsegment("## Dummy segment");let e=this.provider.getSegment();return e===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),e}isTraceSampled(){return this.isTracingEnabled()?this.envVarsService.getXrayTraceSampled():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(e,r){this.isTracingEnabled()&&this.provider.putAnnotation(e,r)}putMetadata(e,r,n){this.isTracingEnabled()&&this.provider.putMetadata(e,r,n||this.serviceName)}setSegment(e){if(this.isTracingEnabled())return this.provider.setSegment(e)}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}isAmplifyCli(){return this.getEnvVarsService().getAwsExecutionEnv()==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return this.getEnvVarsService().getAwsExecutionEnv()!==""}isLambdaSamCli(){return this.getEnvVarsService().getSamLocal()!==""}setCaptureError(){let e=this.getCustomConfigService()?.getTracingCaptureError();if(e!==void 0&&e.toLowerCase()==="false"){this.captureError=!1;return}if(this.getEnvVarsService().getTracingCaptureError().toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(e){if(e!==void 0&&!e){this.captureHTTPsRequests=!1;return}let r=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(r!==void 0&&r.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}if(this.getEnvVarsService().getCaptureHTTPsRequests().toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}}setCaptureResponse(){let e=this.getCustomConfigService()?.getTracingCaptureResponse();if(e!==void 0&&e.toLowerCase()==="false"){this.captureResponse=!1;return}if(this.getEnvVarsService().getTracingCaptureResponse().toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new q_.EnvironmentVariablesService}setOptions(e){let{enabled:r,serviceName:n,captureHTTPsRequests:i,customConfigService:s}=e;return this.setEnvVarsService(),this.setCustomConfigService(s),this.setTracingEnabled(r),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(e){if(e!==void 0&&this.isValidServiceName(e)){this.serviceName=e;return}let r=this.getCustomConfigService()?.getServiceName();if(r!==void 0&&this.isValidServiceName(r)){this.serviceName=r;return}let n=this.getEnvVarsService().getServiceName();if(n!==void 0&&this.isValidServiceName(n)){this.serviceName=n;return}this.serviceName=this.getDefaultServiceName()}setTracingEnabled(e){if(e!==void 0&&!e){this.tracingEnabled=e;return}let r=this.getCustomConfigService()?.getTracingEnabled();if(r!==void 0&&r.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(this.getEnvVarsService().getTracingEnabled().toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};Br.Tracer=Ai});var pl=d(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0})});var gl=d(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.captureLambdaHandler=void 0;var P_=mn(),M_=(t,e)=>{let r,n,i=l=>{l.internal={...l.internal,[P_.TRACER_KEY]:a}},s=()=>{let l=t.getSegment();l!==void 0&&(r=l,n=r.addNewSubsegment(`## ${process.env._HANDLER}`),t.setSegment(n))},a=()=>{n===void 0||r===null||(n.close(),t.setSegment(r))};return{before:async l=>{t.isTracingEnabled()&&(s(),i(l),t.annotateColdStart(),t.addServiceNameAnnotation())},after:async l=>{t.isTracingEnabled()&&((e?.captureResponse??!0)&&t.addResponseAsMetadata(l.response,process.env._HANDLER),a())},onError:async l=>{t.isTracingEnabled()&&(t.addErrorAsMetadata(l.error),a())}}};Vr.captureLambdaHandler=M_});var vn=d(Z=>{"use strict";var $_=Z&&Z.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ur=Z&&Z.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&$_(e,t,r)};Object.defineProperty(Z,"__esModule",{value:!0});Ur(Fs(),Z);Ur(fl(),Z);Ur(pl(),Z);Ur(gl(),Z)});var B_={};ql(B_,{handler:()=>F_});module.exports=Nl(B_);var ye=require("@aws-sdk/client-iot"),Je=require("@aws-sdk/client-secrets-manager");var ml=kr(Gr()),vl=kr(Wr()),_l=kr(vn()),El="asset-tracker",Sl=new vl.Logger({serviceName:El,logLevel:"DEBUG",persistentLogAttributes:{logger:{version:ml.PT_VERSION,name:"@aws-lambda-powertools/logger"}}}),Ri=new _l.Tracer({serviceName:El});var bl="assettracker/iot-cert",D_=async t=>{let{certificateId:e,certificatePem:r,keyPair:n}=await wi.send(new ye.CreateKeysAndCertificateCommand({setAsActive:!0}));if(!e||!r||!n)throw new Error("Failed to create keys and certificate");return await yl.send(new Je.CreateSecretCommand({Name:bl,SecretString:JSON.stringify({cert:r,keyPair:n.PrivateKey})})),{PhysicalResourceId:e,Data:{certificateId:e}}},j_=async t=>{await yl.send(new Je.DeleteSecretCommand({SecretId:bl,ForceDeleteWithoutRecovery:!0}));let e=t.PhysicalResourceId;await wi.send(new ye.UpdateCertificateCommand({certificateId:e,newStatus:"INACTIVE"})),await new Promise(r=>setTimeout(r,2e3)),await wi.send(new ye.DeleteCertificateCommand({certificateId:e}))},wi=Ri.captureAWSv3Client(new ye.IoTClient({})),yl=Ri.captureAWSv3Client(new Je.SecretsManagerClient({})),F_=async t=>{if(Sl.debug("Received event",{event:t}),t.RequestType==="Create")return await D_(t);if(t.RequestType==="Update")return;if(t.RequestType==="Delete")return await j_(t);throw new Error("Unknown request type")};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
