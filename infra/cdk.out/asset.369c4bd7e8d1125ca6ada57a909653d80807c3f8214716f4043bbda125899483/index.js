"use strict";var yl=Object.create;var wt=Object.defineProperty;var Tl=Object.getOwnPropertyDescriptor;var Al=Object.getOwnPropertyNames;var Rl=Object.getPrototypeOf,wl=Object.prototype.hasOwnProperty;var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Cl=(t,e)=>{for(var r in e)wt(t,r,{get:e[r],enumerable:!0})},wi=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Al(e))!wl.call(t,i)&&i!==r&&wt(t,i,{get:()=>e[i],enumerable:!(n=Tl(e,i))||n.enumerable});return t};var Ur=(t,e,r)=>(r=t!=null?yl(Rl(t)):{},wi(e||!t||!t.__esModule?wt(r,"default",{value:t,enumerable:!0}):r,t)),Ll=t=>wi(wt({},"__esModule",{value:!0}),t);var kr=d(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.PT_VERSION=void 0;Ct.PT_VERSION="1.11.1"});var Ci=d(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.createLogger=void 0;var Ol=Gr(),Il=(t={})=>new Ol.Logger(t);Lt.createLogger=Il});var Oi=d(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0})});var Ii=d(ye=>{"use strict";var ql=ye&&ye.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Nl=ye&&ye.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ql(e,t,r)};Object.defineProperty(ye,"__esModule",{value:!0});Nl(Oi(),ye)});var qi=d(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.Utility=void 0;var Wr=class{constructor(){this.coldStart=!0,this.defaultServiceName="service_undefined"}getColdStart(){return this.coldStart?(this.coldStart=!1,!0):!1}isColdStart(){return this.getColdStart()}getDefaultServiceName(){return this.defaultServiceName}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};Ot.Utility=Wr});var Ni=d(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.ConfigService=void 0;var Xr=class{};It.ConfigService=Xr});var xi=d(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.EnvironmentVariablesService=void 0;var xl=Kr(),Hr=class extends xl.ConfigService{constructor(){super(...arguments),this.serviceNameVariable="POWERTOOLS_SERVICE_NAME",this.xRayTraceIdVariable="_X_AMZN_TRACE_ID"}get(e){return process.env[e]?.trim()||""}getServiceName(){return this.get(this.serviceNameVariable)}getXrayTraceId(){return this.getXrayTraceData()?.Root}getXrayTraceSampled(){return this.getXrayTraceData()?.Sampled==="1"}isValueTrue(e){return["1","y","yes","t","true","on"].includes(e.toLowerCase())}getXrayTraceData(){let e=this.get(this.xRayTraceIdVariable);if(e==="")return;if(!e.includes("="))return{Root:e};let r={};return e.split(";").forEach(n=>{let[i,s]=n.split("=");r[i]=s}),r}};qt.EnvironmentVariablesService=Hr});var Kr=d(le=>{"use strict";var Pl=le&&le.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Pi=le&&le.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Pl(e,t,r)};Object.defineProperty(le,"__esModule",{value:!0});Pi(Ni(),le);Pi(xi(),le)});var Mi=d(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.helloworldContext=void 0;var Ml={callbackWaitsForEmptyEventLoop:!0,functionVersion:"$LATEST",functionName:"foo-bar-function",memoryLimitInMB:"128",logGroupName:"/aws/lambda/foo-bar-function-123456abcdef",logStreamName:"2021/03/09/[$LATEST]abcdef123456abcdef123456abcdef123456",invokedFunctionArn:"arn:aws:lambda:eu-west-1:123456789012:function:foo-bar-function",awsRequestId:"c6af9ac6-7b61-11e6-9a41-93e812345678",getRemainingTimeInMillis:()=>1234,done:()=>console.log("Done!"),fail:()=>console.log("Failed!"),succeed:()=>console.log("Succeeded!")};Nt.helloworldContext=Ml});var $i=d(Te=>{"use strict";var $l=Te&&Te.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Dl=Te&&Te.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&$l(e,t,r)};Object.defineProperty(Te,"__esModule",{value:!0});Dl(Mi(),Te)});var Di=d(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.CustomEvent=void 0;xt.CustomEvent={key1:"value1",key2:"value2",key3:"value3"}});var ji=d(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.Custom=void 0;Pt.Custom=Di()});var Bi=d(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0})});var Ui=d(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.isNullOrUndefined=Y.isTruthy=Y.isString=Y.isRecord=void 0;var Vi=t=>Object.prototype.toString.call(t)==="[object Object]"&&!Object.is(t,null);Y.isRecord=Vi;var jl=t=>typeof t=="string"?t!=="":typeof t=="number"?t!==0:typeof t=="boolean"?t:Array.isArray(t)?t.length>0:Vi(t)?Object.keys(t).length>0:!1;Y.isTruthy=jl;var Fl=t=>Object.is(t,null)||Object.is(t,void 0);Y.isNullOrUndefined=Fl;var Bl=t=>typeof t=="string";Y.isString=Bl});var ki=d(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.addUserAgentMiddleware=void 0;var Vl=kr(),Ul=process.env.AWS_EXECUTION_ENV||"NA",kl={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},Gl=t=>(e,r)=>async n=>{let i=`PT/${t}/${Vl.PT_VERSION} PTEnv/${Ul}`;return n.request.headers["user-agent"]=`${n.request.headers["user-agent"]} ${i}`,await e(n)},Wl=(t,e)=>{try{if(t.middlewareStack.identify().includes("addPowertoolsToUserAgent: POWERTOOLS,USER_AGENT"))return;t.middlewareStack.addRelativeTo(Gl(e),kl)}catch(r){console.warn("Failed to add user agent middleware",r)}};Mt.addUserAgentMiddleware=Wl});var Pe=d(P=>{"use strict";var Xl=P&&P.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),xe=P&&P.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xl(e,t,r)};Object.defineProperty(P,"__esModule",{value:!0});P.Events=P.ContextExamples=void 0;xe(Ii(),P);xe(qi(),P);xe(Kr(),P);P.ContextExamples=$i();P.Events=ji();xe(Bi(),P);xe(Ui(),P);xe(ki(),P)});var Gi=d($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.LogFormatter=void 0;var Yr=class{formatError(e){return{name:e.name,location:this.getCodeLocation(e.stack),message:e.message,stack:e.stack}}formatTimestamp(e){return e.toISOString()}getCodeLocation(e){if(!e)return"";let r=e.split(`
`),n=/\((.*):(\d+):(\d+)\)\\?$/,i;for(i=0;i<r.length;i++){let s=n.exec(r[i]);if(Array.isArray(s))return`${s[1]}:${Number(s[2])}`}return""}};$t.LogFormatter=Yr});var Xi=d(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0})});var Hi=d(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.PowertoolLogFormatter=void 0;var Hl=jt(),zr=class extends Hl.LogFormatter{formatAttributes(e){return{cold_start:e.lambdaContext?.coldStart,function_arn:e.lambdaContext?.invokedFunctionArn,function_memory_size:e.lambdaContext?.memoryLimitInMB,function_name:e.lambdaContext?.functionName,function_request_id:e.lambdaContext?.awsRequestId,level:e.logLevel,message:e.message,sampling_rate:e.sampleRateValue,service:e.serviceName,timestamp:this.formatTimestamp(e.timestamp),xray_trace_id:e.xRayTraceId}}};Dt.PowertoolLogFormatter=zr});var jt=d(ee=>{"use strict";var Kl=ee&&ee.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Qr=ee&&ee.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Kl(e,t,r)};Object.defineProperty(ee,"__esModule",{value:!0});Qr(Gi(),ee);Qr(Xi(),ee);Qr(Hi(),ee)});var cn=d((Qe,Me)=>{var Yl=200,ns="__lodash_hash_undefined__",zl=800,Ql=16,is=9007199254740991,ss="[object Arguments]",Jl="[object Array]",Zl="[object AsyncFunction]",ed="[object Boolean]",td="[object Date]",rd="[object Error]",as="[object Function]",nd="[object GeneratorFunction]",id="[object Map]",sd="[object Number]",ad="[object Null]",os="[object Object]",od="[object Proxy]",ud="[object RegExp]",cd="[object Set]",ld="[object String]",dd="[object Undefined]",fd="[object WeakMap]",hd="[object ArrayBuffer]",pd="[object DataView]",gd="[object Float32Array]",md="[object Float64Array]",vd="[object Int8Array]",_d="[object Int16Array]",Ed="[object Int32Array]",Sd="[object Uint8Array]",bd="[object Uint8ClampedArray]",yd="[object Uint16Array]",Td="[object Uint32Array]",Ad=/[\\^$.*+?()[\]{}|]/g,Rd=/^\[object .+?Constructor\]$/,wd=/^(?:0|[1-9]\d*)$/,T={};T[gd]=T[md]=T[vd]=T[_d]=T[Ed]=T[Sd]=T[bd]=T[yd]=T[Td]=!0;T[ss]=T[Jl]=T[hd]=T[ed]=T[pd]=T[td]=T[rd]=T[as]=T[id]=T[sd]=T[os]=T[ud]=T[cd]=T[ld]=T[fd]=!1;var us=typeof global=="object"&&global&&global.Object===Object&&global,Cd=typeof self=="object"&&self&&self.Object===Object&&self,et=us||Cd||Function("return this")(),cs=typeof Qe=="object"&&Qe&&!Qe.nodeType&&Qe,Je=cs&&typeof Me=="object"&&Me&&!Me.nodeType&&Me,ls=Je&&Je.exports===cs,Jr=ls&&us.process,Ki=function(){try{var t=Je&&Je.require&&Je.require("util").types;return t||Jr&&Jr.binding&&Jr.binding("util")}catch{}}(),Yi=Ki&&Ki.isTypedArray;function Ld(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function Od(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function Id(t){return function(e){return t(e)}}function qd(t,e){return t?.[e]}function Nd(t,e){return function(r){return t(e(r))}}var xd=Array.prototype,Pd=Function.prototype,Vt=Object.prototype,Zr=et["__core-js_shared__"],Ut=Pd.toString,te=Vt.hasOwnProperty,zi=function(){var t=/[^.]+$/.exec(Zr&&Zr.keys&&Zr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ds=Vt.toString,Md=Ut.call(Object),$d=RegExp("^"+Ut.call(te).replace(Ad,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ft=ls?et.Buffer:void 0,Qi=et.Symbol,Ji=et.Uint8Array,Zi=Ft?Ft.allocUnsafe:void 0,fs=Nd(Object.getPrototypeOf,Object),es=Object.create,Dd=Vt.propertyIsEnumerable,jd=xd.splice,Ae=Qi?Qi.toStringTag:void 0,Bt=function(){try{var t=an(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Fd=Ft?Ft.isBuffer:void 0,ts=Math.max,Bd=Date.now,hs=an(et,"Map"),Ze=an(Object,"create"),Vd=function(){function t(){}return function(e){if(!we(e))return{};if(es)return es(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function Re(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ud(){this.__data__=Ze?Ze(null):{},this.size=0}function kd(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Gd(t){var e=this.__data__;if(Ze){var r=e[t];return r===ns?void 0:r}return te.call(e,t)?e[t]:void 0}function Wd(t){var e=this.__data__;return Ze?e[t]!==void 0:te.call(e,t)}function Xd(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ze&&e===void 0?ns:e,this}Re.prototype.clear=Ud;Re.prototype.delete=kd;Re.prototype.get=Gd;Re.prototype.has=Wd;Re.prototype.set=Xd;function re(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Hd(){this.__data__=[],this.size=0}function Kd(t){var e=this.__data__,r=kt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():jd.call(e,r,1),--this.size,!0}function Yd(t){var e=this.__data__,r=kt(e,t);return r<0?void 0:e[r][1]}function zd(t){return kt(this.__data__,t)>-1}function Qd(t,e){var r=this.__data__,n=kt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}re.prototype.clear=Hd;re.prototype.delete=Kd;re.prototype.get=Yd;re.prototype.has=zd;re.prototype.set=Qd;function $e(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Jd(){this.size=0,this.__data__={hash:new Re,map:new(hs||re),string:new Re}}function Zd(t){var e=Wt(this,t).delete(t);return this.size-=e?1:0,e}function ef(t){return Wt(this,t).get(t)}function tf(t){return Wt(this,t).has(t)}function rf(t,e){var r=Wt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}$e.prototype.clear=Jd;$e.prototype.delete=Zd;$e.prototype.get=ef;$e.prototype.has=tf;$e.prototype.set=rf;function De(t){var e=this.__data__=new re(t);this.size=e.size}function nf(){this.__data__=new re,this.size=0}function sf(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function af(t){return this.__data__.get(t)}function of(t){return this.__data__.has(t)}function uf(t,e){var r=this.__data__;if(r instanceof re){var n=r.__data__;if(!hs||n.length<Yl-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new $e(n)}return r.set(t,e),this.size=r.size,this}De.prototype.clear=nf;De.prototype.delete=sf;De.prototype.get=af;De.prototype.has=of;De.prototype.set=uf;function cf(t,e){var r=nn(t),n=!r&&rn(t),i=!r&&!n&&vs(t),s=!r&&!n&&!i&&Es(t),a=r||n||i||s,o=a?Od(t.length,String):[],u=o.length;for(var c in t)(e||te.call(t,c))&&!(a&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||gs(c,u)))&&o.push(c);return o}function en(t,e,r){(r!==void 0&&!Xt(t[e],r)||r===void 0&&!(e in t))&&sn(t,e,r)}function lf(t,e,r){var n=t[e];(!(te.call(t,e)&&Xt(n,r))||r===void 0&&!(e in t))&&sn(t,e,r)}function kt(t,e){for(var r=t.length;r--;)if(Xt(t[r][0],e))return r;return-1}function sn(t,e,r){e=="__proto__"&&Bt?Bt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var df=Af();function Gt(t){return t==null?t===void 0?dd:ad:Ae&&Ae in Object(t)?Rf(t):qf(t)}function rs(t){return tt(t)&&Gt(t)==ss}function ff(t){if(!we(t)||Of(t))return!1;var e=un(t)?$d:Rd;return e.test(Mf(t))}function hf(t){return tt(t)&&_s(t.length)&&!!T[Gt(t)]}function pf(t){if(!we(t))return If(t);var e=ms(t),r=[];for(var n in t)n=="constructor"&&(e||!te.call(t,n))||r.push(n);return r}function ps(t,e,r,n,i){t!==e&&df(e,function(s,a){if(i||(i=new De),we(s))gf(t,e,a,r,ps,n,i);else{var o=n?n(tn(t,a),s,a+"",t,e,i):void 0;o===void 0&&(o=s),en(t,a,o)}},Ss)}function gf(t,e,r,n,i,s,a){var o=tn(t,r),u=tn(e,r),c=a.get(u);if(c){en(t,r,c);return}var l=s?s(o,u,r+"",t,e,a):void 0,f=l===void 0;if(f){var p=nn(u),h=!p&&vs(u),x=!p&&!h&&Es(u);l=u,p||h||x?nn(o)?l=o:$f(o)?l=bf(o):h?(f=!1,l=_f(u,!0)):x?(f=!1,l=Sf(u,!0)):l=[]:Df(u)||rn(u)?(l=o,rn(o)?l=jf(o):(!we(o)||un(o))&&(l=wf(u))):f=!1}f&&(a.set(u,l),i(l,u,n,s,a),a.delete(u)),en(t,r,l)}function mf(t,e){return xf(Nf(t,e,bs),t+"")}var vf=Bt?function(t,e){return Bt(t,"toString",{configurable:!0,enumerable:!1,value:Bf(e),writable:!0})}:bs;function _f(t,e){if(e)return t.slice();var r=t.length,n=Zi?Zi(r):new t.constructor(r);return t.copy(n),n}function Ef(t){var e=new t.constructor(t.byteLength);return new Ji(e).set(new Ji(t)),e}function Sf(t,e){var r=e?Ef(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function bf(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function yf(t,e,r,n){var i=!r;r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],u=n?n(r[o],t[o],o,r,t):void 0;u===void 0&&(u=t[o]),i?sn(r,o,u):lf(r,o,u)}return r}function Tf(t){return mf(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,a&&Cf(r[0],r[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var o=r[n];o&&t(e,o,n,s)}return e})}function Af(t){return function(e,r,n){for(var i=-1,s=Object(e),a=n(e),o=a.length;o--;){var u=a[t?o:++i];if(r(s[u],u,s)===!1)break}return e}}function Wt(t,e){var r=t.__data__;return Lf(e)?r[typeof e=="string"?"string":"hash"]:r.map}function an(t,e){var r=qd(t,e);return ff(r)?r:void 0}function Rf(t){var e=te.call(t,Ae),r=t[Ae];try{t[Ae]=void 0;var n=!0}catch{}var i=ds.call(t);return n&&(e?t[Ae]=r:delete t[Ae]),i}function wf(t){return typeof t.constructor=="function"&&!ms(t)?Vd(fs(t)):{}}function gs(t,e){var r=typeof t;return e=e??is,!!e&&(r=="number"||r!="symbol"&&wd.test(t))&&t>-1&&t%1==0&&t<e}function Cf(t,e,r){if(!we(r))return!1;var n=typeof e;return(n=="number"?on(r)&&gs(e,r.length):n=="string"&&e in r)?Xt(r[e],t):!1}function Lf(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Of(t){return!!zi&&zi in t}function ms(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Vt;return t===r}function If(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}function qf(t){return ds.call(t)}function Nf(t,e,r){return e=ts(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=ts(n.length-e,0),a=Array(s);++i<s;)a[i]=n[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=n[i];return o[e]=r(a),Ld(t,this,o)}}function tn(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var xf=Pf(vf);function Pf(t){var e=0,r=0;return function(){var n=Bd(),i=Ql-(n-r);if(r=n,i>0){if(++e>=zl)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Mf(t){if(t!=null){try{return Ut.call(t)}catch{}try{return t+""}catch{}}return""}function Xt(t,e){return t===e||t!==t&&e!==e}var rn=rs(function(){return arguments}())?rs:function(t){return tt(t)&&te.call(t,"callee")&&!Dd.call(t,"callee")},nn=Array.isArray;function on(t){return t!=null&&_s(t.length)&&!un(t)}function $f(t){return tt(t)&&on(t)}var vs=Fd||Vf;function un(t){if(!we(t))return!1;var e=Gt(t);return e==as||e==nd||e==Zl||e==od}function _s(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=is}function we(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function tt(t){return t!=null&&typeof t=="object"}function Df(t){if(!tt(t)||Gt(t)!=os)return!1;var e=fs(t);if(e===null)return!0;var r=te.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Ut.call(r)==Md}var Es=Yi?Id(Yi):hf;function jf(t){return yf(t,Ss(t))}function Ss(t){return on(t)?cf(t,!0):pf(t)}var Ff=Tf(function(t,e,r){ps(t,e,r)});function Bf(t){return function(){return t}}function bs(t){return t}function Vf(){return!1}Me.exports=Ff});var ys=d(je=>{"use strict";var Uf=je&&je.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(je,"__esModule",{value:!0});je.LogItem=void 0;var kf=Uf(cn()),ln=class{constructor(e){this.attributes={},this.addAttributes(e.baseAttributes),this.addAttributes(e.persistentAttributes)}addAttributes(e){return this.attributes=(0,kf.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.setAttributes(this.removeEmptyKeys(this.getAttributes()))}removeEmptyKeys(e){let r={};for(let n in e)e[n]!==void 0&&e[n]!==""&&e[n]!==null&&(r[n]=e[n]);return r}setAttributes(e){this.attributes=e}};je.LogItem=ln});var As=d(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0})});var ws=d(de=>{"use strict";var Gf=de&&de.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Rs=de&&de.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Gf(e,t,r)};Object.defineProperty(de,"__esModule",{value:!0});Rs(ys(),de);Rs(As(),de)});var Ls=d(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0})});var Os=d(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.EnvironmentVariablesService=void 0;var Wf=Pe(),dn=class extends Wf.EnvironmentVariablesService{constructor(){super(...arguments),this.awsRegionVariable="AWS_REGION",this.currentEnvironmentVariable="ENVIRONMENT",this.devModeVariable="POWERTOOLS_DEV",this.functionNameVariable="AWS_LAMBDA_FUNCTION_NAME",this.functionVersionVariable="AWS_LAMBDA_FUNCTION_VERSION",this.logEventVariable="POWERTOOLS_LOGGER_LOG_EVENT",this.logLevelVariable="LOG_LEVEL",this.memoryLimitInMBVariable="AWS_LAMBDA_FUNCTION_MEMORY_SIZE",this.sampleRateValueVariable="POWERTOOLS_LOGGER_SAMPLE_RATE"}getAwsRegion(){return this.get(this.awsRegionVariable)}getCurrentEnvironment(){return this.get(this.currentEnvironmentVariable)}getFunctionMemory(){let e=this.get(this.memoryLimitInMBVariable);return Number(e)}getFunctionName(){return this.get(this.functionNameVariable)}getFunctionVersion(){return this.get(this.functionVersionVariable)}getLogEvent(){let e=this.get(this.logEventVariable);return this.isValueTrue(e)}getLogLevel(){return this.get(this.logLevelVariable)}getSampleRateValue(){let e=this.get(this.sampleRateValueVariable);return e&&e.length>0?Number(e):void 0}isDevMode(){let e=this.get(this.devModeVariable);return this.isValueTrue(e)}};Ht.EnvironmentVariablesService=dn});var qs=d(fe=>{"use strict";var Xf=fe&&fe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Is=fe&&fe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xf(e,t,r)};Object.defineProperty(fe,"__esModule",{value:!0});Is(Ls(),fe);Is(Os(),fe)});var hn=d(Fe=>{"use strict";var Hf=Fe&&Fe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.Logger=void 0;var Kf=require("crypto"),Yf=require("console"),zf=Pe(),Qf=jt(),Jf=ws(),Kt=Hf(cn()),Zf=qs(),fn=class t extends zf.Utility{get level(){return this.logLevel}constructor(e={}){super(),this.logEvent=!1,this.logIndentation=0,this.logLevel=12,this.logLevelThresholds={DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},this.logsSampled=!1,this.persistentLogAttributes={},this.powertoolLogData={},this.setOptions(e)}addContext(e){let r={invokedFunctionArn:e.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:e.awsRequestId,memoryLimitInMB:Number(e.memoryLimitInMB),functionName:e.functionName,functionVersion:e.functionVersion};this.addToPowertoolLogData({lambdaContext:r})}addPersistentLogAttributes(e){(0,Kt.default)(this.persistentLogAttributes,e)}appendKeys(e){this.addPersistentLogAttributes(e)}createChild(e={}){let r={logLevel:this.getLevelName(),customConfigService:this.getCustomConfigService(),logFormatter:this.getLogFormatter()},n=this.getPowertoolLogData(),i=new t((0,Kt.default)(r,n,e)),s=this.getPersistentLogAttributes();return i.addPersistentLogAttributes(s),n.lambdaContext&&i.addContext(n.lambdaContext),i}critical(e,...r){this.processLogItem(24,e,r)}debug(e,...r){this.processLogItem(8,e,r)}error(e,...r){this.processLogItem(20,e,r)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getLogsSampled(){return this.logsSampled}getPersistentLogAttributes(){return this.persistentLogAttributes}info(e,...r){this.processLogItem(12,e,r)}injectLambdaContext(e){return(r,n,i)=>{let s=i.value,a=this;i.value=async function(o,u,c){let l={};e&&e.clearState===!0&&(l={...a.getPersistentLogAttributes()}),t.injectLambdaContextBefore(a,o,u,e);let f;try{f=await s.apply(this,[o,u,c])}catch(p){throw p}finally{t.injectLambdaContextAfterOrOnError(a,l,e)}return f}}}static injectLambdaContextAfterOrOnError(e,r,n){n&&n.clearState===!0&&e.setPersistentLogAttributes(r)}static injectLambdaContextBefore(e,r,n,i){e.addContext(n);let s;i&&i.hasOwnProperty("logEvent")&&(s=i.logEvent),e.logEventIfEnabled(r,s)}logEventIfEnabled(e,r){this.shouldLogEvent(r)&&this.info("Lambda invocation event",{event:e})}refreshSampleRateCalculation(){this.setLogsSampled()}removeKeys(e){this.removePersistentLogAttributes(e)}removePersistentLogAttributes(e){e.forEach(r=>{this.persistentLogAttributes&&r in this.persistentLogAttributes&&delete this.persistentLogAttributes[r]})}setLogLevel(e){if(this.isValidLogLevel(e))this.logLevel=this.logLevelThresholds[e];else throw new Error(`Invalid log level: ${e}`)}setPersistentLogAttributes(e){this.persistentLogAttributes=e}setSampleRateValue(e){this.powertoolLogData.sampleRateValue=e||this.getCustomConfigService()?.getSampleRateValue()||this.getEnvVarsService().getSampleRateValue()}shouldLogEvent(e){return typeof e=="boolean"?e:this.getLogEvent()}warn(e,...r){this.processLogItem(16,e,r)}shouldPrint(e){return e>=this.logLevel?!0:this.getLogsSampled()}addToPowertoolLogData(...e){e.forEach(r=>{(0,Kt.default)(this.powertoolLogData,r)})}createAndPopulateLogItem(e,r,n){let i=(0,Kt.default)({logLevel:this.getLogLevelNameFromNumber(e),timestamp:new Date,message:typeof r=="string"?r:r.message,xRayTraceId:this.envVarsService.getXrayTraceId()},this.getPowertoolLogData()),s=new Jf.LogItem({baseAttributes:this.getLogFormatter().formatAttributes(i),persistentAttributes:this.getPersistentLogAttributes()});return typeof r!="string"&&s.addAttributes(r),n.forEach(a=>{let o=a instanceof Error?{error:a}:typeof a=="string"?{extra:a}:a;s.addAttributes(o)}),s}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(e){return Object.entries(this.logLevelThresholds).find(([n,i])=>{if(i===e)return n})[0]}getPowertoolLogData(){return this.powertoolLogData}getReplacer(){let e=new WeakSet;return(r,n)=>{let i=n;if(i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&n!==null){if(e.has(i))return;e.add(i)}return i}}getSampleRateValue(){return this.powertoolLogData.sampleRateValue||this.setSampleRateValue(),this.powertoolLogData.sampleRateValue}isValidLogLevel(e){return typeof e=="string"&&e in this.logLevelThresholds}printLog(e,r){r.prepareForPrint();let n=e===24?"error":this.getLogLevelNameFromNumber(e).toLowerCase();this.console[n](JSON.stringify(r.getAttributes(),this.getReplacer(),this.logIndentation))}processLogItem(e,r,n){this.shouldPrint(e)&&this.printLog(e,this.createAndPopulateLogItem(e,r,n))}setConsole(){this.getEnvVarsService().isDevMode()?this.console=console:this.console=new Yf.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new Zf.EnvironmentVariablesService}setInitialLogLevel(e){let r=e?.toUpperCase();if(this.isValidLogLevel(r)){this.logLevel=this.logLevelThresholds[r];return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=this.logLevelThresholds[n];return}let i=this.getEnvVarsService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(i)){this.logLevel=this.logLevelThresholds[i];return}}setLogEvent(){this.getEnvVarsService().getLogEvent()&&(this.logEvent=!0)}setLogFormatter(e){this.logFormatter=e||new Qf.PowertoolLogFormatter}setLogIndentation(){this.getEnvVarsService().isDevMode()&&(this.logIndentation=4)}setLogsSampled(){let e=this.getSampleRateValue();this.logsSampled=e!==void 0&&(e===1||(0,Kf.randomInt)(0,100)/100<=e)}setOptions(e){let{logLevel:r,serviceName:n,sampleRateValue:i,logFormatter:s,customConfigService:a,persistentLogAttributes:o,environment:u}=e;return this.setEnvVarsService(),this.setConsole(),this.setCustomConfigService(a),this.setInitialLogLevel(r),this.setSampleRateValue(i),this.setLogsSampled(),this.setLogFormatter(s),this.setPowertoolLogData(n,u),this.setLogEvent(),this.setLogIndentation(),this.addPersistentLogAttributes(o),this}setPowertoolLogData(e,r,n={}){this.addToPowertoolLogData({awsRegion:this.getEnvVarsService().getAwsRegion(),environment:r||this.getCustomConfigService()?.getCurrentEnvironment()||this.getEnvVarsService().getCurrentEnvironment(),sampleRateValue:this.getSampleRateValue(),serviceName:e||this.getCustomConfigService()?.getServiceName()||this.getEnvVarsService().getServiceName()||this.getDefaultServiceName()},n)}};Fe.Logger=fn});var pn=d(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.IDEMPOTENCY_KEY=z.LOGGER_KEY=z.METRICS_KEY=z.TRACER_KEY=void 0;var Yt="powertools-for-aws",eh=`${Yt}.tracer`;z.TRACER_KEY=eh;var th=`${Yt}.metrics`;z.METRICS_KEY=th;var rh=`${Yt}.logger`;z.LOGGER_KEY=rh;var nh=`${Yt}.idempotency`;z.IDEMPOTENCY_KEY=nh});var Ns=d(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.cleanupMiddlewares=void 0;var zt=pn(),ih=t=>typeof t=="function",sh=async t=>{let e=[zt.TRACER_KEY,zt.METRICS_KEY,zt.LOGGER_KEY,zt.IDEMPOTENCY_KEY];for(let r of e)if(Object(t.internal).hasOwnProperty(r)){let n=t.internal[r];ih(n)&&await n(t)}};Qt.cleanupMiddlewares=sh});var gn=d(he=>{"use strict";var ah=he&&he.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),xs=he&&he.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ah(e,t,r)};Object.defineProperty(he,"__esModule",{value:!0});xs(Ns(),he);xs(pn(),he)});var Ms=d(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.injectLambdaContext=void 0;var Ps=hn(),oh=gn(),uh=(t,e)=>{let r=t instanceof Array?t:[t],n=[],i=e&&e.clearState===!0,s=u=>{u.internal={...u.internal,[oh.LOGGER_KEY]:o}},a=async u=>{r.forEach((c,l)=>{i&&(n[l]={...c.getPersistentLogAttributes()},s(u)),Ps.Logger.injectLambdaContextBefore(c,u.event,u.context,e)})},o=async()=>{i&&r.forEach((u,c)=>{Ps.Logger.injectLambdaContextAfterOrOnError(u,n[c],e)})};return{before:a,after:o,onError:o}};Jt.injectLambdaContext=uh});var $s=d(Ce=>{"use strict";var ch=Ce&&Ce.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),lh=Ce&&Ce.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ch(e,t,r)};Object.defineProperty(Ce,"__esModule",{value:!0});lh(Ms(),Ce)});var Gr=d(Q=>{"use strict";var dh=Q&&Q.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Zt=Q&&Q.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&dh(e,t,r)};Object.defineProperty(Q,"__esModule",{value:!0});Zt(Ci(),Q);Zt(hn(),Q);Zt($s(),Q);Zt(jt(),Q)});var Ds=d(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.createTracer=void 0;var fh=mn(),hh=(t={})=>new fh.Tracer(t);er.createTracer=hh});var Fs=d(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0})});var Bs=d(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.EnvironmentVariablesService=void 0;var ph=Pe(),vn=class extends ph.EnvironmentVariablesService{constructor(){super(...arguments),this.awsExecutionEnv="AWS_EXECUTION_ENV",this.samLocalVariable="AWS_SAM_LOCAL",this.tracerCaptureErrorVariable="POWERTOOLS_TRACER_CAPTURE_ERROR",this.tracerCaptureHTTPsRequestsVariable="POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",this.tracerCaptureResponseVariable="POWERTOOLS_TRACER_CAPTURE_RESPONSE",this.tracingEnabledVariable="POWERTOOLS_TRACE_ENABLED"}getAwsExecutionEnv(){return this.get(this.awsExecutionEnv)}getCaptureHTTPsRequests(){return this.get(this.tracerCaptureHTTPsRequestsVariable)}getSamLocal(){return this.get(this.samLocalVariable)}getTracingCaptureError(){return this.get(this.tracerCaptureErrorVariable)}getTracingCaptureResponse(){return this.get(this.tracerCaptureResponseVariable)}getTracingEnabled(){return this.get(this.tracingEnabledVariable)}};tr.EnvironmentVariablesService=vn});var Us=d(pe=>{"use strict";var gh=pe&&pe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Vs=pe&&pe.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&gh(e,t,r)};Object.defineProperty(pe,"__esModule",{value:!0});Vs(Fs(),pe);Vs(Bs(),pe)});var Xs=d((SE,Ws)=>{"use strict";function _n(t){return typeof t=="function"}var j=console.error.bind(console);function rt(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function nt(t){t&&t.logger&&(_n(t.logger)?j=t.logger:j("new logger isn't a function, not replacing"))}function ks(t,e,r){if(!t||!t[e]){j("no original function "+e+" to wrap");return}if(!r){j("no wrapper function"),j(new Error().stack);return}if(!_n(t[e])||!_n(r)){j("original object and wrapper must be functions");return}var n=t[e],i=r(n,e);return rt(i,"__original",n),rt(i,"__unwrap",function(){t[e]===i&&rt(t,e,n)}),rt(i,"__wrapped",!0),rt(t,e,i),i}function mh(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{j("must provide one or more modules to patch"),j(new Error().stack);return}if(!(e&&Array.isArray(e))){j("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(i){ks(n,i,r)})})}function Gs(t,e){if(!t||!t[e]){j("no function to unwrap."),j(new Error().stack);return}if(!t[e].__unwrap)j("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function vh(t,e){if(t)Array.isArray(t)||(t=[t]);else{j("must provide one or more modules to patch"),j(new Error().stack);return}if(!(e&&Array.isArray(e))){j("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){Gs(r,n)})})}nt.wrap=ks;nt.massWrap=mh;nt.unwrap=Gs;nt.massUnwrap=vh;Ws.exports=nt});var Qs=d((bE,zs)=>{"use strict";var Ks=Xs(),Be=Ks.wrap,rr=Ks.unwrap,ne="wrap@before";function nr(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function _h(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n],s=t[ne];if(typeof s=="function")s(i);else if(Array.isArray(s))for(var a=s.length,o=0;o<a;o++)s[o](i)}}function Ys(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function Eh(t,e,r){var n=Ys(t,e),i=n.filter(function(s){return r.indexOf(s)===-1});i.length>0&&_h(t,i)}function Hs(t,e){if(t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}zs.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(a){return function(u,c){var l=Ys(this,u).slice();try{var f=a.call(this,u,c);return Eh(this,u,l),f}finally{this.on.__wrapped||Be(this,"on",i),this.addListener.__wrapped||Be(this,"addListener",i)}}}function s(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(f){return function(){this._events[u]=c;try{return f.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Hs(c,n)}}}Be(this,"removeListener",l);try{return this._events[u]=Hs(c,n),a.apply(this,arguments)}finally{rr(this,"removeListener"),this._events[u]=c}}}e[ne]?typeof e[ne]=="function"?nr(e,ne,[e[ne],r]):Array.isArray(e[ne])&&e[ne].push(r):nr(e,ne,r),e.__wrapped||(Be(e,"addListener",i),Be(e,"on",i),Be(e,"emit",s),nr(e,"__unwrap",function(){rr(e,"addListener"),rr(e,"on"),rr(e,"emit"),delete e[ne],delete e.__wrapped}),nr(e,"__wrapped",!0))}});var ta=d((yE,ea)=>{"use strict";var S=require("util"),ie=require("assert"),Sh=Qs(),A=require("async_hooks"),it="cls@contexts",st="error@context",L=process.env.DEBUG_CLS_HOOKED,E=-1;ea.exports={getNamespace:Js,createNamespace:bh,destroyNamespace:Zs,reset:yh,ERROR_SYMBOL:st};function k(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}k.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,L){let n=" ".repeat(this._indent<0?0:this._indent);w(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};k.prototype.get=function(e){if(!this.active){if(L){let r=A.currentId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(L){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(i+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),w(`${i}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${S.inspect(this.active)}`)}return this.active[e]};k.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=E,L){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${S.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};k.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(L){let n=A.triggerAsyncId(),i=A.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);w(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${S.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[st]=r),n}finally{if(L){let n=A.triggerAsyncId(),i=A.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);w(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${S.inspect(r)}`)}this.exit(r)}};k.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};k.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return L&&w("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),n.then(i=>(L&&w("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),i)).catch(i=>{throw i[st]=r,L&&w("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),i})};k.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[st]=r),s}finally{n.exit(r)}}};k.prototype.enter=function(e){if(ie.ok(e,"context must be provided for entering"),L){let r=A.executionAsyncId(),n=A.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);w(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${S.inspect(e)}`)}this._set.push(this.active),this.active=e};k.prototype.exit=function(e){if(ie.ok(e,"context must be provided for exiting"),L){let n=A.executionAsyncId(),i=A.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);w(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${E} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${S.inspect(e)}`)}if(this.active===e){ie.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(L&&w("??ERROR?? context exiting but not entered - ignoring: "+S.inspect(e)),ie.ok(r>=0,`context not currently entered; can't exit. 
`+S.inspect(this)+`
`+S.inspect(e))):(ie.ok(r,"can't remove top context"),this._set.splice(r,1))};k.prototype.bindEmitter=function(e){ie.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){a&&(a[it]||(a[it]=Object.create(null)),a[it][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[it]))return a;let o=a,u=a[it];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}Sh(e,i,s)};k.prototype.fromException=function(e){return e[st]};function Js(t){return process.namespaces[t]}function bh(t){ie.ok(t,"namespace must be given a name."),L&&w(`NS-CREATING NAMESPACE (${t})`);let e=new k(t);return e.id=E,A.createHook({init(n,i,s,a){if(E=A.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),L){let o=" ".repeat(e._indent<0?0:e._indent);w(`${o}INIT [${i}] (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(E===0){let o=A.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(n,u),L){let c=" ".repeat(e._indent<0?0:e._indent);w(`${c}INIT USING CONTEXT FROM TRIGGERID [${i}] (${t}) asyncId:${n} currentUid:${E} triggerId:${o} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(L){let c=" ".repeat(e._indent<0?0:e._indent);w(`${c}INIT MISSING CONTEXT [${i}] (${t}) asyncId:${n} currentUid:${E} triggerId:${o} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(L&&i==="PROMISE"){w(S.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);w(`${u}INIT RESOURCE-PROMISE [${i}] (${t}) parentId:${o} asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){E=A.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(E),i){if(L){let s=A.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);w(`${a}BEFORE (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`),e._indent+=2}e.enter(i)}else if(L){let s=A.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);w(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${S.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){E=A.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(E),i){if(L){let s=A.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);w(`${a}AFTER (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`)}e.exit(i)}else if(L){let s=A.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);w(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`)}},destroy(n){if(E=A.executionAsyncId(),L){let i=A.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);w(`${s}DESTROY (${t}) currentUid:${E} asyncId:${n} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(e._contexts.get(E))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function Zs(t){let e=Js(t);ie.ok(e,`can't delete nonexistent namespace! "`+t+'"'),ie.ok(e.id,"don't assign to process.namespaces directly! "+S.inspect(e)),process.namespaces[t]=null}function yh(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Zs(t)}),process.namespaces=Object.create(null)}process.namespaces={};function w(...t){L&&process._rawDebug(`${S.format(...t)}`)}});var C=d((TE,ia)=>{"use strict";var En=["debug","info","warn","error","silent"],ra=En.indexOf("error"),Th=Ah(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),na={error:ir("error"),info:ir("info"),warn:ir("warn"),debug:ir("debug")};function ir(t){var e=En.indexOf(t),r=console[t]||console.log||(()=>{});return e>=Th?(n,i)=>{(n||i)&&r(Ch(t,n,i))}:()=>{}}function Ah(t){if(t){var e=t.toLowerCase(),r=En.indexOf(e);return r>=0?r:ra}return ra}function Rh(t){var e=-t.getTimezoneOffset(),r=e>=0?"+":"-",n=function(i){var s=Math.floor(Math.abs(i));return(s<10?"0":"")+s};return new Date(t.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+r+n(e/60)+":"+n(e%60)}function wh(){return process.env.LAMBDA_TASK_ROOT!==void 0}function Ch(t,e,r){var n=[];wh()||(n.push(Rh(new Date)),n.push(`[${t.toUpperCase()}]`)),e&&n.push(e);var i=n.join(" "),s=Lh(r);return[i,s].filter(a=>a.length>0).join(`
  `)}function Lh(t){return t?typeof t=="string"?t:JSON.stringify(t):""}var Oh={setLogger:function(e){na=e},getLogger:function(){return na}};ia.exports=Oh});var Sn=d((AE,aa)=>{"use strict";var Ih=require("crypto");function sa(t,e){this.init(t,e)}sa.prototype.init=function(e,r){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!r,this.id=Ih.randomBytes(8).toString("hex"),n.stack){var i=n.stack.split(`
`);i.shift(),i.forEach(s=>{var a=s.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,u=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:o||"anonymous"};this.stack.push(c)},this)}};aa.exports=sa});var ua=d((RE,oa)=>{oa.exports=qh;function qh(t){var e=!1,r=null,n=null,i=null;return a;function s(o){i&&Ph(i,o),e=!1,i=n;var u=r;if(r=null,n=null,!u||!u.length){if(!i||!i.length){i=null;return}u||(u=[])}e=!0,t(u,s)}function a(o,u){e?(r||(r=[],n=[]),Nh(r,o),u&&n.push(u)):(u&&(i=[u]),e=!0,t(Array.isArray(o)?o:[o],s))}}function Nh(t,e){Array.isArray(e)?xh(t,e):t.push(e)}function xh(t,e){for(var r=0;r<e.length;r++)t.push(e[r])}function Ph(t,e){for(var r=0;r<t.length;r++)t[r](e)}});var sr=d((wE,da)=>{"use strict";var ca=C(),X={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?ca.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(la(e),ca.getLogger().info("Configured daemon address to "+e+"."))}},la=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var r=e.split(" ");if(r.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");X.udp_ip=n[0],X.tcp_ip=n[0],X.udp_port=n[1],X.tcp_port=n[1]}else if(r.length===2){var i=r[0].split(":"),s=r[1].split(":"),a={};if(a[i[0]]=i,a[s[0]]=s,X.udp_ip=a.udp[1],X.udp_port=parseInt(a.udp[2]),X.tcp_ip=a.tcp[1],X.tcp_port=parseInt(a.tcp[2]),!X.udp_port||!X.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&la(process.env.AWS_XRAY_DAEMON_ADDRESS);da.exports=X});var or=d((CE,va)=>{"use strict";var pa=require("dgram"),Mh=ua(),ar=C(),fa='{"format":"json","version":1}',ha=`
`;function $h(t,e){var r=pa.createSocket("udp4");ga(r,t,0,function(){try{r.close()}finally{e()}})}function ga(t,e,r,n){if(r>=e.length){n();return}Dh(t,e[r],function(){ga(t,e,r+1,n)})}function Dh(t,e,r){var n=e.msg,i=e.offset,s=e.length,a=e.port,o=e.address,u=e.callback;t.send(n,i,s,a,o,function(c){try{u(c)}finally{r()}})}function ma(){this.batchSend=Mh($h)}ma.prototype.send=function(t,e,r,n,i,s){var a={msg:t,offset:e,length:r,port:n,address:i,callback:s};this.batchSend(a)};var jh={daemonConfig:sr(),format:function(e){return fa+ha+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new ma:this.socket=pa.createSocket("udp4").unref());var r=this.socket,n=e.format(),i=fa+ha+n,s=Buffer.from(i),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";r.send(s,0,s.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?ar.getLogger().error(o+" too large to send: "+a+" ("+s.length+" bytes)."):ar.getLogger().error("Error occured sending segment: ",u):(ar.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),ar.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};va.exports=jh});var cr=d((LE,_a)=>{"use strict";var Fh=require("crypto"),ur=C(),bn=class t{constructor(e,r){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=r||Fh.randomBytes(12).toString("hex")}static Invalid(){return new t("00000000","000000000000000000000000")}static FromString(e){let r="-";var n=new t,i,s;if(!e||typeof e!="string")return ur.getLogger().error("Empty or non-string trace ID provided"),n;let a=e.trim().split(r);return a.length!==3?(ur.getLogger().error("Unrecognized trace ID format"),n):(i=parseInt(a[0]),isNaN(i)||i<1?(ur.getLogger().error("Trace ID version must be positive integer"),n):(s=parseInt(a[1],16).toString(16),s==="NaN"?(ur.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(n.version=i,n.timestamp=s,n.id=a[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};_a.exports=bn});var M=d((OE,Ea)=>{"use strict";var Bh=require("crypto"),at=C(),Vh=cr(),yn={getCauseTypeFromHttpStatus:function(e){var r=e.toString();if(r.match(/^[4][0-9]{2}$/)!==null)return"error";if(r.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,r){if(e===void 0||r===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,i=r.length,s=e.indexOf("*");if(e=e.toLowerCase(),r=r.toLowerCase(),s===-1||s===n-1){var a=function(){for(var p=0,h=0;h<n;h++){var x=e.charAt(h);if(x==="*")return!0;if(x==="?"){if(p===i)return!1;p++}else{if(p>=i||x!=r.charAt(p))return!1;p++}}return p===i};return a()}var o=[];o[0]=!0;for(var u=0;u<n;u++){var c,l=e.charAt(u);if(l!="*")for(c=i-1;c>=0;c--)o[c+1]=!!o[c]&&(l==="?"||l===r.charAt(c));else{for(c=0;c<=i&&!o[c];)c++;for(c;c<=i;c++)o[c]=!0}o[0]=o[0]&&l==="*"}return o[i]},LambdaUtils:{validTraceData:function(t){var e=!1;if(t){var r=yn.processTraceData(t);e=!!(r&&r.root&&r.parent&&r.sampled)}return e},populateTraceData:function(t,e){at.getLogger().debug("Lambda trace data found: "+e);let r=yn.processTraceData(e);var n=!1;return r?!r.root||!r.parent||!r.sampled?at.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(r={},at.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),t.trace_id=Vh.FromString(r.root).toString(),t.id=r.parent||Bh.randomBytes(8).toString("hex"),r.root&&t.trace_id!==r.root&&(at.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(r.sampled)?delete t.notTraced:t.notTraced=!0,r.data&&(t.userData=r.data),at.getLogger().debug("Segment started: "+JSON.stringify(r)),n}},processTraceData:function(e){var r={},n={},i=["root","parent","sampled","self"],s=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let u=o[0].trim(),c=o[1].trim(),l=u.toLowerCase(),f=i.indexOf(l)!==-1;f?r[l]=c:!f&&s-(l.length+c.length)>=0&&(n[u]=c,s-=u.length+c.length)}}}),r.data=n),r},objectWithoutProperties:function(e,r,n){r=Array.isArray(r)?r:[],n=typeof n=="boolean"?n:!1;var i=n?Object.create(Object.getPrototypeOf(e)):{};for(var s in e)r.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i},safeParseInt:t=>!t||isNaN(t)?0:parseInt(t)};Ea.exports=yn});var ge=d((IE,ya)=>{"use strict";var{safeParseInt:Sa}=M(),ba=C(),Uh=100,Tn={streamingThreshold:Uh,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(Tn.streamingThreshold=e,ba.getLogger().debug("Subsegment streaming threshold set to: "+e)):ba.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return Tn.streamingThreshold},getHttpResponseData:t=>{let e={};if(!t)return e;let r=Sa(t.statusCode);return r!==0&&(e.status=r),t.headers&&t.headers["content-length"]&&(e.content_length=Sa(t.headers["content-length"])),e}};ya.exports=Tn});var Ra=d((qE,Aa)=>{"use strict";var{getHttpResponseData:kh}=ge(),{stripQueryStringFromPath:Gh}=M();function Ta(t,e,r){this.init(t,e,r)}Ta.prototype.init=function(e,r,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+Gh(e.path):"",method:e.method||""},n&&(this.request.traced=!0),r&&(this.response=kh(r))};Aa.exports=Ta});var ot=d((NE,wa)=>{"use strict";var Wh=require("crypto"),Xh=Sn(),Hh=Ra(),Kh=or(),An=ge(),Yh=M(),se=C();function b(t){this.init(t)}b.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=Wh.randomBytes(8).toString("hex"),this.name=e,this.start_time=An.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};b.prototype.addNewSubsegment=function(e){let r=new b(e);return this.addSubsegment(r),r};b.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};b.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new b(e);return this.addSubsegment(r),r.notTraced=!0,r};b.prototype.addSubsegment=function(t){if(!(t instanceof b))throw new Error("Failed to add subsegment:"+t+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),t.segment=this.segment,t.parent=this,t.notTraced=t.parent.notTraced,t.end_time===void 0&&this.incrementCounter(t.counter),this.subsegments.push(t)};b.prototype.removeSubsegment=function(e){if(!(e instanceof b))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};b.prototype.addAttribute=function(e,r){this[e]=r};b.prototype.addPrecursorId=function(t){typeof t!="string"&&se.getLogger().error("Failed to add id:"+t+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(t)};b.prototype.addAnnotation=function(t,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){se.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof t!="string"){se.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[t]=e};b.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){se.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){se.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};b.prototype.addSqlData=function(e){this.sql=e};b.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){se.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new Xh(e,r))};b.prototype.addRemoteRequestData=function(e,r,n){this.http=new Hh(e,r,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};b.prototype.addFaultFlag=function(){this.fault=!0};b.prototype.addErrorFlag=function(){this.error=!0};b.prototype.addThrottleFlag=function(){this.throttle=!0};b.prototype.close=function(e,r){var n=this.segment;this.end_time=An.getCurrentTime(),delete this.in_progress,e&&this.addError(e,r),this.parent&&this.parent.decrementCounter(),n&&n.counter>An.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};b.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};b.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};b.prototype.isClosed=function(){return!this.in_progress};b.prototype.flush=function(){if(!this.parent||!this.segment){se.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?Kh.send(this):se.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):se.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};b.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(r){r.streamSubsegments()||e.push(r)}),this.subsegments=e}};b.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),JSON.stringify(this)};b.prototype.toString=function(){return JSON.stringify(this)};b.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=Yh.objectWithoutProperties(this,e,!1);return r};wa.exports=b});var ut=d((xE,Oa)=>{"use strict";var zh=require("crypto"),Qh=Sn(),Jh=or(),H=ge(),lr=ot(),Ca=cr(),La=M(),me=C();function y(t,e,r){this.init(t,e,r)}y.prototype.init=function(e,r,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var i;r&&typeof r=="string"?i=Ca.FromString(r):i=new Ca;var s=zh.randomBytes(8).toString("hex"),a=H.getCurrentTime();this.trace_id=i.toString(),this.id=s,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),H.serviceData&&this.setServiceData(H.serviceData),H.pluginData&&this.addPluginData(H.pluginData),H.origin&&(this.origin=H.origin),H.sdkData&&this.setSDKData(H.sdkData)};y.prototype.addIncomingRequestData=function(e){this.http=e};y.prototype.addAnnotation=function(e,r){if(typeof r!="boolean"&&typeof r!="string"&&!isFinite(r)){me.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){me.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=r};y.prototype.setUser=function(t){typeof t!="string"&&me.getLogger().error("Set user: "+t+" failed. User IDs must be of type string."),this.user=t};y.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){me.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){me.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};y.prototype.setSDKData=function(e){if(!e){me.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};y.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};y.prototype.setServiceData=function(e){if(!e){me.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};y.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};y.prototype.addNewSubsegment=function(e){var r=new lr(e);return this.addSubsegment(r),r};y.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};y.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new lr(e);return this.addSubsegment(r),r.notTraced=!0,r};y.prototype.addSubsegment=function(e){if(!(e instanceof lr))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};y.prototype.removeSubsegment=function(e){if(!(e instanceof lr))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};y.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){me.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new Qh(e,r))};y.prototype.addFaultFlag=function(){this.fault=!0};y.prototype.addErrorFlag=function(){this.error=!0};y.prototype.addThrottleFlag=function(){this.throttle=!0};y.prototype.isClosed=function(){return!this.in_progress};y.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>H.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var r=[];this.subsegments.forEach(function(n){n.streamSubsegments()||r.push(n)}),this.subsegments=r}};y.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};y.prototype.close=function(t,e){this.end_time||(this.end_time=H.getCurrentTime()),t!==void 0&&this.addError(t,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};y.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=La.objectWithoutProperties(this,["counter","notTraced"],!0);Jh.send(e)}};y.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=La.objectWithoutProperties(this,e,!1);return JSON.stringify(r)};y.prototype.toString=function(){return JSON.stringify(this)};Oa.exports=y});var Ee=d((PE,xa)=>{"use strict";var ct=ta(),J=C(),Rn=ut(),Ia=ot(),ve=!0,_e="AWSXRay",qa="segment",Na=!1,$={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var r=new Error(e);J.getLogger().error(r.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!$.isAutomaticMode()){var r=e.XRaySegment||e.XraySegment,n=e.Segment,i=null;return r&&(r instanceof Rn||r instanceof Ia)?(i=r,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof Rn||n instanceof Ia)&&(i=n,delete e.Segment),i}},getNamespace:function(){return ct.getNamespace(_e)||ct.createNamespace(_e)},resolveSegment:function(e){if(ve)return this.getSegment();if(e&&!ve)return e;!e&&!ve&&$.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(ve){var e=$.getNamespace(_e).get(qa);return e?e instanceof Rn&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():$.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else $.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){ve?$.getNamespace(_e).set(qa,e)||J.getLogger().warn("Failed to set the current sub/segment on the context."):$.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return ve},enableAutomaticMode:function(){ve=!0,$.getNamespace(_e),J.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){ve=!1,ct.getNamespace(_e)&&ct.destroyNamespace(_e),J.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Na)J.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var r=$.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(r)$.contextMissingStrategy.contextMissing=r.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?J.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):J.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys($.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")$.contextMissingStrategy.contextMissing=e,J.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};ct.createNamespace(_e);J.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default).");process.env.AWS_XRAY_CONTEXT_MISSING?($.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Na=!0):($.contextMissingStrategy.contextMissing=$.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,J.getLogger().debug("Using default context missing strategy: LOG_ERROR"));xa.exports=$});var Cn=d((ME,Pa)=>{"use strict";var{getHttpResponseData:Zh}=ge();function wn(t){this.init(t)}wn.prototype.init=function(e){var r=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:ep(e)||"",url:n||""},r&&(this.request.x_forwarded_for=r)};var ep=function(e){var r;return e.headers["x-forwarded-for"]?r=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?r=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?r=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(r=e.connection.socket.remoteAddress),r};wn.prototype.close=function(e){this.response=Zh(e)};Pa.exports=wn});var $a=d(($E,Ma)=>{"use strict";function Ln(t,e){this.init(t,e)}Ln.prototype.init=function(e,r){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof r=="number"&&r>=0&&r<=1)this.fallbackRate=r;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};Ln.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Ma.exports=Ln});var Da=d((DE,tp)=>{tp.exports={default:{fixed_target:1,rate:.05},version:2}});var In=d((jE,Ua)=>{"use strict";var rp=require("fs"),ja=$a(),On=M(),np=Da(),dr=C(),Ba={shouldSample:function(e){var r=e.host,n=e.httpMethod,i=e.urlPath,s="{ http_method: "+n+", host: "+r+", url_path: "+i+" }",a;return this.rules.some(function(o){if(o.default||r==null||On.wildcardMatch(o.host,r)&&(n==null||On.wildcardMatch(o.http_method,n))&&(i==null||On.wildcardMatch(o.url_path,i)))return a=o.reservoir,dr.getLogger().debug("Local sampling rule match found for "+s+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(dr.getLogger().debug("No sampling rule matched for "+s),!1)},setLocalRules:function(e){e?typeof e=="string"?(dr.getLogger().info("Using custom sampling rules file: "+e),this.rules=Fa(JSON.parse(rp.readFileSync(e,"utf8")))):(dr.getLogger().info("Using custom sampling rules source."),this.rules=Fa(e)):this.rules=Va(np)}},Fa=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Va(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Va=function(e){var r,n=[];if(e.default){var i=[];for(var s in e.default){if(s!=="fixed_target"&&s!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+s+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[s]!="number")throw new Error("Error in sampling file. Default "+s+" must be a number.")}if(typeof e.default.fixed_target>"u"&&i.push("fixed_target"),typeof e.default.rate>"u"&&i.push("rate"),i.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+i+".");r={default:!0,reservoir:new ja(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in a){var l=a[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(o[c]=l),e.version===1&&c==="service_name"?o.host=l:o[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(u)+".");var f=o;f.reservoir=new ja(a.fixed_target,a.rate),n.push(f)}),n.push(r),n};Ba.setLocalRules();Ua.exports=Ba});var Ga=d((FE,ka)=>{"use strict";function Ve(){this.init()}Ve.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Ve.prototype.borrowOrTake=function(e,r){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(r)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Ve.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Ve.prototype.loadNewQuota=function(e,r,n){e&&(this.quota=e),r&&(this.TTL=r),n&&(this.reportInterval=n/10)};Ve.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};ka.exports=Ve});var Xa=d((BE,Wa)=>{"use strict";var lt=M(),ip=Ga();function q(t,e,r,n,i,s,a,o,u){this.init(t,e,r,n,i,s,a,o,u)}q.prototype.init=function(e,r,n,i,s,a,o,u,c){this.name=e,this.priority=r,this.rate=n,this.host=s,this.httpMethod=a,this.urlPath=o,this.serviceName=u,this.serviceType=c,this.reservoir=new ip,this.borrow=!!i,this.resetStatistics()};q.prototype.match=function(e){var r=e.host,n=e.httpMethod,i=e.serviceName,s=e.urlPath,a=e.serviceType;return this.isDefault()||(!r||lt.wildcardMatch(this.host,r))&&(!n||lt.wildcardMatch(this.httpMethod,n))&&(!i||lt.wildcardMatch(this.serviceName,i))&&(!s||lt.wildcardMatch(this.urlPath,s))&&(!a||lt.wildcardMatch(this.serviceType,a))};q.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};q.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};q.prototype.isDefault=function(){return this.name==="Default"};q.prototype.incrementRequestCount=function(){this.requestCount++};q.prototype.incrementBorrowCount=function(){this.borrowCount++};q.prototype.incrementSampledCount=function(){this.sampledCount++};q.prototype.setRate=function(e){this.rate=e};q.prototype.getRate=function(){return this.rate};q.prototype.getName=function(){return this.name};q.prototype.getPriority=function(){return this.priority};q.prototype.getReservoir=function(){return this.reservoir};q.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};q.prototype.canBorrow=function(){return this.borrow};q.prototype.everMatched=function(){return this.requestCount>0};q.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Wa.exports=q});var qn=d((VE,za)=>{"use strict";var sp=require("crypto"),ap=C(),op=Xa(),fr=sr(),up=require("util"),cp=require("http"),Ka={clientId:sp.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:ap,httpClient:cp,fetchSamplingRules:function(e){let r="{}",n=Ha(this.samplingRulesPath,r.length),s=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,a=>{var o="";a.on("data",u=>{o+=u}),a.on("error",u=>{e(u)}),a.on("end",()=>{var u;try{u=JSON.parse(o)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=dp(u);e(null,c)})});s.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),s.write(r),s.end()},fetchTargets:function(e,r){let n=JSON.stringify(lp(e)),i=Ha(this.samplingTargetsPath,n.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(i,o=>{var u="";o.on("data",c=>{u+=c}),o.on("error",c=>{r(c)}),o.on("end",()=>{var c;try{c=JSON.parse(u)}catch(p){r(p);return}if(!c||typeof c.LastRuleModification!="number"){r(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=fp(c),f=Ya(c.LastRuleModification);r(null,l,f)})});a.on("error",()=>{r(new Error(`Failed to connect to X-Ray daemon at ${i.hostname}:${i.port} to get sampling targets.`))}),a.write(n),a.end()}},lp=function(e){var r=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(i){var s=i.snapshotStatistics(),a={RuleName:i.getName(),ClientID:Ka.clientId,RequestCount:s.requestCount,BorrowCount:s.borrowCount,SampledCount:s.sampledCount,Timestamp:n};r.push(a)}),{SamplingStatisticsDocuments:r}},dp=function(e){var r=[],n=e.SamplingRuleRecords||[];return n.forEach(function(i){if(i=i.SamplingRule,hp(i)){var s=new op(i.RuleName,i.Priority,i.FixedRate,i.ReservoirSize,i.Host,i.HTTPMethod,i.URLPath,i.ServiceName,i.ServiceType);r.push(s)}}),r},fp=function(e){var r=e.SamplingTargetDocuments||[],n={};return r.forEach(function(i){var s={rate:i.FixedRate,quota:i.ReservoirQuota,TTL:Ya(i.ReservoirQuotaTTL),interval:i.Interval};n[i.RuleName]=s}),n},hp=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Ya=function(e){return new Date(e).getTime()/1e3},Ha=function(e,r){return{hostname:fr.tcp_ip,port:fr.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":r,Host:up.format("%s:%d",fr.tcp_ip,fr.tcp_port)}}};za.exports=Ka});var hr=d((UE,Qa)=>{"use strict";var pp=3600,Nn={rules:[],lastUpdated:null,getMatchedRule:function(e,r){if(gp(r))return null;var n;return this.rules.forEach(function(i){!n&&i.match(e)&&(n=i),i.isDefault()&&!n&&(n=i)}),n},loadRules:function(e){var r={};this.rules.forEach(function(n){r[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var i=r[n.getName()];i&&n.merge(i)}),this.rules.sort(function(n,i){var s=n.getPriority()-i.getPriority();return s!==0?s:n.getName()>i.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(r){var n=e[r.getName()];n&&(r.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),r.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},gp=function(e){return Nn.getLastUpdated()?e>Nn.getLastUpdated()+pp:!0};Qa.exports=Nn});var Pn=d((kE,to)=>{"use strict";var xn=C(),mp=qn(),Ja=hr(),vp=5*60*1e3,_p={start:function(){this.poller&&clearInterval(this.poller),Za(!1),this.poller=setInterval(Za,vp),this.poller.unref()}},Za=function(e){if(e=typeof e>"u"?!0:e,e){var r=Sp();setTimeout(eo,r)}else eo()},eo=function(){try{Ep()}catch(e){xn.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},Ep=function(){var e=Math.floor(new Date().getTime()/1e3);mp.fetchSamplingRules(function(r,n){r?xn.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",r):n.length!==0&&(Ja.loadRules(n),Ja.timestamp(e),xn.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},Sp=function(){return Math.random()*5};to.exports=_p});var so=d((GE,io)=>{"use strict";var bp=Pn(),yp=qn(),Mn=hr(),pr=C(),ro=10*1e3,no={interval:ro,start:function(){this.poller=setInterval(Tp,ro+wp()),this.poller.unref()}},Tp=function(){try{Ap()}catch(e){pr.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},Ap=function(){var e=Rp();e&&e.length>0&&yp.fetchTargets(e,function(r,n,i){if(r){pr.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",r);return}Mn.loadTargets(n),i>Mn.getLastUpdated()&&(pr.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),bp.start()),pr.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},Rp=function(){var e=Mn.getRules(),r=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&r.push(n)}),r},wp=function(){return Math.random()/no.interval};io.exports=no});var oo=d((WE,ao)=>{"use strict";var $n=C(),Cp=require("util"),Lp=ge(),Op={localSampler:In(),rulePoller:Pn(),targetPoller:so(),ruleCache:hr(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=Lp.origin);var r=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,r);return n?($n.getLogger().debug(Cp.format("Rule %s is matched.",n.getName())),Ip(n,r)):($n.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(i){$n.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+i)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},Ip=function(e,r){e.incrementRequestCount();var n=e.getReservoir(),i=!0,s=n.borrowOrTake(r,e.canBorrow());return s==="borrow"?e.incrementBorrowCount():s==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():i=!1,i?e.getName():!1};ao.exports=Op});var jn=d((XE,uo)=>{"use strict";var qp=ut(),Np=Cn(),xp=C(),Pp=M(),Mp=M().wildcardMatch,$p=M().processTraceData,Dn="x-amzn-trace-id",Dp=!!process.env.AWS_XRAY_TRACING_NAME,jp={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:oo(),enableDynamicNaming:function(t){if(this.dynamicNaming=!0,t&&typeof t!="string")throw new Error("Host pattern must be a string.");this.hostPattern=t||null},processHeaders:function(e){var r={};return e&&e.headers&&e.headers[Dn]&&(r=$p(e.headers[Dn])),r},resolveName:function(e){var r;return this.dynamicNaming&&e?r=this.hostPattern?Mp(this.hostPattern,e)?e:this.defaultName:e:r=this.defaultName,r},resolveSampling:function(e,r,n){var i;if(e.sampled==="1")i=!0;else if(e.sampled==="0")i=!1;else{var s={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:r.name};i=this.sampler.shouldSample(s),(i instanceof String||typeof i=="string")&&(r.setMatchedSamplingRule(i),i=!0)}e.sampled==="?"&&(n.header[Dn]="Root="+e.root+";Sampled="+(i?"1":"0")),i||(r.notTraced=!0)},setDefaultName:function(e){Dp||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=In()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,r,n){xp.getLogger().debug(e+": { url: "+r+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,r){var n=this.processHeaders(e),i=this.resolveName(e.headers.host),s=new qp(i,n.root,n.parent),a=Object.assign({},r,{req:e});this.resolveSampling(n,s,a),s.addIncomingRequestData(new Np(e)),this.middlewareLog("Starting middleware segment",e.url,s);var o=this.middlewareLog,u=!1,c=function(){if(u)return;u=!0,r.statusCode===429&&s.addThrottleFlag();let l=Pp.getCauseTypeFromHttpStatus(r.statusCode);l&&(s[l]=!0),s.http.close(r),s.close(),o("Closed middleware segment successfully",e.url,s)};return r.on("finish",c),r.on("close",c),s}};uo.exports=jp});var fo=d((HE,lo)=>{"use strict";var gr=Ee(),Fp=jn(),Fn=M().LambdaUtils,Bp=ut(),Vp=or(),Up=ge(),Vn=C(),co=cr(),Bn=null;lo.exports.init=function(){gr.enableManualMode=function(){Vn.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Vp.disableReusableSocket(),Up.setStreamingThreshold(0),Vn.getLogger().info("Disabling centralized sampling in Lambda environment."),Fp.disableCentralizedSampling();var e=gr.getNamespace();e.enter(e.createContext()),gr.setSegment(kp())};var kp=function(){var e=new Bp("facade"),r=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],i=process.env._X_AMZN_TRACE_ID;for(var s in e)typeof e[s]=="function"&&r.indexOf(s)===-1&&(n.indexOf(s)===-1?e[s]=function(){var a=s;return function(){Vn.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[s]=function(){});return e.trace_id=co.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=co.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){var o=process.env._X_AMZN_TRACE_ID;o?o!=Bn&&(this.reset(),Fn.populateTraceData(e,o)&&(Bn=o)):(this.reset(),gr.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},Fn.validTraceData(i)&&Fn.populateTraceData(e,i)&&(Bn=i),e}});var ho=d((KE,Gp)=>{Gp.exports={name:"aws-xray-sdk-core",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/service-error-classification":"^3.4.1","@aws-sdk/types":"^3.4.1","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.3.8"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov && codecov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var mo=d((YE,go)=>{"use strict";var Un=require("http"),po={METADATA_TIMEOUT:1e3,getPluginMetadata:function(t,e){var i=5,s=function(){var a=Un.__request?Un.__request:Un.request,o=a(t,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else i>0&&Math.floor(this.statusCode/100)===5?(i--,setTimeout(s,250)):e(new Error(`Failed to retrieve metadata with options: ${t}`))})});o.on("error",function(u){e(u)}),o.on("timeout",function(){o.abort()}),o.setTimeout(po.METADATA_TIMEOUT),o.end()};s()}};go.exports=po});var bo=d((zE,So)=>{"use strict";var _o=mo(),vo=C(),kn=require("http"),Wp={getData:function(t){let e="/latest/dynamic/instance-identity/document";function r(n){let i=Eo(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});_o.getPluginMetadata(i,function(s,a){if(s||!a){vo.getLogger().error("Error loading EC2 plugin metadata: ",s?s.toString():"Could not retrieve data from IMDS."),t();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};t(o)})}Xp(function(n){n===null&&vo.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),r(n)})},originName:"AWS::EC2::Instance"};function Xp(t){let e=kn.__request?kn.__request:kn.request,i=Eo("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),s=e(i,function(a){let o="";a.on("data",function(u){o+=u}),a.on("end",function(){this.statusCode===200||this.statusCode===300?t(o):t(null)})});s.on("error",function(){t(null)}),s.on("timeout",function(){s.abort(),t(null)}),s.setTimeout(_o.METADATA_TIMEOUT),s.end()}function Eo(t,e,r){return e||(e="GET"),r||(r={}),{host:"169.254.169.254",path:t,method:e,headers:r}}So.exports=Wp});var To=d((QE,yo)=>{"use strict";var Hp=require("os"),Kp={getData:function(t){t({ecs:{container:Hp.hostname()}})},originName:"AWS::ECS::Container"};yo.exports=Kp});var Ro=d((JE,Ao)=>{"use strict";var Yp=require("fs"),zp=C(),Qp="/var/elasticbeanstalk/xray/environment.conf",Jp={getData:function(t){Yp.readFile(Qp,"utf8",function(e,r){if(e)zp.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),t();else{var n=JSON.parse(r),i={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};t(i)}})},originName:"AWS::ElasticBeanstalk::Environment"};Ao.exports=Jp});var wo=d((ZE,Zp)=>{Zp.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var No=d((eS,qo)=>{"use strict";var Oo=require("fs"),Ue=C(),eg=wo(),mr={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function _r(t){this.init(t)}_r.prototype.init=function(e){e?typeof e=="string"?(Ue.getLogger().info("Using custom AWS whitelist file: "+e),this.services=vr(JSON.parse(Oo.readFileSync(e,"utf8")))):(Ue.getLogger().info("Using custom AWS whitelist source."),this.services=vr(e)):this.services=eg.services};_r.prototype.append=function(e){var r={};typeof e=="string"?(Ue.getLogger().info("Appending AWS whitelist with custom file: "+e),r=vr(JSON.parse(Oo.readFileSync(e,"utf8")))):(Ue.getLogger().info("Appending AWS whitelist with a custom source."),r=vr(e));for(var n in r)this.services[n]=r[n]};_r.prototype.capture=function(e,r){var n=r.request.operation,i=this.services[e]!==void 0?this.services[e].operations[n]:null;if(i===null){Ue.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var s={};for(var a in i){var o=i[a];a===mr.REQ_PARAMS?Co(o,r.request.params,s):a===mr.REQ_DESC?Lo(o,r.request.params,s):a===mr.RES_PARAMS?r.data&&Co(o,r.data,s):a===mr.RES_DESC?r.data&&Lo(o,r.data,s):Ue.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return s};function Co(t,e,r){t.forEach(function(n){if(typeof e[n]<"u"){var i=Io(n);this[i]=e[n]}},r)}function Lo(t,e,r){for(var n in t){var i=t[n];if(typeof e[n]<"u"){var s;if(i.list&&i.get_count?s=e[n]?e[n].length:0:s=i.get_keys===!0?Object.keys(e[n]):e[n],typeof i.rename_to=="string")r[i.rename_to]=s;else{var a=Io(n);r[a]=s}}}}function Io(t){return t==="IPAddress"?"ip_address":t.split(/(?=[A-Z])/).join("_").toLowerCase()}function vr(t){var e=t;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}qo.exports=_r});var dt=d((tS,Er)=>{"use strict";var xo=No(),Gn=new xo;function Wn(t,e){this.init(t,e)}Wn.prototype.init=function(e,r){this.operation=ng(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&r&&r.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),r&&this.addData(Gn.capture(r.toLowerCase(),e))};Wn.prototype.addData=function(e){for(var r in e)this[r]=e[r]};var tg=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Gn=new xo(e)},rg=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Gn.append(e)};function ng(t){if(t)return t.charAt(0).toUpperCase()+t.slice(1)}Er.exports=Wn;Er.exports.appendAWSWhitelist=rg;Er.exports.setAWSWhitelist=tg});var br=d((rS,Sr)=>{"use strict";var Le=Ee(),ft=C(),Po=function(e,r,n){Xn(e,r);var i,s,a=Le.resolveSegment(n);if(!a)return ft.getLogger().warn("Failed to capture function."),r();i=a.addNewSubsegment(e),s=Mo(r,i);try{let o=s(i);return i.close(),o}catch(o){throw i.close(o),o}},ig=function(e,r,n){Xn(e,r);var i,s,a=Le.resolveSegment(n);if(!a)return ft.getLogger().warn("Failed to capture async function."),r();i=a.addNewSubsegment(e),s=Mo(r,i);try{return s(i)}catch(o){throw i.close(o),o}},sg=function(e,r,n){Xn(e,r);var i=Le.resolveSegment(n);return i?(i.incrementCounter(),function(){var s=Le.resolveSegment(n),a=Array.prototype.slice.call(arguments);Po(e,r.bind.apply(r,[null].concat(a)),s),i.decrementCounter()}.bind(this)):(ft.getLogger().warn("Failed to capture callback function."),r)};function Mo(t,e){var r;if(Le.isAutomaticMode()){var n=Le.getNamespace(),i=function(){var s;return n.run(function(){Le.setSegment(e),s=t(e)}),s};r=i}else r=t;return r}function Xn(t,e){var r;if(!t||typeof t!="string")throw r='Param "name" must be a non-empty string.',ft.getLogger().error(r),new Error(r);if(typeof e!="function")throw r='Param "fcn" must be a function.',ft.getLogger().error(r),new Error(r)}Sr.exports.captureFunc=Po;Sr.exports.captureAsyncFunc=ig;Sr.exports.captureCallbackFunc=sg});var ht=d((nS,$o)=>{var ag="2.0.0",og=Number.MAX_SAFE_INTEGER||9007199254740991,ug=16,cg=256-6,lg=["major","premajor","minor","preminor","patch","prepatch","prerelease"];$o.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:ug,MAX_SAFE_BUILD_LENGTH:cg,MAX_SAFE_INTEGER:og,RELEASE_TYPES:lg,SEMVER_SPEC_VERSION:ag,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var pt=d((iS,Do)=>{var dg=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Do.exports=dg});var ke=d((ae,jo)=>{var{MAX_SAFE_COMPONENT_LENGTH:Hn,MAX_SAFE_BUILD_LENGTH:fg,MAX_LENGTH:hg}=ht(),pg=pt();ae=jo.exports={};var gg=ae.re=[],mg=ae.safeRe=[],g=ae.src=[],m=ae.t={},vg=0,Kn="[a-zA-Z0-9-]",_g=[["\\s",1],["\\d",hg],[Kn,fg]],Eg=t=>{for(let[e,r]of _g)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},v=(t,e,r)=>{let n=Eg(e),i=vg++;pg(t,i,e),m[t]=i,g[i]=e,gg[i]=new RegExp(e,r?"g":void 0),mg[i]=new RegExp(n,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","\\d+");v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Kn}*`);v("MAINVERSION",`(${g[m.NUMERICIDENTIFIER]})\\.(${g[m.NUMERICIDENTIFIER]})\\.(${g[m.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${g[m.NUMERICIDENTIFIERLOOSE]})\\.(${g[m.NUMERICIDENTIFIERLOOSE]})\\.(${g[m.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${g[m.NUMERICIDENTIFIER]}|${g[m.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${g[m.NUMERICIDENTIFIERLOOSE]}|${g[m.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${g[m.PRERELEASEIDENTIFIER]}(?:\\.${g[m.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${g[m.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${g[m.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER",`${Kn}+`);v("BUILD",`(?:\\+(${g[m.BUILDIDENTIFIER]}(?:\\.${g[m.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${g[m.MAINVERSION]}${g[m.PRERELEASE]}?${g[m.BUILD]}?`);v("FULL",`^${g[m.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${g[m.MAINVERSIONLOOSE]}${g[m.PRERELEASELOOSE]}?${g[m.BUILD]}?`);v("LOOSE",`^${g[m.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${g[m.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${g[m.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${g[m.XRANGEIDENTIFIER]})(?:\\.(${g[m.XRANGEIDENTIFIER]})(?:\\.(${g[m.XRANGEIDENTIFIER]})(?:${g[m.PRERELEASE]})?${g[m.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${g[m.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[m.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[m.XRANGEIDENTIFIERLOOSE]})(?:${g[m.PRERELEASELOOSE]})?${g[m.BUILD]}?)?)?`);v("XRANGE",`^${g[m.GTLT]}\\s*${g[m.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${g[m.GTLT]}\\s*${g[m.XRANGEPLAINLOOSE]}$`);v("COERCE",`(^|[^\\d])(\\d{1,${Hn}})(?:\\.(\\d{1,${Hn}}))?(?:\\.(\\d{1,${Hn}}))?(?:$|[^\\d])`);v("COERCERTL",g[m.COERCE],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${g[m.LONETILDE]}\\s+`,!0);ae.tildeTrimReplace="$1~";v("TILDE",`^${g[m.LONETILDE]}${g[m.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${g[m.LONETILDE]}${g[m.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${g[m.LONECARET]}\\s+`,!0);ae.caretTrimReplace="$1^";v("CARET",`^${g[m.LONECARET]}${g[m.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${g[m.LONECARET]}${g[m.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${g[m.GTLT]}\\s*(${g[m.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${g[m.GTLT]}\\s*(${g[m.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${g[m.GTLT]}\\s*(${g[m.LOOSEPLAIN]}|${g[m.XRANGEPLAIN]})`,!0);ae.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${g[m.XRANGEPLAIN]})\\s+-\\s+(${g[m.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${g[m.XRANGEPLAINLOOSE]})\\s+-\\s+(${g[m.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var yr=d((sS,Fo)=>{var Sg=Object.freeze({loose:!0}),bg=Object.freeze({}),yg=t=>t?typeof t!="object"?Sg:t:bg;Fo.exports=yg});var Yn=d((aS,Uo)=>{var Bo=/^[0-9]+$/,Vo=(t,e)=>{let r=Bo.test(t),n=Bo.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},Tg=(t,e)=>Vo(e,t);Uo.exports={compareIdentifiers:Vo,rcompareIdentifiers:Tg}});var D=d((oS,Xo)=>{var Tr=pt(),{MAX_LENGTH:ko,MAX_SAFE_INTEGER:Ar}=ht(),{safeRe:Go,t:Wo}=ke(),Ag=yr(),{compareIdentifiers:Ge}=Yn(),zn=class t{constructor(e,r){if(r=Ag(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>ko)throw new TypeError(`version is longer than ${ko} characters`);Tr("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?Go[Wo.LOOSE]:Go[Wo.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ar||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ar||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ar||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<Ar)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Tr("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),Ge(this.major,e.major)||Ge(this.minor,e.minor)||Ge(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],i=e.prerelease[r];if(Tr("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ge(n,i)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],i=e.build[r];if(Tr("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ge(n,i)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(r){let s=[r,i];n===!1&&(s=[r]),Ge(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Xo.exports=zn});var Oe=d((uS,Ko)=>{var Ho=D(),Rg=(t,e,r=!1)=>{if(t instanceof Ho)return t;try{return new Ho(t,e)}catch(n){if(!r)return null;throw n}};Ko.exports=Rg});var zo=d((cS,Yo)=>{var wg=Oe(),Cg=(t,e)=>{let r=wg(t,e);return r?r.version:null};Yo.exports=Cg});var Jo=d((lS,Qo)=>{var Lg=Oe(),Og=(t,e)=>{let r=Lg(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};Qo.exports=Og});var tu=d((dS,eu)=>{var Zo=D(),Ig=(t,e,r,n,i)=>{typeof r=="string"&&(i=n,n=r,r=void 0);try{return new Zo(t instanceof Zo?t.version:t,r).inc(e,n,i).version}catch{return null}};eu.exports=Ig});var iu=d((fS,nu)=>{var ru=Oe(),qg=(t,e)=>{let r=ru(t,null,!0),n=ru(e,null,!0),i=r.compare(n);if(i===0)return null;let s=i>0,a=s?r:n,o=s?n:r,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u)return!o.patch&&!o.minor?"major":a.patch?"patch":a.minor?"minor":"major";let l=u?"pre":"";return r.major!==n.major?l+"major":r.minor!==n.minor?l+"minor":r.patch!==n.patch?l+"patch":"prerelease"};nu.exports=qg});var au=d((hS,su)=>{var Ng=D(),xg=(t,e)=>new Ng(t,e).major;su.exports=xg});var uu=d((pS,ou)=>{var Pg=D(),Mg=(t,e)=>new Pg(t,e).minor;ou.exports=Mg});var lu=d((gS,cu)=>{var $g=D(),Dg=(t,e)=>new $g(t,e).patch;cu.exports=Dg});var fu=d((mS,du)=>{var jg=Oe(),Fg=(t,e)=>{let r=jg(t,e);return r&&r.prerelease.length?r.prerelease:null};du.exports=Fg});var G=d((vS,pu)=>{var hu=D(),Bg=(t,e,r)=>new hu(t,r).compare(new hu(e,r));pu.exports=Bg});var mu=d((_S,gu)=>{var Vg=G(),Ug=(t,e,r)=>Vg(e,t,r);gu.exports=Ug});var _u=d((ES,vu)=>{var kg=G(),Gg=(t,e)=>kg(t,e,!0);vu.exports=Gg});var Rr=d((SS,Su)=>{var Eu=D(),Wg=(t,e,r)=>{let n=new Eu(t,r),i=new Eu(e,r);return n.compare(i)||n.compareBuild(i)};Su.exports=Wg});var yu=d((bS,bu)=>{var Xg=Rr(),Hg=(t,e)=>t.sort((r,n)=>Xg(r,n,e));bu.exports=Hg});var Au=d((yS,Tu)=>{var Kg=Rr(),Yg=(t,e)=>t.sort((r,n)=>Kg(n,r,e));Tu.exports=Yg});var gt=d((TS,Ru)=>{var zg=G(),Qg=(t,e,r)=>zg(t,e,r)>0;Ru.exports=Qg});var wr=d((AS,wu)=>{var Jg=G(),Zg=(t,e,r)=>Jg(t,e,r)<0;wu.exports=Zg});var Qn=d((RS,Cu)=>{var em=G(),tm=(t,e,r)=>em(t,e,r)===0;Cu.exports=tm});var Jn=d((wS,Lu)=>{var rm=G(),nm=(t,e,r)=>rm(t,e,r)!==0;Lu.exports=nm});var Cr=d((CS,Ou)=>{var im=G(),sm=(t,e,r)=>im(t,e,r)>=0;Ou.exports=sm});var Lr=d((LS,Iu)=>{var am=G(),om=(t,e,r)=>am(t,e,r)<=0;Iu.exports=om});var Zn=d((OS,qu)=>{var um=Qn(),cm=Jn(),lm=gt(),dm=Cr(),fm=wr(),hm=Lr(),pm=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return um(t,r,n);case"!=":return cm(t,r,n);case">":return lm(t,r,n);case">=":return dm(t,r,n);case"<":return fm(t,r,n);case"<=":return hm(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};qu.exports=pm});var xu=d((IS,Nu)=>{var gm=D(),mm=Oe(),{safeRe:Or,t:Ir}=ke(),vm=(t,e)=>{if(t instanceof gm)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(Or[Ir.COERCE]);else{let n;for(;(n=Or[Ir.COERCERTL].exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||n.index+n[0].length!==r.index+r[0].length)&&(r=n),Or[Ir.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;Or[Ir.COERCERTL].lastIndex=-1}return r===null?null:mm(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,e)};Nu.exports=vm});var Mu=d((qS,Pu)=>{"use strict";Pu.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}});var Du=d((NS,$u)=>{"use strict";$u.exports=_;_.Node=Ie;_.create=_;function _(t){var e=this;if(e instanceof _||(e=new _),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(i){e.push(i)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}_.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};_.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};_.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};_.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)Em(this,arguments[t]);return this.length};_.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)Sm(this,arguments[t]);return this.length};_.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};_.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};_.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};_.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};_.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};_.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};_.prototype.map=function(t,e){e=e||this;for(var r=new _,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};_.prototype.mapReverse=function(t,e){e=e||this;for(var r=new _,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};_.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;n!==null;i++)r=t(r,n.value,i),n=n.next;return r};_.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;n!==null;i--)r=t(r,n.value,i),n=n.prev;return r};_.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};_.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};_.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(;i!==null&&n<e;n++,i=i.next)r.push(i.value);return r};_.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,i=this.tail;i!==null&&n>e;n--)i=i.prev;for(;i!==null&&n>t;n--,i=i.prev)r.push(i.value);return r};_.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,i=this.head;i!==null&&n<t;n++)i=i.next;for(var s=[],n=0;i&&n<e;n++)s.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var n=0;n<r.length;n++)i=_m(this,i,r[n]);return s};_.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function _m(t,e,r){var n=e===t.head?new Ie(r,null,e,t):new Ie(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function Em(t,e){t.tail=new Ie(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function Sm(t,e){t.head=new Ie(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function Ie(t,e,r,n){if(!(this instanceof Ie))return new Ie(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{Mu()(_)}catch{}});var Uu=d((xS,Vu)=>{"use strict";var bm=Du(),qe=Symbol("max"),ue=Symbol("length"),We=Symbol("lengthCalculator"),vt=Symbol("allowStale"),Ne=Symbol("maxAge"),oe=Symbol("dispose"),ju=Symbol("noDisposeOnSet"),N=Symbol("lruList"),K=Symbol("cache"),Bu=Symbol("updateAgeOnGet"),ei=()=>1,ri=class{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");let r=this[qe]=e.max||1/0,n=e.length||ei;if(this[We]=typeof n!="function"?ei:n,this[vt]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[Ne]=e.maxAge||0,this[oe]=e.dispose,this[ju]=e.noDisposeOnSet||!1,this[Bu]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[qe]=e||1/0,mt(this)}get max(){return this[qe]}set allowStale(e){this[vt]=!!e}get allowStale(){return this[vt]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[Ne]=e,mt(this)}get maxAge(){return this[Ne]}set lengthCalculator(e){typeof e!="function"&&(e=ei),e!==this[We]&&(this[We]=e,this[ue]=0,this[N].forEach(r=>{r.length=this[We](r.value,r.key),this[ue]+=r.length})),mt(this)}get lengthCalculator(){return this[We]}get length(){return this[ue]}get itemCount(){return this[N].length}rforEach(e,r){r=r||this;for(let n=this[N].tail;n!==null;){let i=n.prev;Fu(this,e,n,r),n=i}}forEach(e,r){r=r||this;for(let n=this[N].head;n!==null;){let i=n.next;Fu(this,e,n,r),n=i}}keys(){return this[N].toArray().map(e=>e.key)}values(){return this[N].toArray().map(e=>e.value)}reset(){this[oe]&&this[N]&&this[N].length&&this[N].forEach(e=>this[oe](e.key,e.value)),this[K]=new Map,this[N]=new bm,this[ue]=0}dump(){return this[N].map(e=>qr(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[N]}set(e,r,n){if(n=n||this[Ne],n&&typeof n!="number")throw new TypeError("maxAge must be a number");let i=n?Date.now():0,s=this[We](r,e);if(this[K].has(e)){if(s>this[qe])return Xe(this,this[K].get(e)),!1;let u=this[K].get(e).value;return this[oe]&&(this[ju]||this[oe](e,u.value)),u.now=i,u.maxAge=n,u.value=r,this[ue]+=s-u.length,u.length=s,this.get(e),mt(this),!0}let a=new ni(e,r,s,i,n);return a.length>this[qe]?(this[oe]&&this[oe](e,r),!1):(this[ue]+=a.length,this[N].unshift(a),this[K].set(e,this[N].head),mt(this),!0)}has(e){if(!this[K].has(e))return!1;let r=this[K].get(e).value;return!qr(this,r)}get(e){return ti(this,e,!0)}peek(e){return ti(this,e,!1)}pop(){let e=this[N].tail;return e?(Xe(this,e),e.value):null}del(e){Xe(this,this[K].get(e))}load(e){this.reset();let r=Date.now();for(let n=e.length-1;n>=0;n--){let i=e[n],s=i.e||0;if(s===0)this.set(i.k,i.v);else{let a=s-r;a>0&&this.set(i.k,i.v,a)}}}prune(){this[K].forEach((e,r)=>ti(this,r,!1))}},ti=(t,e,r)=>{let n=t[K].get(e);if(n){let i=n.value;if(qr(t,i)){if(Xe(t,n),!t[vt])return}else r&&(t[Bu]&&(n.value.now=Date.now()),t[N].unshiftNode(n));return i.value}},qr=(t,e)=>{if(!e||!e.maxAge&&!t[Ne])return!1;let r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[Ne]&&r>t[Ne]},mt=t=>{if(t[ue]>t[qe])for(let e=t[N].tail;t[ue]>t[qe]&&e!==null;){let r=e.prev;Xe(t,e),e=r}},Xe=(t,e)=>{if(e){let r=e.value;t[oe]&&t[oe](r.key,r.value),t[ue]-=r.length,t[K].delete(r.key),t[N].removeNode(e)}},ni=class{constructor(e,r,n,i,s){this.key=e,this.value=r,this.length=n,this.now=i,this.maxAge=s||0}},Fu=(t,e,r,n)=>{let i=r.value;qr(t,i)&&(Xe(t,r),t[vt]||(i=void 0)),i&&e.call(n,i.value,i.key,t)};Vu.exports=ri});var W=d((PS,Xu)=>{var ii=class t{constructor(e,r){if(r=Tm(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof si)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!Gu(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&Im(i[0])){this.set=[i];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&Lm)|(this.options.loose&&Om))+":"+e,i=ku.get(n);if(i)return i;let s=this.options.loose,a=s?U[F.HYPHENRANGELOOSE]:U[F.HYPHENRANGE];e=e.replace(a,Bm(this.options.includePrerelease)),R("hyphen replace",e),e=e.replace(U[F.COMPARATORTRIM],Rm),R("comparator trim",e),e=e.replace(U[F.TILDETRIM],wm),R("tilde trim",e),e=e.replace(U[F.CARETTRIM],Cm),R("caret trim",e);let o=e.split(" ").map(f=>qm(f,this.options)).join(" ").split(/\s+/).map(f=>Fm(f,this.options));s&&(o=o.filter(f=>(R("loose invalid filter",f,this.options),!!f.match(U[F.COMPARATORLOOSE])))),R("range list",o);let u=new Map,c=o.map(f=>new si(f,this.options));for(let f of c){if(Gu(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return ku.set(n,l),l}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>Wu(n,r)&&e.set.some(i=>Wu(i,r)&&n.every(s=>i.every(a=>s.intersects(a,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Am(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(Vm(this.set[r],e,this.options))return!0;return!1}};Xu.exports=ii;var ym=Uu(),ku=new ym({max:1e3}),Tm=yr(),si=_t(),R=pt(),Am=D(),{safeRe:U,t:F,comparatorTrimReplace:Rm,tildeTrimReplace:wm,caretTrimReplace:Cm}=ke(),{FLAG_INCLUDE_PRERELEASE:Lm,FLAG_LOOSE:Om}=ht(),Gu=t=>t.value==="<0.0.0-0",Im=t=>t.value==="",Wu=(t,e)=>{let r=!0,n=t.slice(),i=n.pop();for(;r&&n.length;)r=n.every(s=>i.intersects(s,e)),i=n.pop();return r},qm=(t,e)=>(R("comp",t,e),t=Pm(t,e),R("caret",t),t=Nm(t,e),R("tildes",t),t=$m(t,e),R("xrange",t),t=jm(t,e),R("stars",t),t),B=t=>!t||t.toLowerCase()==="x"||t==="*",Nm=(t,e)=>t.trim().split(/\s+/).map(r=>xm(r,e)).join(" "),xm=(t,e)=>{let r=e.loose?U[F.TILDELOOSE]:U[F.TILDE];return t.replace(r,(n,i,s,a,o)=>{R("tilde",t,n,i,s,a,o);let u;return B(i)?u="":B(s)?u=`>=${i}.0.0 <${+i+1}.0.0-0`:B(a)?u=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:o?(R("replaceTilde pr",o),u=`>=${i}.${s}.${a}-${o} <${i}.${+s+1}.0-0`):u=`>=${i}.${s}.${a} <${i}.${+s+1}.0-0`,R("tilde return",u),u})},Pm=(t,e)=>t.trim().split(/\s+/).map(r=>Mm(r,e)).join(" "),Mm=(t,e)=>{R("caret",t,e);let r=e.loose?U[F.CARETLOOSE]:U[F.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(i,s,a,o,u)=>{R("caret",t,i,s,a,o,u);let c;return B(s)?c="":B(a)?c=`>=${s}.0.0${n} <${+s+1}.0.0-0`:B(o)?s==="0"?c=`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:u?(R("replaceCaret pr",u),s==="0"?a==="0"?c=`>=${s}.${a}.${o}-${u} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}-${u} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o}-${u} <${+s+1}.0.0-0`):(R("no pr"),s==="0"?a==="0"?c=`>=${s}.${a}.${o}${n} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o} <${+s+1}.0.0-0`),R("caret return",c),c})},$m=(t,e)=>(R("replaceXRanges",t,e),t.split(/\s+/).map(r=>Dm(r,e)).join(" ")),Dm=(t,e)=>{t=t.trim();let r=e.loose?U[F.XRANGELOOSE]:U[F.XRANGE];return t.replace(r,(n,i,s,a,o,u)=>{R("xRange",t,n,i,s,a,o,u);let c=B(s),l=c||B(a),f=l||B(o),p=f;return i==="="&&p&&(i=""),u=e.includePrerelease?"-0":"",c?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&p?(l&&(a=0),o=0,i===">"?(i=">=",l?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",l?s=+s+1:a=+a+1),i==="<"&&(u="-0"),n=`${i+s}.${a}.${o}${u}`):l?n=`>=${s}.0.0${u} <${+s+1}.0.0-0`:f&&(n=`>=${s}.${a}.0${u} <${s}.${+a+1}.0-0`),R("xRange return",n),n})},jm=(t,e)=>(R("replaceStars",t,e),t.trim().replace(U[F.STAR],"")),Fm=(t,e)=>(R("replaceGTE0",t,e),t.trim().replace(U[e.includePrerelease?F.GTE0PRE:F.GTE0],"")),Bm=t=>(e,r,n,i,s,a,o,u,c,l,f,p,h)=>(B(n)?r="":B(i)?r=`>=${n}.0.0${t?"-0":""}`:B(s)?r=`>=${n}.${i}.0${t?"-0":""}`:a?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,B(c)?u="":B(l)?u=`<${+c+1}.0.0-0`:B(f)?u=`<${c}.${+l+1}.0-0`:p?u=`<=${c}.${l}.${f}-${p}`:t?u=`<${c}.${l}.${+f+1}-0`:u=`<=${u}`,`${r} ${u}`.trim()),Vm=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(R(t[n].semver),t[n].semver!==si.ANY&&t[n].semver.prerelease.length>0){let i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var _t=d((MS,Ju)=>{var Et=Symbol("SemVer ANY"),ui=class t{static get ANY(){return Et}constructor(e,r){if(r=Hu(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),oi("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===Et?this.value="":this.value=this.operator+this.semver.version,oi("comp",this)}parse(e){let r=this.options.loose?Ku[Yu.COMPARATORLOOSE]:Ku[Yu.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new zu(n[2],this.options.loose):this.semver=Et}toString(){return this.value}test(e){if(oi("Comparator.test",e,this.options.loose),this.semver===Et||e===Et)return!0;if(typeof e=="string")try{e=new zu(e,this.options)}catch{return!1}return ai(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Qu(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new Qu(this.value,r).test(e.semver):(r=Hu(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||ai(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||ai(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Ju.exports=ui;var Hu=yr(),{safeRe:Ku,t:Yu}=ke(),ai=Zn(),oi=pt(),zu=D(),Qu=W()});var St=d(($S,Zu)=>{var Um=W(),km=(t,e,r)=>{try{e=new Um(e,r)}catch{return!1}return e.test(t)};Zu.exports=km});var tc=d((DS,ec)=>{var Gm=W(),Wm=(t,e)=>new Gm(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));ec.exports=Wm});var nc=d((jS,rc)=>{var Xm=D(),Hm=W(),Km=(t,e,r)=>{let n=null,i=null,s=null;try{s=new Hm(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new Xm(n,r))}),n};rc.exports=Km});var sc=d((FS,ic)=>{var Ym=D(),zm=W(),Qm=(t,e,r)=>{let n=null,i=null,s=null;try{s=new zm(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new Ym(n,r))}),n};ic.exports=Qm});var uc=d((BS,oc)=>{var ci=D(),Jm=W(),ac=gt(),Zm=(t,e)=>{t=new Jm(t,e);let r=new ci("0.0.0");if(t.test(r)||(r=new ci("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let i=t.set[n],s=null;i.forEach(a=>{let o=new ci(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||ac(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!r||ac(r,s))&&(r=s)}return r&&t.test(r)?r:null};oc.exports=Zm});var lc=d((VS,cc)=>{var ev=W(),tv=(t,e)=>{try{return new ev(t,e).range||"*"}catch{return null}};cc.exports=tv});var Nr=d((US,pc)=>{var rv=D(),hc=_t(),{ANY:nv}=hc,iv=W(),sv=St(),dc=gt(),fc=wr(),av=Lr(),ov=Cr(),uv=(t,e,r,n)=>{t=new rv(t,n),e=new iv(e,n);let i,s,a,o,u;switch(r){case">":i=dc,s=av,a=fc,o=">",u=">=";break;case"<":i=fc,s=ov,a=dc,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(sv(t,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],f=null,p=null;if(l.forEach(h=>{h.semver===nv&&(h=new hc(">=0.0.0")),f=f||h,p=p||h,i(h.semver,f.semver,n)?f=h:a(h.semver,p.semver,n)&&(p=h)}),f.operator===o||f.operator===u||(!p.operator||p.operator===o)&&s(t,p.semver))return!1;if(p.operator===u&&a(t,p.semver))return!1}return!0};pc.exports=uv});var mc=d((kS,gc)=>{var cv=Nr(),lv=(t,e,r)=>cv(t,e,">",r);gc.exports=lv});var _c=d((GS,vc)=>{var dv=Nr(),fv=(t,e,r)=>dv(t,e,"<",r);vc.exports=fv});var bc=d((WS,Sc)=>{var Ec=W(),hv=(t,e,r)=>(t=new Ec(t,r),e=new Ec(e,r),t.intersects(e,r));Sc.exports=hv});var Tc=d((XS,yc)=>{var pv=St(),gv=G();yc.exports=(t,e,r)=>{let n=[],i=null,s=null,a=t.sort((l,f)=>gv(l,f,r));for(let l of a)pv(l,e,r)?(s=l,i||(i=l)):(s&&n.push([i,s]),s=null,i=null);i&&n.push([i,null]);let o=[];for(let[l,f]of n)l===f?o.push(l):!f&&l===a[0]?o.push("*"):f?l===a[0]?o.push(`<=${f}`):o.push(`${l} - ${f}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Oc=d((HS,Lc)=>{var Ac=W(),di=_t(),{ANY:li}=di,bt=St(),fi=G(),mv=(t,e,r={})=>{if(t===e)return!0;t=new Ac(t,r),e=new Ac(e,r);let n=!1;e:for(let i of t.set){for(let s of e.set){let a=_v(i,s,r);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},vv=[new di(">=0.0.0-0")],Rc=[new di(">=0.0.0")],_v=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===li){if(e.length===1&&e[0].semver===li)return!0;r.includePrerelease?t=vv:t=Rc}if(e.length===1&&e[0].semver===li){if(r.includePrerelease)return!0;e=Rc}let n=new Set,i,s;for(let h of t)h.operator===">"||h.operator===">="?i=wc(i,h,r):h.operator==="<"||h.operator==="<="?s=Cc(s,h,r):n.add(h.semver);if(n.size>1)return null;let a;if(i&&s){if(a=fi(i.semver,s.semver,r),a>0)return null;if(a===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let h of n){if(i&&!bt(h,String(i),r)||s&&!bt(h,String(s),r))return null;for(let x of e)if(!bt(h,String(x),r))return!1;return!0}let o,u,c,l,f=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",i){if(p&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===p.major&&h.semver.minor===p.minor&&h.semver.patch===p.patch&&(p=!1),h.operator===">"||h.operator===">="){if(o=wc(i,h,r),o===h&&o!==i)return!1}else if(i.operator===">="&&!bt(i.semver,String(h),r))return!1}if(s){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator==="<"||h.operator==="<="){if(u=Cc(s,h,r),u===h&&u!==s)return!1}else if(s.operator==="<="&&!bt(s.semver,String(h),r))return!1}if(!h.operator&&(s||i)&&a!==0)return!1}return!(i&&c&&!s&&a!==0||s&&l&&!i&&a!==0||p||f)},wc=(t,e,r)=>{if(!t)return e;let n=fi(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},Cc=(t,e,r)=>{if(!t)return e;let n=fi(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};Lc.exports=mv});var xc=d((KS,Nc)=>{var hi=ke(),Ic=ht(),Ev=D(),qc=Yn(),Sv=Oe(),bv=zo(),yv=Jo(),Tv=tu(),Av=iu(),Rv=au(),wv=uu(),Cv=lu(),Lv=fu(),Ov=G(),Iv=mu(),qv=_u(),Nv=Rr(),xv=yu(),Pv=Au(),Mv=gt(),$v=wr(),Dv=Qn(),jv=Jn(),Fv=Cr(),Bv=Lr(),Vv=Zn(),Uv=xu(),kv=_t(),Gv=W(),Wv=St(),Xv=tc(),Hv=nc(),Kv=sc(),Yv=uc(),zv=lc(),Qv=Nr(),Jv=mc(),Zv=_c(),e_=bc(),t_=Tc(),r_=Oc();Nc.exports={parse:Sv,valid:bv,clean:yv,inc:Tv,diff:Av,major:Rv,minor:wv,patch:Cv,prerelease:Lv,compare:Ov,rcompare:Iv,compareLoose:qv,compareBuild:Nv,sort:xv,rsort:Pv,gt:Mv,lt:$v,eq:Dv,neq:jv,gte:Fv,lte:Bv,cmp:Vv,coerce:Uv,Comparator:kv,Range:Gv,satisfies:Wv,toComparators:Xv,maxSatisfying:Hv,minSatisfying:Kv,minVersion:Yv,validRange:zv,outside:Qv,gtr:Jv,ltr:Zv,intersects:e_,simplifyRange:t_,subset:r_,SemVer:Ev,re:hi.re,src:hi.src,tokens:hi.t,SEMVER_SPEC_VERSION:Ic.SEMVER_SPEC_VERSION,RELEASE_TYPES:Ic.RELEASE_TYPES,compareIdentifiers:qc.compareIdentifiers,rcompareIdentifiers:qc.rcompareIdentifiers}});var gi=d((YS,pi)=>{"use strict";var n_=xc(),i_=dt(),He=Ee(),Pc=M(),Mc=C(),$c="2.7.15",s_=function(){return!1},a_=function(e){if(!n_.gte(e.VERSION,$c))throw new Error("AWS SDK version "+$c+" or greater required.");for(var r in e)if(e[r].serviceIdentifier){var n=e[r];n.prototype.customizeRequests(Dc)}return e},o_=function(e){return e.customizeRequests(Dc),e};function Dc(t){var e=He.resolveSegment(He.resolveManualSegmentParams(t.params));if(!e){var r=this.serviceIdentifier+"."+t.operation;return He.isAutomaticMode()?Mc.getLogger().info("Call "+r+" is missing the sub/segment context for automatic mode. Ignoring."):Mc.getLogger().info("Call "+r+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),t}var n=this.throttledError||s_,i=new Error().stack;let s;e.notTraced?s=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):s=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){let f="Root="+a+";Parent="+s.id+";Sampled="+(s.notTraced?"0":"1");if(o!=null)for(let[p,h]of Object.entries(o))f+=";"+p+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=f},c=function(l){s.addAttribute("namespace","aws"),s.addAttribute("aws",new i_(l,s.name));var f=l.httpResponse;if(f&&(s.addAttribute("http",new jc(f)),(f.statusCode===429||l.error&&n(l.error))&&s.addThrottleFlag()),l.error){var p={message:l.error.message,name:l.error.code,stack:i};f&&f.statusCode?(Pc.getCauseTypeFromHttpStatus(f.statusCode)=="error"&&s.addErrorFlag(),s.close(p,!0)):s.close(p)}else{if(f&&f.statusCode){var h=Pc.getCauseTypeFromHttpStatus(f.statusCode);h&&(s[h]=!0)}s.close()}};t.on("beforePresign",function(l){e.removeSubsegment(s),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),t.on("build",u).on("complete",c),t.__send||(t.__send=t.send,t.send=function(l){if(He.isAutomaticMode()){var f=He.getNamespace();f.run(function(){He.setSegment(s),t.__send(l)})}else t.__send(l)})}function jc(t){this.init(t)}jc.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};pi.exports.captureAWSClient=o_;pi.exports.captureAWS=a_});var Gc=d(Ke=>{"use strict";var Uc=Ke&&Ke.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.captureAWSClient=void 0;var u_=require("@aws-sdk/service-error-classification"),c_=Uc(dt()),l_=require("querystring"),d_=Uc(ot()),mi=Ee(),Fc=C(),{safeParseInt:xr}=M(),f_=M(),kc="XRaySDKInstrumentation",Bc=async(t,e,r,n,i)=>{var s,a,o;let{extendedRequestId:u,requestId:c,httpStatusCode:l,attempts:f}=((s=n?.output)===null||s===void 0?void 0:s.$metadata)||i?.$metadata,p=new c_.default({extendedRequestId:u,requestId:c,retryCount:f,request:{operation:e,httpRequest:{region:r,statusCode:l}}},t),h={};return l&&(h.response={},h.response.status=l),!((a=n?.response)===null||a===void 0)&&a.headers&&((o=n?.response)===null||o===void 0?void 0:o.headers["content-length"])!==void 0&&(h.response||(h.response={}),h.response.content_length=xr(n.response.headers["content-length"])),[p,h]};function Vc(t,e,r){var n,i,s;(r&&(0,u_.isThrottlingError)(r)||xr((n=t.response)===null||n===void 0?void 0:n.status)===429||xr((i=r?.$metadata)===null||i===void 0?void 0:i.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,f_.getCauseTypeFromHttpStatus)(xr((s=t.response)===null||s===void 0?void 0:s.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var h_=(t,e)=>(r,n)=>async i=>{let s=mi.isAutomaticMode()?mi.resolveSegment():e,{clientName:a,commandName:o}=n,u=o.slice(0,-7),c=a.slice(0,-6);if(!s){let h=c+"."+u.charAt(0).toLowerCase()+u.slice(1);return mi.isAutomaticMode()?Fc.getLogger().info("Call "+h+" is missing the sub/segment context for automatic mode. Ignoring."):Fc.getLogger().info("Call "+h+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),r(i)}let l;s.notTraced?l=s.addNewSubsegmentWithoutSampling(c):l=s.addNewSubsegment(c),l.addAttribute("namespace","aws");let f=s instanceof d_.default?s.segment:s;i.request.headers["X-Amzn-Trace-Id"]=(0,l_.stringify)({Root:f.trace_id,Parent:l.id,Sampled:l.notTraced?"0":"1"},";");let p;try{if(p=await r(i),!p)throw new Error("Failed to get response from instrumented AWS Client.");let[h,x]=await Bc(c,u,await t.region(),p,null);return l.addAttribute("aws",h),l.addAttribute("http",x),Vc(x,l),l.close(),p}catch(h){if(h.$metadata){let[O,Rt]=await Bc(c,u,await t.region(),null,h);l.addAttribute("aws",O),l.addAttribute("http",Rt),Vc(Rt,l,h)}let x={message:h.message,name:h.name,stack:h.stack||new Error().stack};throw l.close(x,!0),h}},p_={name:kc,step:"build"},g_=(t,e)=>({applyToStack:r=>{r.add(h_(t,e),p_)}});function m_(t,e){return t.middlewareStack.remove(kc),t.middlewareStack.use(g_(t.config,e)),t}Ke.captureAWSClient=m_});var _i=d((QS,vi)=>{"use strict";var Wc=require("url"),Ye=Ee(),Pr=M(),Xc=C(),v_=require("events"),__=function(e,r,n){e.__request||Hc(e,r,n)},E_=function(e,r,n){if(e.__request)return e;var i={};return Object.keys(e).forEach(function(s){i[s]=e[s]}),Hc(i,r,n),i};function Hc(t,e,r){function n(a,...o){let u,c,l,f,p=o[0];if(typeof o[1]=="object"?(l=!0,f=typeof p=="string"?new Wc.URL(p):p,u=o[1],c=o[2]):(l=!1,u=p,c=o[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return a(...o);typeof u=="string"&&(u=new Wc.URL(u)),l||(f=u);let h=Ye.resolveSegment(Ye.resolveManualSegmentParams(u)),x=u.hostname||u.host||f.hostname||f.host||"Unknown host";if(!h){let I="[ host: "+x;return I=u.method?I+", method: "+u.method:I,I+=", path: "+(f.pathname||Pr.stripQueryStringFromPath(u.path))+" ]",Ye.isAutomaticMode()?Xc.getLogger().info("Options for request "+I+" is missing the sub/segment context for automatic mode. Ignoring."):Xc.getLogger().info("Options for request "+I+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let O;h.notTraced?O=h.addNewSubsegmentWithoutSampling(x):O=h.addNewSubsegment(x);let Rt=h.segment?h.segment:h;O.namespace="remote",u.headers||(u.headers={}),u.headers["X-Amzn-Trace-Id"]="Root="+Rt.trace_id+";Parent="+O.id+";Sampled="+(O.notTraced?"0":"1");let El=function(ce){if(r&&r(O,this,null,ce),O.http&&O.http.response)Pr.getCauseTypeFromHttpStatus(O.http.response.status)==="error"&&O.addErrorFlag(),O.close(ce,!0);else{let bl=ce.code!=="ECONNREFUSED";O.addRemoteRequestData(this,null,bl&&e),O.close(ce)}},Sl=Pr.objectWithoutProperties(u,["Segment"],!0),Ri=a(...l?[p,Sl]:[u],function(I){I.on("end",function(){r&&r(O,this.req,I),I.statusCode===429&&O.addThrottleFlag();let ce=Pr.getCauseTypeFromHttpStatus(I.statusCode);ce&&(O[ce]=!0),O.addRemoteRequestData(I.req,I,!!e),O.close()}),typeof c=="function"?Ye.isAutomaticMode()?Ye.getNamespace().run(function(){Ye.setSegment(O),c(I)}):c(I):I.req&&I.req.listenerCount("response")===0&&I.resume()});return Ri.on(v_.errorMonitor||"error",El),Ri}t.__request=t.request;function i(...a){return n(t.__request,...a)}t.__get=t.get;function s(...a){return n(t.__get,...a)}Object.defineProperties(t,{request:{value:i,configurable:!0,enumerable:!0,writable:!0},get:{value:s,configurable:!0,enumerable:!0,writable:!0}})}vi.exports.captureHTTPsGlobal=__;vi.exports.captureHTTPs=E_});var Qc=d((JS,Ei)=>{"use strict";var yt=Ee(),Mr=Symbol("original then"),$r=Symbol("original catch");function Yc(t){let e=t.prototype.then;e[Mr]||(t.prototype.then=function(n,i){if(yt.isAutomaticMode()&&Kc()){let s=yt.getNamespace();n=n&&s.bind(n),i=i&&s.bind(i)}return e.call(this,n,i)},t.prototype.then[Mr]=e);let r=t.prototype.catch;r&&!r[$r]&&(t.prototype.catch=function(n){if(yt.isAutomaticMode()&&Kc()){let i=yt.getNamespace();n=n&&i.bind(n)}return r.call(this,n)},t.prototype.catch[$r]=r)}function S_(t){let e=t.prototype.then;e[Mr]&&(t.prototype.then=e[Mr]);let r=t.prototype.catch;r&&r[$r]&&(t.prototype.catch=r[$r])}function Kc(){try{return yt.getSegment()}catch{return}}function zc(){Yc(Promise)}function b_(){S_(Promise)}zc.patchThirdPartyPromise=Yc;Ei.exports.capturePromise=zc;Ei.exports.uncapturePromise=b_});var el=d((ZS,Zc)=>{"use strict";function Jc(t,e,r,n,i){this.init(t,e,r,n,i)}Jc.prototype.init=function(e,r,n,i,s){e&&(this.database_version=e),r&&(this.driver_version=r),s&&(this.preparation=s),this.url=i,this.user=n};Zc.exports=Jc});var nl=d((eb,rl)=>{"use strict";var Se=Ee(),Si=C(),ze=ge(),y_=M(),T_=fo(),At={};try{At=ho()}catch(t){Si.getLogger().debug("Failed to load SDK data:",t)}var Tt="unknown",tl={plugins:{EC2Plugin:bo(),ECSPlugin:To(),ElasticBeanstalkPlugin:Ro()},config:function(t){var e={};t.forEach(function(r){r.getData(function(n){if(n)for(var i in n)e[i]=n[i]}),ze.setOrigin(r.originName),ze.setPluginData(e)})},setAWSWhitelist:dt().setAWSWhitelist,appendAWSWhitelist:dt().appendAWSWhitelist,setStreamingThreshold:ze.setStreamingThreshold,setLogger:Si.setLogger,getLogger:Si.getLogger,setDaemonAddress:sr().setDaemonAddress,captureFunc:br().captureFunc,captureAsyncFunc:br().captureAsyncFunc,captureCallbackFunc:br().captureCallbackFunc,captureAWS:gi().captureAWS,captureAWSClient:gi().captureAWSClient,captureAWSv3Client:Gc().captureAWSClient,captureHTTPs:_i().captureHTTPs,captureHTTPsGlobal:_i().captureHTTPsGlobal,capturePromise:Qc().capturePromise,utils:y_,database:{SqlData:el()},middleware:jn(),getNamespace:Se.getNamespace,resolveSegment:Se.resolveSegment,getSegment:Se.getSegment,setSegment:Se.setSegment,isAutomaticMode:Se.isAutomaticMode,enableAutomaticMode:Se.enableAutomaticMode,enableManualMode:Se.enableManualMode,setContextMissingStrategy:Se.setContextMissingStrategy,Segment:ut(),Subsegment:ot(),SegmentUtils:ze};tl.middleware.IncomingRequestData=Cn(),function(){var t={runtime:process.release&&process.release.name?process.release.name:Tt,runtime_version:process.version,version:process.env.npm_package_version||Tt,name:process.env.npm_package_name||Tt},e={sdk:"X-Ray for Node.js",sdk_version:At.version?At.version:Tt,package:At.name?At.name:Tt};ze.setSDKData(e),ze.setServiceData(t),process.env.LAMBDA_TASK_ROOT&&T_.init()}();rl.exports=tl});var bi=d((tb,il)=>{"use strict";il.exports=nl()});var sl=d(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});Dr.ProviderService=void 0;var V=bi(),A_=Pe(),yi=class{captureAWS(e){return(0,V.captureAWS)(e)}captureAWSClient(e){return(0,V.captureAWSClient)(e)}captureAWSv3Client(e){return(0,A_.addUserAgentMiddleware)(e,"tracer"),(0,V.captureAWSv3Client)(e)}captureAsyncFunc(e,r,n){return(0,V.captureAsyncFunc)(e,r)}captureFunc(e,r,n){return(0,V.captureFunc)(e,r)}captureHTTPsGlobal(){(0,V.captureHTTPsGlobal)(require("http")),(0,V.captureHTTPsGlobal)(require("https"))}getNamespace(){return(0,V.getNamespace)()}getSegment(){return(0,V.getSegment)()}putAnnotation(e,r){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(n instanceof V.Segment){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}n.addAnnotation(e,r)}putMetadata(e,r,n){let i=this.getSegment();if(i===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(i instanceof V.Segment){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}i.addMetadata(e,r,n)}setContextMissingStrategy(e){(0,V.setContextMissingStrategy)(e)}setDaemonAddress(e){(0,V.setDaemonAddress)(e)}setLogger(e){(0,V.setLogger)(e)}setSegment(e){(0,V.setSegment)(e)}};Dr.ProviderService=yi});var ol=d(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0})});var cl=d(be=>{"use strict";var R_=be&&be.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),ul=be&&be.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&R_(e,t,r)};Object.defineProperty(be,"__esModule",{value:!0});ul(sl(),be);ul(ol(),be)});var ll=d(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.Tracer=void 0;var w_=Pe(),C_=Us(),L_=cl(),O_=bi(),Ti=class extends w_.Utility{constructor(e={}){super(),this.captureError=!0,this.captureHTTPsRequests=!0,this.captureResponse=!0,this.tracingEnabled=!0,this.setOptions(e),this.provider=new L_.ProviderService,this.isTracingEnabled()&&this.captureHTTPsRequests&&this.provider.captureHTTPsGlobal(),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(e,r){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(e,r||!1)}}addResponseAsMetadata(e,r){e===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${r} response`,e)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(e){return this.isTracingEnabled()?this.provider.captureAWS(e):e}captureAWSClient(e){if(!this.isTracingEnabled())return e;try{return this.provider.captureAWSClient(e)}catch(r){try{return this.provider.captureAWSClient(e.service),e}catch{throw r}}}captureAWSv3Client(e){return this.isTracingEnabled()?this.provider.captureAWSv3Client(e):e}captureLambdaHandler(e){return(r,n,i)=>{let s=i.value,a=this;return i.value=function(o,u,c){let l=this;return a.isTracingEnabled()?a.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async f=>{a.annotateColdStart(),a.addServiceNameAnnotation();let p;try{p=await s.apply(l,[o,u,c]),(e?.captureResponse??!0)&&a.addResponseAsMetadata(p,process.env._HANDLER)}catch(h){throw a.addErrorAsMetadata(h),h}finally{f?.close(),f?.flush()}return p}):s.apply(l,[o,u,c])},i}}captureMethod(e){return(r,n,i)=>{let s=i.value,a=this;return i.value=function(...o){if(!a.isTracingEnabled())return s.apply(this,[...o]);let u=String(n),c=e?.subSegmentName?e.subSegmentName:`### ${u}`;return a.provider.captureAsyncFunc(c,async l=>{let f;try{f=await s.apply(this,[...o]),(e?.captureResponse??!0)&&a.addResponseAsMetadata(f,u)}catch(p){throw a.addErrorAsMetadata(p),p}finally{l?.close(),l?.flush()}return f})},i}}getRootXrayTraceId(){return this.envVarsService.getXrayTraceId()}getSegment(){if(!this.isTracingEnabled())return new O_.Subsegment("## Dummy segment");let e=this.provider.getSegment();return e===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),e}isTraceSampled(){return this.isTracingEnabled()?this.envVarsService.getXrayTraceSampled():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(e,r){this.isTracingEnabled()&&this.provider.putAnnotation(e,r)}putMetadata(e,r,n){this.isTracingEnabled()&&this.provider.putMetadata(e,r,n||this.serviceName)}setSegment(e){if(this.isTracingEnabled())return this.provider.setSegment(e)}getCustomConfigService(){return this.customConfigService}getEnvVarsService(){return this.envVarsService}isAmplifyCli(){return this.getEnvVarsService().getAwsExecutionEnv()==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return this.getEnvVarsService().getAwsExecutionEnv()!==""}isLambdaSamCli(){return this.getEnvVarsService().getSamLocal()!==""}setCaptureError(){let e=this.getCustomConfigService()?.getTracingCaptureError();if(e!==void 0&&e.toLowerCase()==="false"){this.captureError=!1;return}if(this.getEnvVarsService().getTracingCaptureError().toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(e){if(e!==void 0&&!e){this.captureHTTPsRequests=!1;return}let r=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(r!==void 0&&r.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}if(this.getEnvVarsService().getCaptureHTTPsRequests().toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}}setCaptureResponse(){let e=this.getCustomConfigService()?.getTracingCaptureResponse();if(e!==void 0&&e.toLowerCase()==="false"){this.captureResponse=!1;return}if(this.getEnvVarsService().getTracingCaptureResponse().toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvVarsService(){this.envVarsService=new C_.EnvironmentVariablesService}setOptions(e){let{enabled:r,serviceName:n,captureHTTPsRequests:i,customConfigService:s}=e;return this.setEnvVarsService(),this.setCustomConfigService(s),this.setTracingEnabled(r),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(e){if(e!==void 0&&this.isValidServiceName(e)){this.serviceName=e;return}let r=this.getCustomConfigService()?.getServiceName();if(r!==void 0&&this.isValidServiceName(r)){this.serviceName=r;return}let n=this.getEnvVarsService().getServiceName();if(n!==void 0&&this.isValidServiceName(n)){this.serviceName=n;return}this.serviceName=this.getDefaultServiceName()}setTracingEnabled(e){if(e!==void 0&&!e){this.tracingEnabled=e;return}let r=this.getCustomConfigService()?.getTracingEnabled();if(r!==void 0&&r.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(this.getEnvVarsService().getTracingEnabled().toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};jr.Tracer=Ti});var fl=d(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0})});var hl=d(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.captureLambdaHandler=void 0;var I_=gn(),q_=(t,e)=>{let r,n,i=l=>{l.internal={...l.internal,[I_.TRACER_KEY]:a}},s=()=>{let l=t.getSegment();l!==void 0&&(r=l,n=r.addNewSubsegment(`## ${process.env._HANDLER}`),t.setSegment(n))},a=()=>{n===void 0||r===null||(n.close(),t.setSegment(r))};return{before:async l=>{t.isTracingEnabled()&&(s(),i(l),t.annotateColdStart(),t.addServiceNameAnnotation())},after:async l=>{t.isTracingEnabled()&&((e?.captureResponse??!0)&&t.addResponseAsMetadata(l.response,process.env._HANDLER),a())},onError:async l=>{t.isTracingEnabled()&&(t.addErrorAsMetadata(l.error),a())}}};Fr.captureLambdaHandler=q_});var mn=d(Z=>{"use strict";var N_=Z&&Z.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Br=Z&&Z.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&N_(e,t,r)};Object.defineProperty(Z,"__esModule",{value:!0});Br(Ds(),Z);Br(ll(),Z);Br(fl(),Z);Br(hl(),Z)});var M_={};Cl(M_,{handler:()=>P_});module.exports=Ll(M_);var Vr=require("@aws-sdk/client-location");var pl=Ur(kr()),gl=Ur(Gr()),ml=Ur(mn()),vl="asset-tracker",Ai=new gl.Logger({serviceName:vl,logLevel:"DEBUG",persistentLogAttributes:{logger:{version:pl.PT_VERSION,name:"@aws-lambda-powertools/logger"}}}),cb=new ml.Tracer({serviceName:vl});var _l=t=>{if(t==="hour")return{startTime:new Date(Date.now()-60*60*1e3),endTime:new Date};if(t==="day")return{startTime:new Date(Date.now()-24*60*60*1e3),endTime:new Date};if(t==="week")return{startTime:new Date(Date.now()-7*24*60*60*1e3),endTime:new Date};throw new Error("Invalid span")};var x_=new Vr.LocationClient({}),P_=async t=>{Ai.debug("event",{event:t});let{deviceId:e,span:r}=t.arguments;if(!e)throw new Error("deviceId is required");let{startTime:n,endTime:i}=_l(r);try{let s=await x_.send(new Vr.GetDevicePositionHistoryCommand({DeviceId:e,TrackerName:process.env.TRACKER_NAME,StartTimeInclusive:n,EndTimeExclusive:i}));Ai.debug("Result from Tracker API",{res:s});let{DevicePositions:a}=s;if(!a||a.length===0)throw new Error("No history found for this device and time range, try increasing the time range");return a.map(o=>({deviceId:o.DeviceId,sampleTime:o.SampleTime,accuracy:o.Accuracy?{horizontal:o.Accuracy?.Horizontal??-1}:null,lng:o.Position?.[0]??-1,lat:o.Position?.[1]??-1,trackerName:process.env.TRACKER_NAME,receivedTime:o.ReceivedTime,metadata:{batteryLevel:o.PositionProperties?.batteryLevel??-1}}))}catch(s){throw s}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
